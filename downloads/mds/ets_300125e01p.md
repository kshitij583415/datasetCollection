EUROPEAN
ETS 300 125
TELECOMMUNICATION
September 1991
STANDARD
Source: ETSI TC-SPS
Reference: T/S 46-20 [CC]
ICS: 33.080
Key words: ISDN, data link layer, Q.920, Q.921
Integrated Services Digital Network (ISDN);
User-network interface data link layer specification;
Application of CCITT Recommendations Q.920/I.440
and Q.921/I.441
ETSI
European Telecommunications Standards Institute
ETSI Secretariat
Postal address: F-06921 Sophia Antipolis CEDEX - FRANCE
Office address: 650 Route des Lucioles - Sophia Antipolis - Valbonne - FRANCE
X.400: c=fr, a=atlas, p=etsi, s=secretariat - Internet: secretariat@etsi.fr
Tel.: +33 92 94 42 00 - Fax: +33 93 65 47 16
Copyright Notification: No part may be reproduced except as authorized by written permission. The copyright and the
foregoing restriction extend to reproduction in all media.
© European Telecommunications Standards Institute 1991. All rights reserved.
Page 2
ETS 300 125: September 1991
Whilst every care has been taken in the preparation and publication of this document, errors in content,
typographical or otherwise, may occur. If you have comments concerning its accuracy, please write to
"ETSI Editing and Standards Approval Dept." at the address shown on the title page.
Page 3
ETS 300 125: September 1991
Contents
Foreword .......................................................................................................................................................9
Scope ............................................................................................................................................................9
PART 1: Application of CCITT Recomendation Q.920(I.440) .....................................................................11
ISDN user-network interface data link layer - General aspects...................................................................11
1
General..............................................................................................................................................11
2
Concepts and terminology.................................................................................................................11
3
Overview description of LAPD functions and procedures.................................................................15
3.1
General ..............................................................................................................................15
3.2
Unacknowledged operation ...............................................................................................17
3.3
Acknowledged operation....................................................................................................17
3.4
Establishment of information transfer modes ....................................................................17
3.4.1
Data link connection identification.................................................................17
3.4.2
Data link states..............................................................................................18
3.4.3
TEI administration .........................................................................................19
3.4.4
Establishment of multiple frame operation....................................................20
4
Service characteristics ......................................................................................................................20
4.1
General ..............................................................................................................................20
4.2
Services provided to layer 3...............................................................................................20
4.2.1
Unacknowledged information transfer service ..............................................20
4.2.2
Acknowledged information transfer service ..................................................20
4.3
Services provided to layer management............................................................................21
4.4
Administrative services ......................................................................................................22
4.5
Model of the data link service: ...........................................................................................22
4.5.1
General..........................................................................................................22
4.5.2
Data link layer representation as seen by layer 3..........................................23
4.5.2.1
Data Link Connection Endpoint States................................23
4.5.2.2
Broadcast data link layer connection services.....................23
4.5.2.3
Point-to-point data link connection endpoint services .........23
4.5.2.4
Sequences of primitives at one point-to-point data link
connection endpoint.............................................................23
4.6
Services required from the physical layer..........................................................................24
5
Data link layer - Management structure ............................................................................................24
5.1
Data link procedure............................................................................................................26
5.2
Multiplex procedure............................................................................................................26
5.3
Structure of the data link procedure...................................................................................26
5.4
Additions for European networks.......................................................................................27
5.4.1
General..........................................................................................................27
5.4.2
Enhanced functional block diagram and block interaction diagram ..............27
References (used in Q.920) ........................................................................................................................31
PART 2: Application of CCITT Recomendation Q.921(I.441) .....................................................................32
ISDN user-network interface - Data link layer specification ........................................................................32
1
General..............................................................................................................................................32
2
Frame structure for peer-to-peer communication .............................................................................32
Page 4
ETS 300 125: September 1991
2.1
General.............................................................................................................................. 32
2.2
Flag sequence................................................................................................................... 32
2.3
Address field...................................................................................................................... 32
2.4
Control field ....................................................................................................................... 33
2.5
Information field................................................................................................................. 33
2.6
Transparency .................................................................................................................... 33
2.7
FCS field............................................................................................................................ 33
2.8
Format convention ............................................................................................................ 34
2.8.1
Numbering Convention................................................................................. 34
2.8.2
Order of bit transmission .............................................................................. 34
2.8.3
Field mapping convention............................................................................. 34
2.9
Invalid frames.................................................................................................................... 35
2.10
Frame abort....................................................................................................................... 35
3
Elements of procedures and formats of fields for data link layer peer-to-peer communication ....... 35
3.1
General.............................................................................................................................. 35
3.2
Address field format .......................................................................................................... 35
3.3
Address field variables ...................................................................................................... 36
3.3.1
Address field extension bit (EA).................................................................... 36
3.3.2
Command/Response field bit (C/R).............................................................. 36
3.3.3
Service Access Point Identifier (SAPI).......................................................... 36
3.3.4
Terminal Endpoint Identifier (TEI)................................................................. 37
3.3.4.1
TEI for broadcast data link connection................................ 37
3.3.4.2
TEI for point-to-point data link connection .......................... 37
3.4
Control field formats.......................................................................................................... 37
3.4.1
Information transfer (I) format....................................................................... 38
3.4.2
Supervisory (S) format.................................................................................. 38
3.4.3
Unnumbered (U) format................................................................................ 38
3.5
Control field parameters and associated state variables .................................................. 38
3.5.1
Poll/Final bit .................................................................................................. 38
3.5.2
Multiple frame operation - variables and sequence numbers....................... 39
3.5.2.1
Modulus............................................................................... 39
3.5.2.2
Send state variable V(S) ..................................................... 39
3.5.2.3
Acknowledge state variable V(A) ........................................ 39
3.5.2.4
Send sequence number N(S) ............................................. 39
3.5.2.5
Receive state variable V(R) ................................................ 39
3.5.2.6
Receive sequence number N(R)......................................... 39
3.5.3
Unacknowledged operation - variables and parameters .............................. 39
3.6
Frame types ...................................................................................................................... 39
3.6.1
Commands and responses........................................................................... 39
3.6.2
Information (I) command .............................................................................. 40
3.6.3
Set asynchronous balanced mode extended (SABME) command............... 40
3.6.4
DISConnect (DISC) command ..................................................................... 41
3.6.5
Unnumbered Information (UI) command...................................................... 41
3.6.6
Receive Ready (RR) command/response.................................................... 41
3.6.7
REJect (REJ) command/response ............................................................... 41
3.6.8
Receive Not Ready (RNR) command/response........................................... 41
3.6.9
Unnumbered Acknowledgement (UA) response .......................................... 42
3.6.10
Disconnected Mode (DM) response ............................................................. 42
3.6.11
Frame reject (FRMR) response.................................................................... 42
3.6.12
Exchange identification (XID) command/response ...................................... 43
4
Elements for layer-to-layer communication ...................................................................................... 44
4.1
General.............................................................................................................................. 44
4.1.1
Generic names ............................................................................................. 44
4.1.1.1
DL-ESTABLISH................................................................... 44
4.1.1.2
DL-RELEASE...................................................................... 44
4.1.1.3
DL-DATA............................................................................. 44
4.1.1.4
DL-UNIT DATA ................................................................... 44
4.1.1.5
MDL-ASSIGN...................................................................... 44
4.1.1.6
MDL-REMOVE.................................................................... 45
4.1.1.7
MDL-ERROR ...................................................................... 45
4.1.1.8
MDL-UNIT DATA ................................................................ 45
Page 5
ETS 300 125: September 1991
4.1.1.9
MDL-XID..............................................................................45
4.1.1.10
PH-DATA.............................................................................45
4.1.1.11
PH-ACTIVATE.....................................................................45
4.1.1.12
PH-DEACTIVATE................................................................45
4.1.1.13
MPH-ACTIVATE (See Appendix III)....................................45
4.1.1.14
MPH-DEACTIVATE (See Appendix III)...............................45
4.1.1.15
MPH-INFORMATION ..........................................................45
4.1.2
Primitive types ...............................................................................................45
4.1.2.1
REQUEST ...........................................................................46
4.1.2.2
INDICATION........................................................................46
4.1.2.3
RESPONSE.........................................................................46
4.1.2.4
CONFIRM............................................................................46
4.1.3
Parameter definition ......................................................................................46
4.1.3.1
Priority indicator ...................................................................46
4.1.3.2
Message unit .......................................................................46
4.2
Primitive procedures ..........................................................................................................47
4.2.1
General..........................................................................................................47
4.2.2
Layer 3 - data link layer interactions..............................................................47
5
Definition of the peer-to-peer procedures of the data link layer ........................................................49
5.1
Procedure for the use of the P/F bit...................................................................................50
5.1.1
Unacknowledged information transfer...........................................................50
5.1.2
Acknowledged multiple frame information transfer.......................................50
5.2
Procedures for unacknowledged information transfer.......................................................50
5.2.1
General..........................................................................................................50
5.2.2
Transmision of unacknowledged information................................................51
5.2.3
Receipt of unacknowledged information .......................................................51
5.3
Terminal Endpoint Identifier (TEI) management procedures.............................................51
5.3.1
General..........................................................................................................51
5.3.2
TEI assignment procedure............................................................................52
5.3.2.1
Expiry of timer T202 ............................................................54
5.3.3
TEI check procedure.....................................................................................54
5.3.3.1
Use of the TEI check procedure..........................................54
5.3.3.2
Operation of the TEI check procedure ................................55
5.3.4
TEI removal procedure..................................................................................56
5.3.4.1
Action taken by the data link layer entity receiving the
MDL-REMOVE-REQUEST primitive ...................................56
5.3.4.2
Conditions for TEI removal..................................................56
5.3.5
TEI identity verify procedure..........................................................................57
5.3.5.1
General................................................................................57
5.3.5.2
Operation of the TEI identity verify procedure .....................57
5.3.5.3
Expiry of timer T202 ............................................................58
5.3.6
Formats and codes .......................................................................................58
5.3.6.1
General................................................................................58
5.3.6.2
Layer management entity identifier......................................59
5.3.6.3
Reference number (Ri)........................................................59
5.3.6.4
Message type ......................................................................59
5.3.6.5
Action indicator (Ai)..............................................................59
5.4
Automatic negotiation of data link layer parameters..........................................................60
5.5
Procedures for establishment and release of multiple frame operation ............................60
5.5.1
Establishment of multiple frame operation....................................................60
5.5.1.1
General................................................................................60
5.5.1.2
Establishment procedures...................................................60
5.5.1.3
Procedure on expiry of timer T200 ......................................61
5.5.2
Information transfer.......................................................................................61
5.5.3
Termination of multiple frame operation........................................................61
5.5.3.1
General................................................................................61
5.5.3.2
Release procedure ..............................................................61
5.5.3.3
Procedure on expiry of timer T200 ......................................62
5.5.4
TEI-assigned state ........................................................................................62
5.5.5
Collision of unnumbered commands and responses....................................62
5.5.5.1
Identical transmitted and received commands....................62
5.5.5.2
Different transmitted and received commands....................63
Page 6
ETS 300 125: September 1991
5.5.6
Unsolicited DM response and SABME or DISC command .......................... 63
5.6
Procedures for information transfer in multiple frame operation....................................... 63
5.6.1
Transmitting I frames.................................................................................... 63
5.6.2
Receiving I frames........................................................................................ 63
5.6.2.1
P bit set to 1 ........................................................................ 63
5.6.2.2
P bit set to 0 ........................................................................ 64
5.6.3
Sending and receiving acknowledgements .................................................. 64
5.6.3.1
Sending acknowledgements............................................... 64
5.6.3.2
Receiving acknowledgements ............................................ 64
5.6.4
Receiving REJ frames .................................................................................. 64
5.6.5
Receiving RNR frames ................................................................................. 65
5.6.6
Data link layer own receiver busy condition.................................................. 67
5.6.7
Waiting acknowledgement............................................................................ 67
5.7
Re-establishment of multiple frame operation .................................................................. 68
5.7.1
Criteria for re-establishment ......................................................................... 68
5.7.2
Procedures ................................................................................................... 68
5.8
Exception condition reporting and recovery ...................................................................... 69
5.8.1
N(S) sequence error ..................................................................................... 69
5.8.2
N(R) sequence error..................................................................................... 69
5.8.3
Timer recovery condition .............................................................................. 69
5.8.4
Invalid frame condition.................................................................................. 70
5.8.5
Frame rejection condition ............................................................................. 70
5.8.6
Receipt of an FRMR response frame........................................................... 70
5.8.7
Unsolicited response frames ........................................................................ 70
5.8.8
Multiple-assignment of TEI value.................................................................. 71
5.9
List of system parameters................................................................................................. 71
5.9.1
Timer T200 ................................................................................................... 71
5.9.2
Maximum number of retransmissions (N200) .............................................. 71
5.9.3
Maximum number of octets in an information field (N201)........................... 72
5.9.4
Maximum number of transmission of the TEI identity request message
(N202)........................................................................................................... 72
5.9.5
Maximum number of outstanding I frames (k).............................................. 72
5.9.6
Timer T201 ................................................................................................... 72
5.9.7
Timer T202 ................................................................................................... 72
5.9.8
Timer T203 ................................................................................................... 72
5.10
Data link layer monitor function......................................................................................... 73
5.10.1
General......................................................................................................... 73
5.10.2
Data link layer supervision in the multiple-frame-established state.............. 73
5.10.3
Connection verification procedures .............................................................. 73
5.10.3.1
Start timer T203 .................................................................. 73
5.10.3.2
Stop Timer T203 ................................................................. 74
5.10.3.3
Expiry of timer T203............................................................ 74
Annex A (to Recommendation Q.921) Provision of point-to-point signalling connections.......................... 75
Annex B (to Recommendation Q.921) SDL for point-to-point procedures ................................................. 76
B.1
General............................................................................................................................................. 76
B.2
An overview of the states of the point-to-point data link layer entity................................................. 76
B.3
Cover notes ...................................................................................................................................... 79
B.4
The use of queues............................................................................................................................ 80
B.5
SDL representation........................................................................................................................... 81
Annex C (to Recommendation Q.921) An SDL representation of the broadcast procedures of the data
link layer ............................................................................................................................... 109
Annex D (to Recommendation Q.921) State transition table of the point-to-point procedures of the data
link layer ............................................................................................................................... 110
Page 7
ETS 300 125: September 1991
D.1
State transition table........................................................................................................................110
D.2
Key to the state transition table .......................................................................................................111
D.2.1
Definition of a cell of the state transition table .................................................................111
D.2.2
Key to the contents of a cell.............................................................................................111
Appendix I (to Recommendation Q.921) Retransmission of REJ response frames .................................143
I.1
Introduction......................................................................................................................................143
I.2
Procedure........................................................................................................................................143
Appendix II (to Recommendation Q.921) Occurence of MDL-ERROR-INDICATION within the basic
states and actions to be taken by the management entity....................................................144
II.1 Introduction..........................................................................................................................................144
II.2 Layout of table II-1/Q.921 ....................................................................................................................144
II.3 Preferred management actions...........................................................................................................144
Appendix III (to Recommendation Q.921) Optional basic access deactivation procedures......................146
III.1 Introduction.........................................................................................................................................146
III.2 Description of the conceptual model ..................................................................................................146
III.3 Deactivation procedure with MPH-DEACTIVATE-INDICATION ........................................................147
III.4 Deactivation procedure without MPH-DEACTIVATE-INDICATION ...................................................149
Appendix IV (to Recommendation Q.921) Automatic negotiation of data link layer parameters ..............150
IV.1 General ..............................................................................................................................................150
IV.2 Parameter initialisation.......................................................................................................................150
IV.3 Internal parameter initialisation ..........................................................................................................150
IV.4 Automatic notification of data link layer parameter values.................................................................150
History........................................................................................................................................................153
Page 8
ETS 300 125: September 1991
Blank Page
Page 9
ETS 300 125: September 1991
Foreword
This European Telecommunication Standard (ETS) has been produced by the Signalling, Protocols and
Switching (SPS) Technical Committee of the European Telecommunications Standard Institute (ETSI),
and was adopted, having passed through the ETSI standards approval procedure.
This ETS is a revised version of CEPT Recommendation T/CS 46-20 (Edition of December 15, 1987;
Revision 1988). It is based on the CCITT Recommendations Q.920/I.440 and Q.921/I.441 versions
according to the BLUE BOOK, Vol. VI, Fascicle VI.10. It is intended to reduce the number of options which
exist within CCITT Recommendations Q.920/I.440 and Q.921/I.441 and to provide the additional
specification text necessary for clarification as well as to ensure harmonisation of the ISDN user-network
interface within Europe.
All procedures at the ISDN user-network interface apply to both, the S and T reference points.
CCITT Recommendations Q.920/I.440 and Q.921/I.441 apply with the modifications specified below. The
modifications are presented based on the CCITT Recommendations according to the BLUE BOOK, Vol.
VI, Fascicle VI.10.
The following editorial conventions have been applied:
-
the layout of this standard is aligned with CCITT Recommendations Q.920/I.440 and Q.921/I.441
according to the BLUE BOOK, Vol. VI, Fascicle VI.10, exept modifications which require additional
sections or figures and tables;
-
modifications made for the sake of consistency and clarification are indicated by a revision bar in
the left margin;
-
modifications to select options for networks are indicated by a revision bar in the left margin or
encircled by asterisks;
-
editorial modifications are indicated by a revision bar in the right margin.
In addition this standard is based on the following considerations:
(a)
CCITT Recommendations Q.920/I.440 and Q.921/I.441 define the ISDN user-network interface
data link layer;
(b)
there are a number of options and points requiring further specification in Recommendations
Q.920/I.440 and Q.921/I.441;
(c)
the harmonisation of the ISDN user-network interface is an important requirement for European
network operators;
(d)
European network operators who wish to provide ISDN services should apply the CCITT
Recommendations Q.920/I.440 and Q.921/I.441 in accordance with the specification defined below.
NOTE:
Some references in this standard reflect the fact that the text was initially produced in
CEPT working groups. For practical reasons it has not always been possible to re-edit
the text appropriately at this stage.
Scope
This standard specifies the user-network interface data link layer of the pan European Integrated Services
Digital Network (ISDN) as provided by European public telecommunication operators at the T reference
point or coincident S and T reference point (as defined in CCITT Recommendation I.411 [13] by means of
Digital Subscriber Signalling System No. 1 (DSS1).
Page 10
ETS 300 125: September 1991
Blank page
Page 11
ETS 300 125: September 1991
PART 1: Application of CCITT Recomendation Q.920(I.440)
ISDN user-network interface data link layer - General aspects
1
General
This Recommendation describes in general terms the Link Access Procedure on the D-channel, LAPD.
The application of this protocol to other channel types is for further study. Details are provided in
Recommendation Q.921(I.441) [1].
The purpose of LAPD is to convey information between layer 3 entities across the ISDN user-network
interface using the D-channel.
The definition of LAPD takes into consideration the principles and terminology of:
-
Recommendations X.200 [2] and X.210 [3] - the reference model and layer service conventions for
Open Systems Interconnection (OSI);
-
Recommendation X.25 [4] - LAPB user-network interface for packet mode terminals; and
-
ISO 3309 [5] and ISO 4335 [6] - High-level Data Link Control (HDLC) standards for frame structure
and elements of procedures.
LAPD is a protocol that operates at the data link layer of the OSI architecture. The relationship between
the data link layer and other protocol layers is defined in Recommendation I.320 [7].
NOTE 1:
The physical layer is currently defined in Recommendations I.430 [8] and I.431 [9], and
prETS 300 012 [14] and prETS 300 011 [15], respectively, and layer 3 is defined in
Recommendations Q.930 (I.450) [10], Q.931 (I.451) [11] and ETS 300 102-1 [16], ETS
300 102-2 [17], and X.25 [4]. References should be made to these Recommendations
for the complete definition of the protocols and procedures across the ISDN user-
network interface.
NOTE 2:
The term "data link layer" is used in the main text of this Recommendation. However,
mainly in figures and tables, the terms "layer 2" and "L2" are used as abbreviations.
Furthermore, in accordance with Recommendations Q.930 (I.450) [10] and Q.931
(I.451) [11], and ETS 300 102-1 [16] and ETS 300 102-2 [17], the term "layer 3" is
used to indicate the layer above the data link layer.
LAPD is independent of transmission bit rate. It requires a duplex, bit transparent D-
channel.
The characteristics of the D-channel are defined in Recommendation I.412 [12].
§ 2
below
describes
basic
concepts
used
in
this
Recommendation
and
Recommendation Q.921.
§ 3 gives an overview description of LAPD functions and procedures.
§ 4 summarises the services that the data link layer provides to layer 3 and the
services that the data link layer requires from the physical layer.
§ 5 provides an overview of the data link layer structure.
2
Concepts and terminology
The basic structuring technique in the OSI reference model is layering. According to this technique,
communication among application processes is viewed as being logically partitioned into an ordered set of
layers represented in a vertical sequence as shown in figure 1/Q.920.
A data link layer Service Access Point (SAP) is the point at which the data link layer provides services to
layer 3. Associatied with each data link layer SAP is one or more data link connection endpoint(s). See
Page 12
ETS 300 125: September 1991
figure 2/Q.920. A data link connection endpoint is identified by a data link connection endpoint identifier as
seen from layer 3 and by a Data Link Connection Identifier (DLCI) as seen from data link layer.
Entities exist in each layer. Entities in the same layer, but in different systems which must exchange
information to achieve a common objective are called "peer entities". Entities in adjacent layers interact
through their common boundary. The services provided by the data link layer are the combination of the
services and functions provided by both the data link layer and the physical layer.
System management
LM Layer management (see figure 10/Q .920)
Highest layer
(N+1) layer
(N) layer
(N-1) layer
Lowest layer
LM
LM
LM
LM
LM
Figure 1/Q.920: Layering
Layer 3
Data link layer
Layer 3
entity
Data link layer
entity
Data link layer service
access point
Data link connection
endpoint
\*
Figure 2/Q.920: Entities, service access points and endpoints
Cooperation between data link layer entities is governed by a peer-to-peer protocol specific to the layer. In
order for information to be exchanged between two or more layer 3 entities, an association must be
established between the layer 3 entities in the data link layer using a data link layer protocol. This
association is called a data link connection. Data link connections are provided by the data link layer
between two or more SAPs (see figure 3/Q,920).
Page 13
ETS 300 125: September 1991
\*
\*
Layer 3
entity
Layer 3
entity
Data link layer
service access
point
Data link
connection
endpoint
Data link connection
Figure 3/Q.920: Peer-to-peer relationship
Data link layer message units are conveyed between data link layer entities by means of a physical
connection.
Layer 3 requests services from the data link layer via service primitives. The same applies for the
interaction between the data link layer and the physical layer. The primitives represent, in an abstract way,
the logical exchange of information and control between the data link layer and adjacent layers. They do
not specify or constrain implementation.
The primitives that are exchanged between the data link layer and adjacent layers are of the following four
types (see also figure 4/Q.920):
a)
REQUEST;
b)
INDICATION;
c)
RESPONSE; and
d)
CONFIRM.
Layer 3
C O NF IR M
R E QU ES T
IN D IC AT IO N
R ES PO N SE
S AP
Data link layer
Data link layer
p eer - to - peer
protocol
\*
\*
NOTE 1:
The same principle applies for data link layer - physical layer interactions.
Figure 4/Q.920: Primitive action sequence:
Page 14
ETS 300 125: September 1991
The REQUEST primitive type is used when a higher layer is requesting a service from the next lower
layer.
The INDICATION primitive type is used by a layer providing a service to notify the next higher layer of any
specific activity which is service related. The INDICATION primitive may be the result of an activity of the
lower layer related to the primitive type REQUEST at the peer entity.
The RESPONSE primitive type is used by a layer to acknowledge receipt, from a lower layer, of the
primitive type INDICATION.
The CONFIRM primitive type is used by the layer providing the requested service to confirm that the
activity has been completed.
Layer-to-layer interactions are specified in Recommendation Q.921.
Information is transferred, in various types of message units, between peer entities and between entities in
adjacent layers that are attached to a specific SAP. The message units are of two types:
-
message units of a peer-to-peer protocol; and
-
message units that contain layer-to-layer information concerning status and specialised service
requests.
The message units of the layer 3 peer-to-peer protocol are carried by the data link connection. The
message units containing layer-to-layer information concerning status and specialised service requests
are never conveyed over a data link connection or a physical connection.
This Recommendation specifies (see also figure 5/Q.920):
a)
the peer-to-peer protocol for the transfer of information and control between any pair of data link
layer service access points; and
b)
the interactions between the data link layer and layer 3, and between the data link layer and the
physical layer.
\*
Layer 3
entity
Layer 3
entity
Data link
layer entity
Data link
layer entity
Physical
layer entity
Physical
layer entity
Data link layer
service access point
Data link layer
Peer-to-peer protocol
Physical layer
service access point
Physical connection
Data link layer /
layer 3
primatives
Data link layer /
physical layer
primatives
\*
\*
\*
Figure 5/Q.929: Data link layer reference model
Page 15
ETS 300 125: September 1991
3
Overview description of LAPD functions and procedures
3.1
General
The purpose of LAPD is to convey information between layer 3 entities across the ISDN user-network
interface using the D-channel. Specifically LAPD will support:
-
multiple terminal installations at the user-network interface;
-
multiple layer 3 entities.
All data link layer messages are transmitted in frames which are delimited by flags. (A flag is a unique bit
pattern.) The frame structure is defined in Recommendation Q.921.
LAPD includes functions for:
a)
the provision of one or more data link connections on a D-channel. Discrimination between the data
link connnections is by means of a data link connection identifier (DLCI) contained in each frame;
b)
frame delimiting, alignment and transparency, allowing recognition of a sequence of bits transmitted
over a D-channel as a frame;
c)
sequence control, to maintain the sequential order of frames across a data link connection;
d)
detection of transmission, format and operational errors on a data link connection;
e)
recovery from detected transmission, format, and operational errors;
f)
notification to the management entitiy of unrecoverable errors; and
g)
flow control.
Data link layer functions provide the means for information transfer between multiple combinations of data
link connection endpoints. The information transfer may be via point-to-point data link connections or via
broadcast data link connections. In the case of point-to-point information transfer, a frame is directed to a
single endpoint, while in the case of broadcast information transfer, a frame is directed to one or more
endpoints.
Figure 6/Q.920 shows three examples of point-to-point information transfer. Figure 7/Q.920 shows an
example of broadcast information transfer.
Page 16
ETS 300 125: September 1991
\*
\*
\*
\*
\*
\*
\*
\*
\*
\*
\* \*
\*
\*
\*
\*
\*
\*
\*
\*
\*
\*
U ser side
N etw ork side
TE
TE(1)
ET/NT2
Data
link
layer
TE
ET/N T2
Layer 3
TE (2)
ET/NT2
SAPx
(a)
Layer 3
Data
link
layer
TE(1)
TE(2)
ET/N T2
SAPx
(b)
TE(1)
TE(2)
ET/NT2
TE(1)
TE(2)
ET/N T2
SAPx
SAPx
Layer3
Data
link
layer
(c)
Physical connection
Data link connection
ET Exchange term ination
TE Term inal equipm ent
NT Network term ination
SAP Service access point
Figure 6/Q.920: Point-to-point data link connections
Page 17
ETS 300 125: September 1991
\*
\*
\*
\*
\*
\*
\*
\*
U ser side
Network side
TE(1)
TE(2)
ET/NT2
Layer 3
Data
link
layer
B
B
B
TE(1)
TE(2)
ET/N T2
SA Px
SAPx
SAPx
Physical connection
Data link connection
B = Broadcast
Figure 7/Q.920: Broadcast data link connection
Two types of operation of the data link layer are defined for layer 3 information transfer: unacknowledged
and acknowledged. They may coexist on a single D-channel.
3.2
Unacknowledged operation
With this type of operation layer 3 information is transmitted in Unnumbered Information (UI) frames.
At the data link layer the UI frames are not acknowledged. Even if transmission and format errors are
detected, no error recovery mechanism is defined. Flow control mechanisms are not defined.
Unacknowledged operation is applicable for point-to-point and broadcast information transfer; that is, a UI
frame may be sent to a specific endpoint or broadcast to multiple endpoints associated with a specific
Service Access Point Identifier (SAPI).
3.3
Acknowledged operation
With this type of operation, layer 3 information is transmitted in frames that are acknowledged at the data
link layer.
Error recovery procedures based on retransmission of unacknowledged frames are specified. In the case
of errors which cannot be corrected by the data link layer, a report to the management entity is made.
Flow control procedures are also defined.
Acknowledged operation is applicable for point-to-point information transfer. One form of acknowledged
information transfer is defined, multiple frame operation.
Layer 3 information is sent in numbered Information (I) frames. A number of I frames may be outstanding
at the same time. Multiple frame operation is initiated by a multiple frame establishment procedure using a
Set Asynchronous Balanced Mode Extended (SABME) command.
3.4
Establishment of information transfer modes
3.4.1
Data link connection identification
A data link connection is identified by a Data Link Connection Identifier (DLCI) carried in the address field
of each frame.
The data link connection identifier is associated with a connection endpoint identifier at the two ends of the
data link connection (see figure 8/Q.920).
Page 18
ETS 300 125: September 1991
The connection endpoint identifier is used to identify message units passed between the data link layer
and layer 3. It consists of the SAPI and the Connection Endpoint Suffix (CES).
The DLCI consists of two elements: the SAPI and the Terminal Endpoint Identifier (TEI).
The SAPI is used to identify the service access point on the network side or the user side of the user-
network interface.
The TEI is used to identify a specific connection endpoint within a service access point.
The TEI is assigned by the network, if the user equipment is of the automatic TEI assignment category, or
it is entered into the user equipment, for example, by the user or the manufacturer, if the user equipment
is of the non-automatic TEI assignment category (see § 3.4.3).
The DLCI is a pure data link layer concept. It will be internally used by the data link layer entitiy and is not
known by the layer 3 entity or management entity. In these latter entities, the concept of Connection
Endpoint Identifier (CEI) will be used instead.
The CEI is composed of the SAPI information and a reference value named CES. The CES is a value
selected by the layer 3 or management entity to address the data link layer entity. When the relevant TEI
is known by this entity, it will internally associate the DLCI to the CEI. The layer 3 and management
entities will use this CEI to address its peer entity.
3.4.2
Data link states
A point-to-point data link entity may be in one of three basic states:
a)
TEI-unassigned state. In this state a TEI has not been assigned. No layer 3 information transfer is
possible; or
b)
TEI-assigned state. In this state a TEI has been assigned by means of the TEI assignment
procedure. Unacknowledged information transfer is possible; or
c)
multiple-frame-established state. This state is established by means of a multiple frame
establishment procedure. Acknowledged and unacknowledged information transfer are possible.
NOTE:
For the detailed description of procedures in Recommendation Q.921, an expansion of
the basic set of states listed above is required.
A broadcast data link entity is always in an information transfer state capable of only unacknowledged
information transfer (that is, TEI-assigned state).
Page 19
ETS 300 125: September 1991
Packet
D ata
Signalling
inform ation
Signalling
inform ation
Layer 3
D ata
link
layer
D ata
link
layer
TEI = 88
TEI = 127
C ustom er prem ises
U ser
1
B
16
B
0
TE (1)
TE (2)
TEI = 88
TEI = 127
TEI = 127
\*
\*
\*
\*
\*
\*
\*
TEI = 3
TEI = 8
SAPI = 0
SAPI = 16
D ata
link
layer
Layer 3
Signalling
inform ation
Packet
D ata
Layer 3
B
1
2
0
D -channel
3
2
1
B
1
B
SAP
identifier
C ES
ET/N T2
N etwork
\*
\*
\*
\*
\*
\*
Key:
Broadcast data link connection (B)
Point-to-point data link connection
D C LI = SAPI + TEI
C EI = SAPI + C ES
N ote 1 - The m anagem ent entity is not shown in this figure.
N ote 2 - The selection of the SAPI and TEI values is based on
R ecom m endation Q.921 § 3.3.3 and § 3.3.4.2 respectively.
Figure 8/Q.920
Overview description of the relationship between SAPI, TEI and DCLI
3.4.3
TEI administration
The purpose of the TEI assignment procedure is to allow user equipment to obtain a TEI value that the
data link layer entities within the user equipment will use in subsequent communications over the data link
connections.
The TEI value is typically common to all SAPs (if more than one) in a user equipment. The procedure is
conceptually located in the management entity.
When a TEI has been assigned, the user equipment establishes an association between the TEI and a
CES in each SAP (that is, the DLCI is associated with a CEI). In the network, the corresponding
association is made upon reception of the first frame containing the assigned TEI, or at the time of TEI
assignment
At that point in time, a data link layer peer-to-peer association has been formed.
The association between the DLCI and CEI will be removed by the TEI removal procedures on request
from the management entity when recognising that the TEI value is no longer valid.
When in the TEI-assigned state or the multiple-frame-established state, the TEI check procedure may be
used by the network to check the status of a TEI (for example, to determine if a user equipment has been
disconnected from an installation). Optionally, the user equipment may request the network to initiate the
TEI check procedure.
Examples of criteria for initiation of TEI assignment procedure, the TEI check procedure, and the TEI
removal procedures are described in Recommendation Q.921.
NOTE:
This section is not intended to provide a complete specification of possible criteria for
establishing and removing an association between the DLCI and CEI.
Page 20
ETS 300 125: September 1991
3.4.4
Establishment of multiple frame operation
Before point-to-point acknowledged information transfer can start an exchange of a SABME frame and an
Unnumbered Acknowledgement (UA) frame must take place.
The multiple frame establishment procedure is specified in detail in Recommendation Q.921.
4
Service characteristics
4.1
General
The data link layer provides services to layer 3 and management (of layer 2) and utilises the services
provided by the physical layer and layer management. A formal description of the data link layer service
provided to layer 3 and layer management is given in § 4.2 and § 4.3, respectively. The layer management
service provided to the data link layer is given in § 4.4.
NOTE:
Communication between different layers in the OSI reference model makes use of
primitives which are passed across the layer boundaries. The data link layer primitives
defined in this Recommendation represent, in an abstract way, the logical exchange of
information and control between the data link layer and adjacent layers. They do not
specify nor constrain implementations.
4.2
Services provided to layer 3
The specification of the interactions with layer 3 (primitives) provides a description of the services that the
data link layer, plus the physical layer, offer to layer 3, as viewed from layer 3.
Two forms of information transfer service are associated with layer 3. The first is based on
unacknowledged information transfer at the data link layer while the second service is based on
acknowledged information transfer at the data link layer.
Layer 3 message units are handled according to their respective layer 2 priority (see § 5.2).
4.2.1
Unacknowledged information transfer service
NOTE:
In this case the information transfer is not acknowledged at the data link layer.
Acknowledgement procedures may be provided at higher layers.
The information transfer is via broadcast or point-to-point data link connections.
The characteristics of the unacknowledged information transfer service are summarised in the following:
a)
provision of a data link connection between layer 3 entities for unacknowledged information transfer
of layer 3 message units;
b)
identification of data link connection endpoints; and
c)
no verification of message arrival within the peer data link layer entity.
The primitives asociated with the unacknowledged information transfer service are:
DL-UNIT DATA-REQUEST/INDICATION
The DL-UNIT DATA-REQUEST primitive is used to request that a message unit be sent using the
procedures for unacknowledged information transfer service. The DL-UNIT DATA-INDICATION primitive
indicates the arrival of a message unit received by means of unacknowledged information transfer
service.
4.2.2
Acknowledged information transfer service
One mode of operation is defined, multiple frame.
Page 21
ETS 300 125: September 1991
The characteristics of the acknowledged information transfer service are summarised in the following:
a)
provision of a data link connection between layer 3 entities for acknowledged information transfer of
layer 3 message units;
b)
identification of data link connection endpoints;
c)
sequence integrity of data link layer message units in the absence of malfunctions;
d)
notification to the peer entity in the case of errors, for example, loss of sequence;
e)
notification to the management entity of unrecoverable errors detected by the data link layer; and
f)
flow control.
The primitives asociated with the acknowledged information transfer services are:
i)
data transfer:
DL-DATA-REQUEST/INDICATION
The DL-DATA-REQUEST primitive is used to request that a message unit be sent using the
procedures for the acknowledged information transfer service. The DL-DATA-INDICATION
primitive indicates the arrival of a message unit received by means of the acknowledged information
transfer service.
ii)
establishment of multiple frame operation:
DL-ESTABLISH-REQUEST/INDICATION/CONFIRM
These primitives are used, respectively, to request, indicate and confirm the establishment of
multiple frame operation between two service access points.
iii)
termination of multiple frame operation:
DL-RELEASE-REQUEST/INDICATION/CONFIRM
These primitives are used, respectively, to request, indicate and confirm an attempt to terminate
multiple frame operation between two service access points.
4.3
Services provided to layer management
Only the unacknowledged information transfer service is provided to layer management in order that the
data link layer management can commmunicate with its peer layer management.
NOTE:
In this case the information transfer is not acknowledged at the data link layer.
Acknowledgement procedures may be provided by layer management.
The information transfer is via broadcast connections, but in principle information transfer can also be via
point-to-point connections (no application for data transfer via point-to-point connections has been
identified or included in Recommendation Q.921).
The characteristics of the unacknowledged information transfer service are summarised in the following:
a)
provision of a data link connection between layer management entities for unacknowledged
information transfer of data units;
b)
identification of data link connection endpoints; and
c)
no verification of message arrival within the peer data link layer entity.
The primitives associated with the unacknowledged information transfer service provided for layer
management are:
Page 22
ETS 300 125: September 1991
MDL-UNIT DATA-REQUEST/INDICATION
The MDL-UNIT DATA-REQUEST primitive is used to request that a message unit be sent using the
procedure for unacknowledged information transfer service for layer management. The MDL-UNIT DATA-
INDICATION primitive indicates the arrival of a message unit received by means of the unacknowledged
information transfer service to layer management.
4.4
Administrative services
The characteristics of the administrative services currently recognised are summarised in the following:
a)
assignment, checking, and removal of TEI values; and
b)
data link connection parameter passing (an optional service performed on a per connection basis).
This service is currently not supported by European networks.
These services are considered to be conceptually provided by layer management either on the user side
or the network side. The method or describing these administrative functions uses service primitives.
The primitives associated with these services are:
i)
assignment of TEI value:
MDL-ASSIGN-REQUEST/INDICATION
The MDL-ASSIGN-INDICATION primitive is used to indicate to the layer management the need for
a TEI value. The MDL-ASSIGN-REQUEST primitive is used to pass the TEI value from the layer
management to the data link layer in order that the user data link layer entities can begin to
communicate with the network data link layer entities.
ii)
removal of TEI value:
MDL-REMOVE-REQUEST
This primitive is used to convey a layer management function request for removal of a TEI value
that has been previously asigned via the MDL-ASSIGN primitives.
iii)
notification of error:
MDL-ERROR-INDICATION/RESPONSE
These primitives are used to report error situations between layer management and the data link
layer entities.
4.5
Model of the data link service:
4.5.1
General
The ability of the data link layer to execute a service request by layer 3 depends on the internal state of the
data link layer. For each layer 3 entity, the internal state of the data link layer is represanted by the state of
that data link connection endpoint within a data link service access point which is used by this layer 3
entity to invoke a service.
Consequently, the data link service may be defined by means of data link connection endpoint states,
whereby the capabilities provided by the data link layer and the service primitives may be related to these
states.
In order to allow a data link service user to invoke a service making use of primitives, the DL-primitives
defined in Recommendation Q.921 have to be related to: point-to-point data link connections
(acknowledged or unacknowledged transfer of information) and/or broadcast data link connections
(unacknowledged transfer of information) (see table 1/Q.920).
Page 23
ETS 300 125: September 1991
An unconfirmed service is defined as a service which does not result in an explicit confirmation. A
confirmed service is defined as a service which results in an explicit confirmation from the service-
provider. There is not necessarily any relationship to a response from the peer service-user.
Table 1/Q.920: Applicability of DL-primitives to information transfer modes
Generic name of the
Point-to-point information transfer mode
Broadcast information
DL-primitive
Acknowledged
Unacknowledged
transfer mode
ESTABLISH
Confirmed service
RELEASE
Confirmed service
DATA
Unconfirmed service
UNIT DATA
Unconfirmed service
Unconfirmed service
4.5.2
Data link layer representation as seen by layer 3
4.5.2.1
Data Link Connection Endpoint States
The states of data link connection endpoint may be derived from the internal states of the data link layer
entity supporting this type of a data link connection.
4.5.2.2
Broadcast data link layer connection services
A broadcast data link connection provides an unacknowledged information transfer service. Within each
data link service access point, there is only one broadcast data link connection endpoint.
The broadcast data link connection endpoint is always in the information transfer state.
4.5.2.3
Point-to-point data link connection endpoint services
A point-to-point data link connection provides both an unacknowledged and acknowledged information
transfer service. Within each data link service access point, one or more than one data link connection
endpoint may be present, each identified by a CES.
The acknowledged information transfer service, in addition, implies the presence or the services link
establishment, link re-establishment and link release.
The point-to-point data link connection endpoint states are:
-
link connection released state;
-
awaiting establish state;
-
awaiting release state;
-
link connection established state.
4.5.2.4
Sequences of primitives at one point-to-point data link connection endpoint
The primitives provide the procedural means to specify conceptually how a data link service user can
invoke a service.
This section defines the constraints on the sequence in which the primitives may occur. The sequences
are related to the states at one point-to-point data link connection endpoint.
The possible overall sequences of primitives at a point-to-point data link connection endpoint are defined
in the state transition diagram, figure 9/Q.920. The link connection released and link connection
established states are stable states whilst the awaiting establish and awaiting release states are transition
states.
Page 24
ETS 300 125: September 1991
4.6
Services required from the physical layer
The services provided by the physical layer are described in detail in Recommendation I.430 [8] or I.431
[9] and prETS 300 012 [14] or prETS 300 011 [15], respectively. They are summarised in the following:
a)
physical layer connection for the transparent transmission of bits in the same order in which they
are submitted to the physical layer;
b)
indication of the physical status of the D-channel; and
c)
transmission of data link layer message units according to their respective data link layer priority.
Some of the above services may be implemented in the management entity on the user side or network
side. The method of describing these services is by means of service primitives.
The primitives between the data link layer and the physical layer are:
i)
PH-DATA-REQUEST/INDICATION:
These primitives are used to request that a message unit be sent and to indicate the arrival of a
message unit.
ii)
activation:
PH-ACTIVATE-REQUEST/INDICATION
These primitives are used to request activation of the physical layer connection, and to indicate that
the physical layer connection has been activated.
iii)
deactivation:
PH-DEACTIVATE-INDICATION
This primitive is used to indicate that the physical layer connection has been deactivated.
The primitives between management entities and the physical layer are:
i)
activation:
MPH-ACTIVATE-INDICATION
This primitive is used to indicate that the physical layer connection has been activated.
ii)
deactivation:
MPH-DEACTIVATE-REQUEST/INDICATION
These primitives are used to request deactivation of the physical layer connection and to indicate
that the physical layer connection has been deactivated. The REQUEST is used at the network side
only.
iii)
MPH-INFORMATION-INDICATION:
This primitive is used to indicate to user management entities information regarding the physical
layer condition. Two parameters are defined: connected and disconnected.
5
Data link layer - Management structure
The data link layer - management structure is shown in figure 10/Q.920. This figure is a model shown for
illustrative purposes only, and does not constrain implementations.
The Layer Management Entity (LME) provides for the management of resources that have a layer-wide
impact. Access to the LME is provided by means of a specific SAPI. Functions provided by the LME are:
Page 25
ETS 300 125: September 1991
-
TEI assignment;
-
TEI check;
-
TEI removal.
The Connection Management Entity (CME) provides for the management of resources that have an
impact on individual connections. Selection of the CME is based on a specific data link layer frame type
not used in the acknowledged or unacknowledged information transfer services. Functions provided by
the CME are:
-
parameter initialisation (optional);
-
error processing;
-
connection flow control invocation.
DL-ESTABLIS H
INDICATIO N
DL-UN IT DATA
REQ ./IN D .
DL-ESTABLISH -CO NFIRM
DL-ESTABLIS H-R EQ UEST N ote
D L-ESTABLIS H
IND ICATIO N
Note
DL-ESTABLIS H
CO N FIRM
Note
DL-R ELEASE REQ UEST Note
LINK C O NN EC TIO N
ESTABLISH ED
AW AITING
ESTABLISH
AW AITIN G
RELEASE
DL-
DATA-
REQ ./IN D.
DL-UNIT
D ATA-
REQ ./IN D .
DL-ESTABLISH-
CO NFIRM
DL-RELEAS E-
INDICA TIO N
DL-UN IT DATA-
REQ ./IN D.
DL-ESTABLISH -
INDICATIO N
DL-RE LEAS E-CO NFIR M
DL-R ELEASE -INDICATIO N
DL-ESTABLISH-REQ UEST
D L-UNIT D ATA -
R EQ ./IN D.
DL-RELEASE -
INDICA TIO N
DL-ESTABLISH -C O NFIRM
DL-ESTABLIS H-IND ICATIO N
DL-RELEASE -INDICATIO N Note
Note - Possible loss of inform ation
LINK C O NN EC TIO N
RELEASED
FIGURE 9/Q.920
State transition diagram for sequences of primitives at a point-to-point data link connection as
seen by layer 3
Page 26
ETS 300 125: September 1991
Layer management
(LM )
M utiplex Procedure
Data link
procedures
Layer 3
Layer 2
k
j
j+1
Data
link entity
Connection
management
entity
(CME)
Data
link entity
1
k
1
SAP 0
SAP n-1
Layer
management
entity
(LME)
B - data
link entity
Note
SAP n
Layer 2
Layer 1
B = Broadcast
Note - The broadcast links for SAPs other than SAP63 are not shown
Figure 10/Q.920: Functional model of the data link layer - Management
5.1
Data link procedure
This procedure analyses the control field of the received frame (see Recommendation Q.921) and
provides appropriate peer-to-peer responses and layer-to-layer indications. In addition, it analyses the
data link layer service primitives and transmits the appropriate peer-to-peer commands and responses.
5.2
Multiplex procedure
This procedure analyses the flag, Frame Check Sequence (FCS), and address octets of a received frame.
If the frame is correct, it distributes the frame to the appropriate data link procedures block based on the
DLCI (see Recommendation Q.921).
On frame transmission, this procedure may provide data link layer contention resolution between the
various data link procedure blocks. The contention resolution is based on the SAPI, giving priority to SAPI
= 0 information.
5.3
Structure of the data link procedure
The functional model of the data link procedure is shown in figure 11/Q.920. The model consists of
several functional blocks for point-to-point and broadcast connections.
Page 27
ETS 300 125: September 1991
x
x
x
CES(0)
CES(1)
CES(n)
SAPn
Broadcast
data link
Point-to-point
data link
Point-to-point
data link
To mutiplex procedure
Data Link Procedures
Figure 11/Q.920: Data link procedure structure
5.4
Additions for European networks
5.4.1
General
CCITT Recommendation Q.920 (I.440) section 5 provides an overview of the data link layer structure and
identifies the layer management and the two procedural types "data link procedures" and "multiplex
procedure". The data link procedures comprise "broadcast link procedures" and "point-to-point link
procedures", the layer management the "layer management entity" and the "connection management
entity".
The data link layer structure represents the framework for the specification of various protocols related to
the data link layer and to define the relationship between the data link layer and adjacent layers such as
layer 3, the physical layer and management entities. The interactions between the data link layer and
adjacent layers are modelled by service primitives.
The functional partitioning of the data link layer into data link procedures and multiplex procedure implies
internal signals which support the communication between these functional blocks.
5.4.2
Enhanced functional block diagram and block interaction diagram
The functional block diagram presented in figure 12 combines the figures 10/Q.920 and 11/Q.920 of
CCITT Recommendation Q.920 (I.440).
The data link layer entity is structured into two main functional blocks: multiplexing and peer-to-peer
protocol handling:
The multiplex procedure maps all the data link connections to one physical D-channel connection. The
multiplex procedure represents the user of the physical D-channel connection on behalf of the various
data link connections, thus has to invoke the physical layer to provide its services if there is at least one
data link connection to be supported. The function activation is conceptually included in the multiplex
procedure.
The peer-to-peer procedures take place as a result of interactions between adjacent entities.
The layer management entity provides administrative services globally to the data link layer entities such
as TEI management.
The connection management entity provides administrative services to each of the data link layer entities.
A block interaction diagram relates the service primitives to these functional blocks which have to interact,
see figure 13. Additional signals are needed for the internal use within the data link layer for the
Page 28
ETS 300 125: September 1991
communication between point-to-point link procedures or broadcast link procedures, respectively, and the
multiplex procedure.
The figure 13 is an aid to illustrate the relationship between various functional blocks. It is not intended to
constrain implementation. The primitives contained in figure 13 are those defined in § 4 (Q.920) of this
Recommendation. Other additional primitives may be defined in other Recommendations eg. dealing with
maintenance requirements.
Page 29
ETS 300 125: September 1991
DAT A LIN K LAY ER S AP
PO IN T-TO -P OINT D ATA LIN K PR O C ED URE S
LINK P RO CE DU RE S
D ATA LINK
LA YE R
LA YER 3
S AP
BR OA DC AST D ATA
LIN K PR OC ED UR ES
MU LTIPLE X PR OC ED UR ES
BR OA DC AS T DATA
SA P D-CH AN NE L
S AP B -C HA NN ELS
P HY SIC AL
LA YE R
S YSTEM
MA NA GE ME NT
LAY ER
M ANA GE M ENT
(LM)
C onnection
M anagement
E ntity
(C ME )
Layer
M anagement
Entity
(LM E)
Figure 12: Functional block diagram of the data link layer
Page 30
ETS 300 125: September 1991
DL-ESTABLISH-REQ
DL-ESTABLISH-CONF
DL-ESTABLISH-IND
DL-RELEASE-R EQ
DL-RELEASE-CONF
DL-RELEASE-IND
DL-DATA-REQ
DL-DATA-IND
DL-UNIT DATA-REQ
DL-UNIT DATA-IND
DL-UNIT DATA-REQ
DL-UNIT DATA-IND
LAYERS
SAPI 0,16
127
BROADCAST DATA
LINK PROCEDURES
POINT-TO-PO INTDATA LINK PROCEDURES
DATA LINK
LAYER
SAPI 63
BRO ADCAST DATA
LINK PROCEDURES
127
M UTIPLEX PROCEDURE
PHYSICAL
LAYER
B
D
LAYER
MANAG EMENT
(LM )
SYSTEM
M ANAG EMENT
MPH-INFORMATION-IND
M PH-DEACTIVATE-REQ
M PH-DEACTIVATE-IND
MPH-ACTIVATE-IND
PH-ACTIVATE-REQ
PH-ACTIVATE-IND
PH-DEACTIVATE-IND
PH-DATA-REQ
M DL-ASSIGN-IND
M DL-ASSIGN-REQ
M DL-ERROR-RESP
M DL-REM OVE-REQ
M DL-UNIT DATA-REQ
M DL-UNIT DATA-IND
MDL-ERROR-IND
Connection
M anagem ent
Entity
(CM E)
0 - 63
64 - 126
Layer
M anagem ent
Entity
(LME)
PH-DATA-IND
Figure 13: Block interaction diagram
Page 31
ETS 300 125: September 1991
References (used in Q.920)
[1]
CCITT Recommendation Q.921 (I.441): "ISDN user-network interface - Data link
layer specification" [Blue Book, Vol. VI, Fascicle VI.10].
[2]
CCITT Recommendation X.200: "Reference model of open systems
interconnection for CCITT applications" [Blue Book, Vol. VIII, Fascicle VIII.4].
[3]
CCITT Recommendation X.210: "Open systems interconnection layer service
definition conventions" [Blue Book, Vol. VIII, Fascicle VIII.4].
[4]
CCITT Recommendation X.25: "Interface between data terminal equipment
(DTE) and data circuit-terminating equipment (DCE) for terminals operating in
the packet mode and connected to public data networks by dedicated circuit"
[Blue Book, Vol. VIII, Fascicle VIII.2].
[5]
ISO 3309: "Data communication - High-level data link control procedures -
Frame structure".
[6]
ISO 4335: "Data communication - High-level data link control procedures -
Consolidation of elements of procedures".
[7]
CCITT Recommendation I.320: "ISDN protocol reference model" [Blue Book,
Vol. III, Fascicle III.8].
[8]
CCITT Recommendation I.430: "Basic user-network interface - Layer 1
specification" [Blue Book, Vol. III, Fascicle III.8].
[9]
CCITT Recommendation I.431: "Primary rate user-network interface - Layer 1
specification" [Blue Book, Vol. III, Fascicle III.8].
[10]
CCITT Recommendation Q.930 (I.450): "ISDN user-network interface layer 3 -
General aspects" [Blue Book, Vol. VI, Fascicle VI.11].
[11]
CCITT Recommendation Q.931 (I.451): "ISDN user-network interface layer 3
specification for basic call control" [Blue Book, Vol. VI, Fascicle VI.11].
[12]
CCITT Recommendation I.412: "ISDN user-network interfaces - Interface
structures and access capabilities" [Blue Book, Vol. III, Fascicle III.8].
[13]
CCITT Recommendation I.411: "ISDN user-network interfaces - Reference
configurations" [Blue Book, Vol. III, Fascicle III.8].
[14]
prETS 300 012 (T/L 03-07), March 1990: "Integrated Services Digital network
(ISDN); Basic user-network interface layer 1 specification and test principles".
[15]
prETS 300 011 (T/L 03-14), March 1990: "Integrated Services Digital network
(ISDN); Primary rate user-network interface layer 1 specification and test
principles".
[16]
ETS 300 102-1 (1990): "Integrated Services Didital Network (ISDN); User-
network interface layer 3; Specifications for basic call control - Application of
CCITT Recommendations Q.930/I.450 and Q.931/I.451".
[17]
ETS 300 102-2 (1990): "Integrated Services Digital Network (ISDN); User-
network interface layer 3; Specifications for basic call control; Specification
Description Language (SDL) diagrams - Application of CCITT Recommendation
Q.931/I.451 Annex A".
Page 32
ETS 300 125: September 1991
PART 2: Application of CCITT Recomendation Q.921(I.441)
ISDN user-network interface - Data link layer specification
1
General
This Recommendation specifies the frame structure, elements of procedure, format of fields, and
procedures for the proper operation of the Link Access Procedure on the D-channel, LAPD.
The concepts, terminology, overview description of LAPD functions and procedures, and the relationship
with other Recommendations are described in general terms in Recommendation Q.920 (I.440) [1].
NOTE 1:
As stated in Recommendation Q.920 (I.440), the term "data link layer" is used in the
main text of this Recommendation. However, mainly in figures and tables, the terms
"layer 2" and "L2" are used as abbreviations. Furthermore, in accordance with
Recommendations Q.930 (I.450) [2] and Q.931 (I.451) [3], and ETS 300 102-1 [9] and
ETS 300 102-2 [10], the term "layer 3" is used to indicate the layer above the data link
layer.
NOTE 2:
All reference within this document to "layer management entity" and/or "connection
management entity" refer to those entities at the data link layer.
2
Frame structure for peer-to-peer communication
2.1
General
All data link layer peer-to-peer exchanges are in frames conforming to one of the formats shown in figure
1/Q.921. Two format types are shown in the figure: format A for frames where there is no information field
and format B for frames containing an information field.
2.2
Flag sequence
All frames shall start and end with the flag sequence consisting of one 0 bit followed by six contiguous 1
bits and one 0 bit. The flag preceding the address field is defined as the opening flag. The flag following
the Frame Check Sequence (FCS) field is defined as the closing flag. The closing flag may also serve as
the opening flag of the next frame, in some applications. However, all receivers must be able to
accommodate receipt of one or more consecutive flags. See ISDN User-Network Interfaces: Layer 1
Recommendations I.430 [4] and I.431 [5], and prETS 300 012 [7] and prETS 300 011 [8], respectively, for
applicability.
2.3
Address field
The address field shall consist of two octets as illustrated in figure 1/Q.921. The address field identifies the
intended receiver of a command frame and the transmitter of a response frame. The format of the
address field is defined in § 3.2.
A single octet address field is reserved for LAPB operation in order to allow a single LAPB [6] data link
connection to be multiplexed along with LAPD data link connections.
NOTE:
The support of a LAPB data link connection within the D-channel is optional at both the
network and user side.
Page 33
ETS 300 125: September 1991
Format A
Format B
8
7
6
5
4
3
2
1
8
7
6
5
4
3
2
1
Flag
Octet 1
Flag
Octet 1
0
1
1
1
1
1
1
0
0
1
1
1
1
1
1
0
Address
2
Address
2
(high order octet)
(high order octet)
Address
3
Address
2
(low order octet)
(high order low)
Control a)
4
Control a)
4
Control a)
5
Control a)
5
Information
FCS (first octet)
N-2
FCS (first octet)
N-2
FCS (first octet)
N-1
FCS (first octet)
N-1
Flag
N
Flag
N
0
1
1
1
1
1
1
0
0
1
1
1
1
1
1
0
a)
Unacknowledged operation
- one octet
Multple Frame operation Modulo 128 - two octets for frames with seqiuence numbers;
- one octet for frames without sequence numbers
Figure 1/Q.921: Frame formats
2.4
Control field
The control field shall consist of one or two octets. figure 1/Q.921 illustrates the two frame formats (A and
B), each with a control field of one or two octets, depending upon the type of operation being used.
The format of the control field is defined in § 3.4.
2.5
Information field
The information field of a frame, when present, follows the control field (see § 2.4 above) and precedes
the frame check sequence (see § 2.7 below). The contents of the information field shall consist of an
integer number of octets.
The maximum number of octets in the information field is defined in § 5.9.3.
2.6
Transparency
A transmitting data link layer entity shall examine the frame content between the opening and closing frag
sequences, (address, control, information and FCS fields) and shall insert a 0 bit after all sequences of
five contiguous 1 bits (including the last five bits of the FCS) to ensure that a flag or an abort sequence is
not simulated within the frame. A receiving data link layer entity shall examine the frame contents between
the opening and closing flag sequences and shall discard any 0 bit which directly follows five contiguous 1
bits.
2.7
FCS field
The FCS field shall be a sixteen-bit sequence. It shall be the ones complement of the sum (modulo 2) of:
a)
the remainder of (x raised to k power) (x15 + x14 + x13 + x12 + x11 + x10 + x9 + x8 + x7 + x6 + x5 + x4 + x3
+ x2 + x1 + 1) divided (modulo 2) by the generator polynomial x16 + x12 + x5 +1, where k is the
Page 34
ETS 300 125: September 1991
number of bits in the frame existing between, but not including, the final bit of the opening flag and
the first bit of the FCS, excluding bits inserted for transparency; and
b)
the remainder of the division (modulo 2) by the generator polynomial x16 + x12 + x5 + 1, of the product
of x16 by the content of the frame existing between, but not including, the final bit of the opening flag
and the first bit of the FCS, excluding bits inserted for transparency.
As a typical implementation at the transmitter, the initial content of the register of the device computing the
remainder of the division is preset to all 1s and is then modified by division by the generator polynomial
(as described above) on the address, control, and information fields; the ones complement of the resulting
remainder is transmitted as the sixteen-bit FCS sequence.
As a typical implementation at the receiver, the initial content of the register of the device computing the
remainder is preset to all 1s. The final remainder after multiplication by x16 and then division (modulo 2)
by the generator polynomial x16 + x12 + x5 + 1 of the serial incoming protected bits and the FCS, will be
"0001 1101 0000 1111" (x15 through x0,respectively) in the absence of transmission errors.
2.8
Format convention
2.8.1
Numbering Convention
The basic convention used in this Recommendation is illustrated in figure 2/Q.921. The bits are grouped
into octets. The bits of an octet are shown horizontally and are numbered from 1 to 8. Multiple octets are
shown vertically and are numbered from 1 to n.
8
7
6
5
4
3
2
1
Octet 1
2
.
.
n
Figure 2/Q.921: Format convention
2.8.2
Order of bit transmission
The octets are transmitted in ascending numerical order; inside an octet bit 1 is the first bit to be
transmitted.
2.8.3
Field mapping convention
When a field is contained within a single octet, the lowest bit number of the field represents the lowest
order value.
When a field spans more than one octet, the order of bit values within each octet progressively decreases
as the octet number increases. The lowest bit number associated with the field represents the lowest
order value.
For example, a bit number can be identified as a couple (o,b) where o is the octet number and b is the
relative bit number within the octet. Figure 3/Q.921 illustrates a field that spans from bit (1,3) to bit (2,7).
The high order bit of the field is mapped on bit (1,3) and the low order bit is mapped on bit (2,7).
8
7
6
5
4
3
2
1
24
23
22
1st octet in the field
21
20
2nd octet in the field
Figure 3/Q.921: Field mapping convention
Page 35
ETS 300 125: September 1991
An exception to the preceding field mapping convention is the data link layer FCS field, which spans two
octets. In this case, bit 1 of the first octet is the high order bit and bit 8 of the second octet is the low order
bit (see figure 4/Q.921).
8
7
6
5
4
3
2
1
28
215
1st octet in the field
20
27
2nd octet in the field
Figure 4/Q.921: FCS mapping convention
2.9
Invalid frames
An invalid frame is a frame which:
a)
is not properly bounded by two flags; or
b)
has fewer than 6 octets between flags of frames that contain sequence numbers and fewer than 5
octets between flags of frames that do not contain sequence numbers; or
c)
does not consist of an integral number of octets prior to zero bit insertion or following zero bit
extraction; or
d)
contains a frame check sequence error; or
e)
contains a single octet address field; or
f)
contains a service access point identifier (see § 3.3.3) which is not supported by the receiver.
Invalid frames shall be discarded without notification to the sender. No action is taken as the result of that
frame.
2.10
Frame abort
Receipt or seven or more contiguous 1 bits shall be interpreted as an abort and the data link layer shall
ignore the frame currently being received.
3
Elements of procedures and formats of fields for data link layer peer-to-
peer communication
3.1
General
The elements of procedures define the commands and responses that are used on the data link
connections carried on the D-channel.
Procedures are derived from these elements of procedures and are described in § 5.
3.2
Address field format
The address field format shown in figure 5/Q.921 contains the address field extension bits, a
command/response indication bit, a data link layer Service Access Point Identifier (SAPI) subfield, and a
Terminal Endpoint Identifier (TEI) subfield.
Page 36
ETS 300 125: September 1991
8
7
6
5
4
3
2
1
SAPI
C/R
EA
0
Octet 2
TEI
EA
1
Octet 3
EA
= Address field extension bit
C/R
= Command/response field bit
SAPI = Service access point identifier
TEI
= Terminal endpoint identifier
Figure 5/Q.921: Address field format
3.3
Address field variables
3.3.1
Address field extension bit (EA)
The address field range is extended by reserving the first transmitted bit of the address field octets to
indicate the final octet of the address field. The presence of a 1 in the first bit of an address field octet
signals that it is the final octet of the address field. The double octet address field for LAPD operation shall
have bit 1 of the first octet set to a 0 and bit 1 of the second octet set to 1.
3.3.2
Command/Response field bit (C/R)
The C/R bit identifies a frame as either a command or a response. The user side shall send commands
with the C/R bit set to 0, and responses with the C/R bit set to 1. The network side shall do the opposite;
that is commands are sent with C/R set to 1, and responses are sent with C/R set to 0. The combinations
for the network side and user side are shown in table 1/Q.921.
Table 1/Q.921: C/R field bit usage
Command/Response
Direction
C/R value
Command
Network side
→
User side
1
User side
→
Network side
0
Response
Network side
→
User side
0
User side
→
Network side
1
In conformance with HDLC rules, commands use the address of the peer data link layer entity while
responses use the address of the own data link layer entity. According to these rules, both peer entities on
a point-to-point data link connection use the same Data Link Connection Identifier (DLCI) composed of a
SAPI-TEI where SAPI and TEI conform to the definitions contained in § 3.3.3 and § 3.3.4 and define the
data link connection as described in Q.920, § 3.4.1.
3.3.3
Service Access Point Identifier (SAPI)
The SAPI identifies a point at which data link layer services are provided by a data link layer entity to a
layer 3 or management entity. Consequently, the SAPI specifies a data link layer entity that should
process a data link layer frame and also a layer 3 or management entity which is to receive information
carried by the data link layer frame. The SAPI allows 64 service access points to be specified, where bit 3
of the address field octet containing the SAPI is the least significant binary digit and bit 8 is the most
significant. The SAPI values are allocated as shown in table 2/Q.921.
Page 37
ETS 300 125: September 1991
Table 2/Q.921
SAPI value
Related layer 3 or management entity
0
Call control procedures
1
Reserved for packet mode communications using Q.931 call control procedures
16
Packet communication conforming to X.25 level 3 procedures
64
Layer 2 management procedures
All others
Reserved for future standardsation
NOTE:
The reservation of SAPI values for experimental purposes is for further study.
3.3.4
Terminal Endpoint Identifier (TEI)
The TEI for a point-to-point data link connection may be associated with a single Terminal Equipment
(TE). A TE may contain one or more point-to-point TEIs. The TEI for a broadcast data link connection is
associated with all user side data link layer entities containing the same SAPI. The TEI subfield allows 128
values where bit 2 of the address field octet containing the TEI is the least significant binary digit and bit 8
is the most significant binary digit. The following conventions shall apply in the assignment of these
values.
3.3.4.1
TEI for broadcast data link connection
The TEI subfield bit pattern 111 1111 (=127) is defined as the group TEI. The group TEI is assigned to the
broadcast data link connection associated with the addressed Service Access Point (SAP).
3.3.4.2
TEI for point-to-point data link connection
The remaining TEI values are used for the point-to-point data link connections associated with the
addressed SAP. The range of TEI values shall be allocated as shown in table 3/Q.921.
Table 3/Q.921
TEI value
User type
0 - 63
Non-automatic TEI assignment user equipment
64-126
Automatic TEI assignment equipment
Non-automatic TEI values are selected by the user, and their allocation is the responsobility of the user.
Automatic TEI values are selected by the network, and their allocation is the responsibility of the network.
For further information regarding point-to-point situations, see Annex A.
3.4
Control field formats
The control field identifies the type of frame, which will be either a command or response. The control field
will contain sequence numbers, where applicable.
Three types of control field formats are specified: numbered information transfer (I format), supervisory
functions (S format), and unnumbered information transfers and control functions (U format). The control
field formats are shown in table 4/Q.921.
Page 38
ETS 300 125: September 1991
Table 4/Q.921: Control field formats
Control field bits
(modulo 128)
8
7
6
5
4
3
2
1
I format
N(S)
0
Octet 4
N(R)
P
5
S format
X
X
X
X
S
S
0
1
Octet 4
N(R)
P/F
5
U format
M
M
M
P/F
M
M
1
1
Octet 4
N(S) Transmitter send sequence number
M
Modifier function bit
N(R) Transmitter receive sequence number P/F
Poll bit when issued as a command,
final bit when issued as a response
S
Supervisory function bit
X
Reserved and set to 0
3.4.1
Information transfer (I) format
The I format shall be used to perform an information transfer between layer 3 entities. The functions of
N(S), N(R) and P (defined in § 3.5) are independent; that is, each I frame has an N(S) sequence number,
an N(R) sequence number which may or may not acknowledge additional I frames received by the data
link layer entity, and a P bit that may be set to 0 or 1.
The use of N(S), N(R), and P is defined in § 5.
3.4.2
Supervisory (S) format
The S format shall be used to perform data link supervisory control functions such as; acknowledge I
frames, request retransmission of I frames, and request a temporary suspension of transmission of I
frames. The functions of N(R) and P/F are independent, that is, each supervisory frame has an N(R)
sequence number which may or may not acknowledge additional I frames received by the data link layer
entity, and a P/F bit that may be set to 0 or 1.
3.4.3
Unnumbered (U) format
The U format shall be used to provide additional data link control functions and unnumbered information
transfers for unacknowledged information transfer. This format does not contain sequence numbers. It
does include a P/F bit that may be set to 0 or 1.
3.5
Control field parameters and associated state variables
The various parameters associated with the control field formats are described in this section. The coding
of the bits within these parameters is such that the lowest numbered bit within the parameter field is the
least significant bit.
3.5.1
Poll/Final bit
All frames contain the Poll/Final (P/F) bit. The P/F bit serves a function in both command frames and
response frames. In command frames the P/F bit is referred to as the P bit. In response frames it is
referred to as the F bit. The P bit set to 1 is used by a data link layer entity to solicit (poll) a response
frame from the peer data link layer entity. The F bit set to 1 is used by a data link layer entity to indicate
the response frame transmitted as a result of a soliciting (poll) command.
The use of the P/F bit is described in § 5.
Page 39
ETS 300 125: September 1991
3.5.2
Multiple frame operation - variables and sequence numbers
3.5.2.1
Modulus
Each I frame is sequentially numbered and may have the value 0 through n minus 1 (where n is the
modulus of the sequence numbers). The modulus equals 128 and the sequence numbers cycle through
the entire range, 0 through 127.
NOTE:
All arithmetic operations on state variables and sequence numbers contained in this
Recommendation are affected by the modulus operation.
3.5.2.2
Send state variable V(S)
Each point-to-point data link connection endpoint shall have an associated V(S) when using I frame
commands. V(S) denotes the sequence number of the next I frame to be transmitted. V(S) can take on
the value 0 through n minus 1. The value of V(S) shall be incremented by 1 with each successive I frame
transmission, and shall not exceed V(A) by more that the maximum number of outstanding I frames, k.
The value of k may be in the range of 1≤k≤127.
3.5.2.3
Acknowledge state variable V(A)
Each point-to-point data link connection endpoint shall have an associated V(A) when using I frame
commands and supervisory frame commands/responses. V(A) identifies the last frame that has been
acknowledged by its peer (V(A)-1 equals the N(S) of the last acknowledged I frame). V(A) can take on the
value 0 through "n" minus 1. The value of the acknowledge state variable shall be updated by the valid
N(R) values received from its peer (see § 3.5.2.6). A valid N(R) value is one that is in the range
V(A)≤N(R)≤V(S).
3.5.2.4
Send sequence number N(S)
Only I frames contain N(S), the send sequence number of transmitted I frames. At the time that an in-
sequence I frame is designated for transmission, the value of N(S) is set equal to V(S).
3.5.2.5
Receive state variable V(R)
Each point-to-point data link connection endpoint shall have an associated V(R) when using I frame
commands and supervisory frame command/responses. V(R) denotes the sequence number of the next
in-sequence I frame expected to be received. V(R) can take on the value 0 through n minus 1. The value
of V(R) shall be incremented by one with the receipt of an error free, in-sequence I frame whose N(S)
equals V(R).
3.5.2.6
Receive sequence number N(R)
All I frames and supervisory frames contain N(R), the expected send sequence number of the next
received I frame. At the time that a frame of the above types is designated for transmission, the value of
N(R) is set equal to V(R). N(R) indicates that the data link layer entity transmitting the N(R) has correctly
received all I frames numbered up to and including N(R) - 1.
3.5.3
Unacknowledged operation - variables and parameters
No variables are defined. One parameter is defined, N201 (see § 5.9.3).
3.6
Frame types
3.6.1
Commands and responses
The following commands and responses are used by either the user or the network data link layer entities
and are represented in table 5/Q.921. Each data link connection shall support the full set of commands
and responses for each application implemented. The frame types associated with each of the two
applications are identified in table 5/Q.921.
Page 40
ETS 300 125: September 1991
Frame types associated with an application not implemented shall be discarded and no action shall be
taken as a result of that frame.
For purposes of the LAPD procedures in each application, those frame types not identified in table
5/Q.921 are identified as undefined command and/or response control fields. The actions to be taken are
specified in § 5.8.5.
Table 5/Q.921: Commands and responses - modulo 128
Application
Format
Commands
Responses
Encoding
8
7
6
5
4
3
2
1
Octet
Information
I
N(S)
0
4
Transfer
(Information)
N(R)
P
5
RR (receive
RR (receive
0
0
0
0
0
0
0
1
4
ready
ready
N(R)
P/F
5
Supervisory
RNR (receive
RNR (receive
0
0
0
0
0
1
0
1
4
not ready)
not ready)
N(R)
P/F
5
Unacknow-
REJ
REJ
0
0
0
0
1
0
0
1
4
(reject)
(reject)
N(R)
P/F
5
ledged and
Multiple
Frame
SABME (set
asynchonous
balanced
mode
extended)
0
1
1
P
1
1
1
1
4
Information
DM (discon-
nected mode)
0
0
0
F
1
1
1
1
4
Transfer
UI
(unnumbered
information)
0
0
0
P
0
0
1
1
4
Unnumbered
DISC
(disconnect
0
1
0
P
0
0
1
1
4
UA (unnum-
bered
acknow-
ledgement)
0
1
1
F
0
0
1
1
4
FRMR (frame
reject
1
0
0
F
0
1
1
1
4
Connection
management
XID
(Exchange
Identification
Note)
XID
(Exchange
Identification
Note)
1
0
1
P/F
1
1
1
1
4
NOTE:
Use of the XID frame other than for parameter negotiation procedures (see § 5.4) is for
further study.
The commands and responses in table 5/Q.921 are defined in § 3.6.2 to § 3.6.12.
3.6.2
Information (I) command
The function of the information (I) command is to transfer, across a data link connection, sequentially
numbered frames containing information fields provided by layer 3. This command is used in the multiple
frame operation on point-to-point data link connections.
3.6.3
Set asynchronous balanced mode extended (SABME) command
The SABME unnumbered command is used to place the addressed user side or network side into modulo
128 multiple frame acknowledged operation.
No information field is permitted with the SABME command. A data link layer entity confirms acceptance
of an SABME command by the transmission at the first opportunity of a UA response. Upon acceptance of
this command, the data link layer entity's V(S), V(A), and V(R) are set to 0. The transmission of an
SABME command indicates the clearance of all exception conditions.
Page 41
ETS 300 125: September 1991
Previously transmitted I frames that are unacknowledged when this command is processed remain
unacknowledged and are discarded. It is the responsibility of a higher level (for example, layer 3) or the
management entity to recover from the possible loss of the contents of such I frames.
3.6.4
DISConnect (DISC) command
The DISC unnumbered command is used to terminate the multiple frame operation.
No information field is permitted with the DISC command. The data link layer entity receiving the DISC
command confirms the acceptance of a DISC command by the transmission of a UA response. The data
link layer entity sending the DISC command terminates the multiple frame operation when it receives the
acknowledging UA or DM response.
Previously transmitted I frames that are unacknowledged when this command is processed remain
unacknowledged and are discarded. It is the responsibility of a higher level (for example, layer 3) or the
management entity to recover from the possible loss of the contents of such I frames.
3.6.5
Unnumbered Information (UI) command
When a layer 3 or management entity requests unacknowledged information transfer, the UI unnumbered
command is used to send information to its peer without affecting data link layer variables. UI command
frames do not carry a sequence number and therefore, the UI frame may be lost without notification.
3.6.6
Receive Ready (RR) command/response
The RR supervisory frame is used by a data link layer entity to:
a)
indicate it is ready to receive an I frame;
b)
acknowledge previously received I frames numbered up to and including N(R)-1 (as defined in § 5);
and
c)
clear a busy condition that was indicated by the earlier transmission of an RNR frame by that same
data link layer entity.
In addition to indicating the status of a data link layer entity, the RR command with the P bit set to 1 may
be used by the data link layer entity to ask for the status of its peer data link layer entity.
3.6.7
REJect (REJ) command/response
The REJ supervisory frame is used by a data link layer entity to request retransmission of I frames starting
with the frame numbered N(R). The value of N(R) in the REJ frame acknowledges I frames numbered up
to and including N(R)-1. New I frames pending initial transmission shall be transmitted following the
retransmitted I frame(s).
Only one REJ exception condition for a given direction of information transfer is established at a time. The
REJ exception condition is cleared (reset) upon the receipt of an I frame with an N(S) equal to the N(R) of
the REJ frame. The optional procedure for the retransmission of an REJ response frame (see Appendix I)
is not used by European networks.
The transmission of an REJ frame shall also indicate the clearance of any busy condition within the
sending data link layer entity that was reported by the earlier transmission of an RNR frame by that same
data link layer entity.
In addition to indicating the status of a data link layer entity, the REJ command with the P bit set to 1 may
be used by the data link layer entity to ask for the status of its peer data link layer entity.
3.6.8
Receive Not Ready (RNR) command/response
The RNR supervisory frame is used by a data link layer entity to indicate a busy condition; that is, a
temporary inability to accept additional incoming I frames. The value of N(R) in the RNR frame
acknowledges I frames numbered up to and including N(R)-1.
Page 42
ETS 300 125: September 1991
In addition to indicating the status of a data link layer entity, the RNR command with the P bit set to 1 may
be used by the data link layer entity to ask for the status of its peer data link layer entity.
3.6.9
Unnumbered Acknowledgement (UA) response
The UA unnumbered response is used by a data link layer entity to acknowledge the receipt and
acceptance of the mode-setting commands (SABME or DISC). Received mode-setting commands are not
processed until the UA response is transmitted. No information field is permitted with the UA response.
The transmission of the UA response indicates the clearance of any busy condition that was reported by
the earlier transmission of an RNR frame by that same data link layer entity.
3.6.10
Disconnected Mode (DM) response
The DM unnumbered response is used by a data link layer entity to report to its peer that the data link
layer is in a state such that multiple frame operation cannot be performed. No information field is
permitted with the DM response.
3.6.11
Frame reject (FRMR) response
The FRMR unnumbered response may be received by a data link layer entity as a report of an error
condition not recoverable by retransmission of the identical frame, that is, at least one of the following
error conditions resulting from the receipt of a valid frame:
a)
the receipt of a command or response control field that is undefined or not implemented;
b)
the receipt of a supervisory or unnumbered frame with the incorrect length;
c)
the receipt of an invalid N(R); or
d)
the receipt of a frame with an information field which exceeds the maximum established length.
An undefined control field is any of the control field encodings not identified in table 5/Q.921.
A valid N(R) value is one that is in the range V(A)≤N(R)≤V(S).
An information field which immediately follows the control field and consists of five octets (modulo 128
operation), is returned with this response and provides the reason for the FRMR response. This
information field format is given in figure 6/Q.921.
Page 43
ETS 300 125: September 1991
8
7
6
5
4
3
2
1
Rejected frame
Octet 5
Control field
6
V(S)
0
7
V(R)
C/R
8
0
0
0
0
Z
Y
X
W
9
-
Rejected frame control field is the control field of the received frame which caused the frame
reject. When the rejected frame is an unnumbered frame, the control field of the rejected
frame is positioned in octet 5, with octet 6 set to 0000 0000.
-
V(S) is the current send state variable value on the user side or network side reporting the
rejection condition.
-
C/R is set to 1 if the frame rejected was a response and is set to 0 if the frame rejected was a
command.
-
V(R) is the current receive state variable value on the user side or network side reporting the
rejection condition.
-
W set to 1 indicates that the control field received and returned in octets 5 and 6 was
undefined or not implemented.
-
X set to 1 indicates that the control field received and returned in octets 5 and 6 was
considered invalid because the frame contained an information field which is not permitted
with this frame or is a supervisory or unnumbered frame with incorrect length. Bit W must be
set to 1 in conjunction with this bit.
-
Y set to 1 indicates that the information field received exceeded the maximum established
information field length (N201) of the user side or network side reporting the rejection
condition.
-
Z set to 1 indicates that the control field received and returned in octets 5 and 6 contained an
invalid N(R).
-
Octet 7 bit 1 and octet 9 bits 5 through 8 shall be set to 0.
Figure 6/Q.921: FRMR information field format - extended (modulo 128) operation
3.6.12
Exchange identification (XID) command/response
The XID frame may contain an information field in which the identification information is conveyed. The
exchange of XID frames is a compelled arrangement used in connection management (i.e. when a peer
entity receives an XID command, it shall respond with an XID response at the earliest time possible). No
sequence numbers are contained within the control field.
The information field is not mandatory. However, if a valid XID command contains an information field and
the receiver can interpret its contents, the receiver should then respond with an XID response also
containing an information field. If the information field cannot be interpreted by the receiving entity, or a
zero length information field has been received, an XID response frame shall be issued containing a zero
length information field. The maximum length of the information field must conform to the value N201.
Sending or receiving an XID frame shall have no effect on the operational mode or state variables
associated with the data link layer entities.
Page 44
ETS 300 125: September 1991
4
Elements for layer-to-layer communication
4.1
General
Communications between layer and, for this Recommendation, between the data link layer and the layer
management, are accomplished by means of primitives.
Primitives represent, in an abstract way, the logical exchange of information and control between the data
link and adjacent layers. They do not specify or constrain implementations.
Primitives consist of commands and their respective responses associated with the services requested of
a lower layer. The general syntax of a primitive is:
XX-Generic name-Type: Parameters
Where XX designates the interface across which the primitive flows. For this Recommendation XX is:
-
DL for communication between layer 3 and the data link layer;
-
PH for communication between the data link layer and the physical layer;
-
MDL for communication between the layer management and the data link layer; or
-
MPH for communication between the management entity and the physical layer.
4.1.1
Generic names
The generic name specifies the activity that should be performed. table 6/Q.921 illustrates the primitives
defined in this Recommendation. Note that not all primitives have associated parameters.
The primitive generic names that are defined in this Recommendation are:
4.1.1.1
DL-ESTABLISH
The DL-ESTABLISH primitives are used to request, indicate and confirm the outcome of the procedures
for establishing multiple frame operation.
4.1.1.2
DL-RELEASE
The DL-RELEASE primitives are used to request, indicate and confirm the outcome of the procedures for
terminating a previously established multiple frame operation, or for reporting an unsuccessful
establishment attempt.
4.1.1.3
DL-DATA
The DL-DATA primitives are used to request and indicate layer 3 messages which are to be transmitted,
or have been received, by the data link layer using the acknowledged information transfer service.
4.1.1.4
DL-UNIT DATA
The DL-UNIT DATA primitives are used to request and indicate layer 3 messages which are to be
transmitted, or have been received, by the data link layer using the unacknowledged information transfer
service.
4.1.1.5
MDL-ASSIGN
The MDL-ASSIGN primitives are used by the layer management entity to request that the data link layer
associate the TEI value contained within the message portion of the primitive with the specified
Connection Endpoint Suffix (CES), across all SAPIs. The MDL-ASSIGN primitive is used by the data link
layer to indicate to the layer management entity the need for a TEI value to be associated with the CES
specified in the primitive message unit.
Page 45
ETS 300 125: September 1991
4.1.1.6
MDL-REMOVE
The MDL-REMOVE primitives are used by the layer management entity to request that the data link layer
remove the association of the specified TEI value with the specified CES, across all SAPIs. The TEI and
CES are specified by the MDL-REMOVE primitive message unit.
4.1.1.7
MDL-ERROR
The MDL-ERROR primitives are used to indicate to the connection management entity that an error has
occurred, associated with a previous management function request or detected as a result of
communication with the data link layer peer entity. The layer management entity may respond with an
MDL-ERROR primitive if the layer management entity cannot obtain a TEI value.
4.1.1.8
MDL-UNIT DATA
The MDL-UNIT DATA primitives are used to request and indicate layer management entity messages
which are to be transmitted, or have been received, by the data link layer using the unacknowledged
information transfer service.
4.1.1.9
MDL-XID
The MDL-XID primitives are used by the connection management entity to request, indicate, respond and
confirm the outcome of the actions used in the XID procedures.
4.1.1.10
PH-DATA
The PH-DATA primitives are used to request and indicate message units containing frames used for data
link layer peer-to-peer communications passed to and from the physical layer.
4.1.1.11
PH-ACTIVATE
The PH-ACTIVATE primitives are used to request activation of the physical layer connection or to indicate
that the physical layer connection has been activated.
4.1.1.12
PH-DEACTIVATE
The PH-DEACTIVATE primitive is used to indicate that the physical layer connection has been
deactivated.
4.1.1.13
MPH-ACTIVATE (See Appendix III)
The MPH-ACTIVATE primitive is used to indicate that the physical layer connection has been activated.
4.1.1.14
MPH-DEACTIVATE (See Appendix III)
The MPH-DEACTIVATE primitives are used to request deactivation of the physical layer connection or to
indicate that the physical layer connection has been deactivated. The REQUEST is for use by the network
side system management entity.
4.1.1.15
MPH-INFORMATION
The MPH-INFORMATION primitive is for use by the user side management entity, and provides an
indication as to whether the terminal is:
-
connected; or
-
disconnected or unable to provide sufficient power to support the TEI management procedures.
4.1.2
Primitive types
The primitive types defined in this Recommendation are:
Page 46
ETS 300 125: September 1991
4.1.2.1
REQUEST
The REQUEST primitive type is used when a higher layer or layer management is requesting a service
from the lower layer.
4.1.2.2
INDICATION
The INDICATION primitive type is used by a layer providing a service to inform the higher layer or layer
management.
4.1.2.3
RESPONSE
The RESPONSE primitive type is used by layer management as a consequence of the INDICATION
primitive type.
4.1.2.4
CONFIRM
The CONFIRM primitive type is used by the layer providing the requested service to confirm that the
activity has been completed.
Figure 7/Q.921 illustrates the relationship of the primitive types to layer 3 and the data link layer.
Layer 3
C O N FIR M
R EQ U E ST
IN D IC A TIO N
R ESP O N SE
SAP
Data link layer
D ata link layer
peer - to - peer
protocol
\*
\*
Figure 7/Q.921: Relationship of the primitive types to layer 3 and the data link layer
4.1.3
Parameter definition
4.1.3.1
Priority indicator
Since several SAPs may exist on the network side or user side, protocol messages units sent by one SAP
may contend with those of other service access points for the physical resources available for message
transfer. The priority indicator is used to determine which message unit will have greater priority when
contention exists. The priority indicator is only needed at the user side for distinguishing message units
sent by the SAP with a SAPI value of 0 from all other message units.
4.1.3.2
Message unit
The message unit contains additional layer-to-layer information concerning actions and results associated
with requests. In the case of the DATA primitves, the message unit contains the requesting layer peer-to-
peer messages. For example, the DL-DATA message unit contains layer 3 information. The PH-DATA
message unit contains the data link layer frame.
NOTE:
The operations across the data link layer/layer 3 boundary shall be such that the layer
sending the DL-DATA or DL-UNIT DATA primitve can assume a temporal order of the
bits within the message unit and that the layer receiving the primitive can reconstruct
the message with its assumed temporal order.
Page 47
ETS 300 125: September 1991
Table 6/Q.921: Primitives associated with Recommendation Q.921
Generic name
Type
Parameters
Request
Indication Response
Confirm
Priority
Indicator
Message
Unit
L3 ↔ L2
DL-ESTABLISH
X
X
-
X
-
-
DL-RELEASE
X
X
-
X
-
-
DL-DATA
X
X
-
-
-
X
Layer 3 peer-to-peer
message
DL-UNIT DATA
X
X
-
-
-
X
Layer 3 peer-to-peer
message
M ↔ L2
MDL-ASSIGN
X
X
-
-
-
X
TEI value, CES
MDL-REMOVE
X
-
-
-
-
X
TEI value, CES
MDL-ERROR
-
X
X
-
-
X
Reason for error
message
MDL-UNIT DATA
X
X
-
-
-
X
Management function
peer-to-peer
message
MDL-XID
X
X
X
X
-
X
Connection
management
information
L2 ↔ L1
PH-DATA
X
X
-
-
X
X
Data link layer peer-
to-peer message
PH-ACTIVATE
X
X
-
-
-
-
PH-DEACTIVATE
-
X
-
-
-
-
M ↔ L1
MPH-ACTIVATE
-
X
-
-
-
-
MPH-
DEACTIVATE
X
X
-
-
-
-
MPH-
INFORMATION
-
X
-
-
-
X
Connected/
disconnected
L3 ↔ L2:
Layer 3/data link layer boundary
L2 ↔ L1:
data link layer/physical layer boundary
M ↔ L2:
Management entity/data link layer boundary
M ↔ L1:
Management entity/physical layer boundary
X:
existing
-:
not existing
4.2
Primitive procedures
4.2.1
General
Primitive procedures specify the interactions between adjacent layers to invoke and provide a service. The
service primitives represent the elements of the procedures.
In the scope of this Recommendation the interactions between layer 3 and the data link layer are
specified.
4.2.2
Layer 3 - data link layer interactions
The states of a data link connection endpoint may be derived from the internal states of the data link layer
entity supporting this type of a data link connection.
Data link connection endpoint states are defined as follows:
a)
Broadcast data link connection endpoint:
Page 48
ETS 300 125: September 1991
-
information transfer state.
b)
Point-to-point data link connection endpoint:
-
link connection released state;
-
awaiting establish state;
-
awaiting release state;
-
link connection established state.
The primitives provide the procedural means to specify conceptually how a data link service user can
invoke a service.
This section defines the constraints on the sequences in which the primitives may occur. The sequences
are related to the states at one point-to-point data link connection endpoint.
The possible overall sequences of primitives at a point-to-point data link connection endpoint are defined
in the state transition diagram, figure 8/Q.921. The link connection released and link connection
established states are stable states whilst the awaiting establish and awaiting release states are transition
states.
The model illustrates the behaviour of layer 2 as seen by layer 3. This model assumes that the primitives
passed between layers are implemented by a first in first out queue. In this model, "collisions" of
REQUEST and INDICATION primitives can occur thereby illustrating actions that seems to be in conflict
with the actual layer 2 protocol description. In some implementations, these collisions could occur.
DL-ESTABLISH
INDICATION
Note 4
DL-UNIT DATA
REQ./IND.
DL-ESTABLISH-CONFIRM
DL-ESTABLISH-REQUEST
DL-ESTABLISH
INDICATION
Note 2
DL-ESTABLISH
CONFIRM
Note 7
DL-RELEASE REQ UEST Note
LIN K CO N NEC TION
ESTABLIS HED
AW AITING
ESTABLISH
AW AITIN G
R ELEASE
DL-
DATA-
REQ./IND.
DL-UNIT
DATA-
REQ./IND.
DL-ESTABLISH-
CO NFIRM
Note 9
DL-RELEASE-
INDICATION
Note 3
DL-UNIT DATA-
REQ./IND.
DL-ESTABLISH-
INDICATION
Note 5
DL-RELEASE-CO NFIRM
DL-RELEASE-INDICATION
DL-ESTABLISH-REQU EST
DL-UNIT DATA-
REQ./IND.
DL-RELEASE-
INDICATION
Note 8
DL-ESTABLISH-CONFIRM
DL-ESTABLISH-INDICATION Note 6
DL-RELEASE-INDICATION
LIN K CO N NEC TION
R ELEASED
FIGURE 8/Q.921
State transition diagram for sequences of primitives at a point-to-point data link connection
endpoint as seen by layer 3
Page 49
ETS 300 125: September 1991
Notes to figure 8/Q.921:
NOTE 1:
If the data link layer entity issues a DL-ESTABLISH-INDICATION (this applies to the
case of data link layer initiated or peer system initiated re-establishment), DL-
RELEASE-CONFIRM or DL-RELEASE-INDICATION, this indicates the discard of all
the data link service data units representing DL-DATA-REQUESTs.
NOTE 2:
This primitive notifies layer 3 of link re-establishment.
NOTE 3:
This primitive will occur if a DL-RELEASE-REQUEST collides with a DL-RELEASE-
INDICATION.
NOTE 4:
This primitive will occur if a DL-ESTABLISH-REQUEST collides with a DL-
ESTABLISH-INDICATION.
NOTE 5:
This primitive will occur if a DL-RELEASE-REQUEST collides with a DL-ESTABLISH-
INDICATION.
NOTE 6:
This primitive will occur if a DL-ESTABLISH-REQUEST (this applies to the case of
layer 3 initiated re-establishment) collides with a DL-RELEASE-INDICATION. Since
this DL-RELEASE-INDICATION is not related to the DL-ESTABLISH-REQUEST, the
data link layer will establish the link and issue a DL-ESTABLISH-CONFIRM. It may
also occur if establishment was initiated upon receipt of an unsolicited DM response
with the F bit set to 0.
NOTE7:
This primitive will occur as a result of multiple collisions of primitives. If a first DL-
ESTABLISH-REQUEST collides with a DL-RELEASE-INDICATION, the data link layer
will establish the link and issue a DL-ESTABLISH-CONFIRM (see Note 6). This DL-
ESTABLISH-CONFIRM (it is related to the first DL-ESTABLISH-REQUEST) would
collide with a subsequent DL-ESTABLISH-REQUEST which may be issued since layer
3 is not aware that the DL-RELEASE-INDICATION was not related to the first DL-
ESTABLISH-REQUEST. Since layer 3 relates this DL-ESTABLISH-CONFIRM to the
subsequent DL-ESTABLISH-REQUEST it assumes the data link layer in the link
connection established state, but the data link layer will re-establish the link and issue
again a DL-ESTABLISH-CONFIRM.
NOTE 8:
This primitive will occur if a DL-ESTABLISH-REQUEST (this applies to the case of
layer 3 initiated re-establishment) collides with a DL-RELEASE-INDICATION. Since
this DL-RELEASE-INDICATION is not related to the DL-ESTABLISH-REQUEST, the
data link layer will try to establish the link and if this is not possible, it issues a DL-
RELEASE-INDICATION.
NOTE 9:
This primitive will occur as a result of multiple collisions of primitives. If a first DL-
ESTABLISH-REQUEST collides with a DL-RELEASE-INDICATION, the data link layer
will establish the link and issue a DL-ESTABLISH-CONFIRM (see Note 6). This DL-
ESTABLISH-CONFIRM may collide with a subsequent DL-ESTABLISH-REQUEST
and the data link layer will re-establish the link and issue again a DL-ESTABLISH-
CONFIRM (see Note 7). This second DL-ESTABLISH-CONFIRM (it is related to the
second DL-ESTABLISH-REQUEST) may collide with a subsequent DL-RELEASE-
REQUEST which may be issued since layer 3 is not aware that the DL-RELEASE-
INDICATION was not related to the first DL-ESTABLISH-REQUEST. Since layer 3
relates this first DL-ESTABLISH-CONFIRM to the subsequent DL-ESTABLISH-
REQUEST it assumes the data link layer in the link connection established state, but
the data link layer will re-establish the link and issue again a DL-ESTABLISH-
CONFIRM (see Note 7).
5
Definition of the peer-to-peer procedures of the data link layer
The procedures for use by the data link layer are specified in the following sections.
The elements of procedure (frame types) which apply are:
Page 50
ETS 300 125: September 1991
a)
for unacknowledged information transfer (§ 5.2):
-
UI-command.
b)
for multiple frame acknowledged information transfer (§ 5.5 to § 5.8):
-
SABME-command;
-
UA-response;
-
DM-response;
-
DISC-command;
-
RR-command/response;
-
RNR-command/response;
-
REJ-command/response;
-
I-command;
-
FRMR-response (Note);
NOTE:
An FRMR-response shall not be generated by a data link layer entity. However, on
receipt of this frame actions according to this specification have to be taken.
c)
for connection management entity information transfer:
-
XID-command/response.
5.1
Procedure for the use of the P/F bit
5.1.1
Unacknowledged information transfer
For unacknowledged information transfer the P/F bit is not used and shall be set to 0.
5.1.2
Acknowledged multiple frame information transfer
A data link layer entity receiving an SABME, DISC, RR, RNR, REJ or I frame, with the P bit set to 1, shall
set the F bit to 1 in the next response frame it transmits, as defined in table 7/Q.921.
Table 7/Q.921: Immediate response operation of P/F bit
Command received with P bit = 1
Response transmitted with F bit = 1
SABME, DISC
UA, DM
I, RR, RNR, REJ
RR, RNR, REJ (Note)
NOTE:
A LAPB data link layer entity may transmit an FRMR or DM response with the F bit set
to 1 in response to an I frame or supervisory command with the P bit set to 1.
5.2
Procedures for unacknowledged information transfer
5.2.1
General
The procedure which apply to the transmission of information in unacknowledged operation are defined
below.
No data link layer error recovery procedures are defined for unacknowledged operation.
Page 51
ETS 300 125: September 1991
5.2.2
Transmision of unacknowledged information
NOTE:
The term "transmission of a UI frame" refers to the delivery of a UI frame by the data
link layer to the physical layer.
Unacknowledged information is passed to the data link layer by layer 3 or management entities using the
primitives DL-UNIT DATA-REQUEST or MDL-UNIT DATA-REQUEST, respectively. The layer 3 or
management message unit shall be transmitted in a UI command frame.
For broadcast operation, the TEI value in the UI command address field shall be set to 127 (binary 111
1111, the group value).
For point-to-point operation, the appropriate TEI value shall be used.
The P bit shall be set to 0.
In the case of persistent layer 1 deactivation, the data link layer will be informed by an appropriate
indication. Upon receipt of this indication, all UI transmission queues shall be discarded. At the network
side, the system management entity provides that the PH-DEACTIVATE-INDICATION primitive will be
issued only, if persistent deactivation has occured. However, at the user side, the conditions to issue a
PH-DEACTIVATE-INDICATION primitive depend on the implementation of the physical layer.
NOTE:
The network side system management deactivation procedures should ensure that
layer 1 is not deactivated before all UI data transfer is completed.
5.2.3
Receipt of unacknowledged information
On receipt of a UI command frame with a SAPI and TEI which are supported by the receiver, the contents
of the information field shall be passed to the layer 3 or management entity using the data link layer to
layer 3 primitive DL-UNIT DATA-INDICATION or the data link layer to management primitive MDL-UNIT
DATA-INDICATION, respectively. Otherwise, the UI command frame shall be discarded.
5.3
Terminal Endpoint Identifier (TEI) management procedures
5.3.1
General
TEI management is based on the following procedural means:
-
TEI assignment procedures (see § 5.3.2);
-
TEI check procedures (see § 5.3.3);
-
TEI removal procedures (see § 5.3.4);
-
optional user equipment initiated TEI identity verify procedures (see § 5.3.5).
A user equipment in the TEI-unassigned state shall use the TEI assignment procedures to enter the TEI-
assigned state. Conceptually, these procedures exist in the layer management entity. The layer
management entity on the network side is referred to as the Assignment Source Point (ASP) in this
Recommendation.
The purpose of these procedures is to:
a)
allow automatic TEI equipment to request the network to assign a TEI value that the data link layer
entities within the requesting user equipment will use in their subsequent communications;
b)
allow a network to remove a previously assigned TEI value from specific or all user equipments;
c)
allow a network to check:
-
whether or not a TEI value is in use; or
Page 52
ETS 300 125: September 1991
-
whether multiple-TEI assignment has occurred.
d)
allow user equipment the option to request that the network invoke TEI check procedures.
The user side layer management entity shall instruct the user data link layer entities to remove all TEI
values when it is notified that the terminal is disconnected at the interface (as defined in Recommendation
I.430).
Additionally, the user side layer management entity should instruct the user data link layer entity to remove
a TEI value for its own internal reasons (for example, losing the ability to communicate with the network).
The layer management entity shall use the MDL-REMOVE-REQUEST primitive for these purposes.
§ 5.3.4.1 includes the actions taken by a data link layer entity receiving an MDL-REMOVE-REQUEST
primitive.
Typically, one TEI value would be used by the user equipment (for example, a data link layer entity which
has been assigned a TEI value could use that value for all SAPs which it supports). If required, a number
of TEI values may be requested by multiple use of the procedures defined in § 5.3.2. It shall be the
responsibility of the user to maintain the association between TEI and SAPI values.
The initiation of TEI assignment procedures occurs on the receipt of a request for establishment or
unacknowledged information transfer while in the TEI-unassigned state. The data link layer entity shall
inform the layer management entity using the MDL-ASSIGN-INDICATION primitive. Alternatively, the user
side layer management entity may initiate the TEI assignment procedures for its own reasons.
NOTE:
In the case of initialisation from a no power condition, the user equipment should
postpone the start of the TEI assignment procedure until a layer 2 service that needs a
TEI is to be provided.
All layer management entity messages used for these TEI management procedures are transmitted to, or
received from, the data link layer entity using the MDL-UNIT DATA-REQUEST primitive, or the MDL-UNIT
DATA-INDICATION primitive, respectively. The data link layer entity shall transmit management entity
messages in UI command frames. The SAPI value shall be 63. The TEI value shall be 127.
5.3.2
TEI assignment procedure
If the user equipment is of the non-automatic TEI assignment category, the user side layer management
entity shall deliver the TEI value to be used to the data link layer entity(s) via the MDL-ASSIGN-REQUEST
primitive.
If the user equipment is of the automatic TEI assignment category, upon initiation of the TEI assignment
procedure, the user side layer management entity shall transmit to its peer a message containing the
following elements:
a)
message type = identity request;
b)
Reference number (Ri); and
c)
Action indicator (Ai).
The reference number, Ri, shall be used to differentiate between a number of user equipments which may
simultaneously request assignment of a TEI value. The Ri shall be 2 octets in length and shall be
randomly generated for each request message by the user equipments.
All values in the range 0 to 65535 shall be available from the random number generator.
NOTE:
The design of the random number generator should minimise the probability of
identical reference numbers being generated by terminals which initiate their TEI
assignment procedures simultaneously. However, there exists a small probability that
double assignment will occur. Possible procedures to resolve this problem are listed in
§ 5.3.3 to 5.3.5.
Page 53
ETS 300 125: September 1991
The single-octet action indicator, Ai, shall be used to indicate a request to the ASP for the assignment of
any TEI value available.
The coding of the Ai shall be Ai = Group address TEI =127. This Ai value requests the ASP to assign any
TEI value.
A timer T202 shall be started.
The ASP, on receipt of the identity request message, shall either:
-
select a TEI value;
-
deny identity requests with Ai values in the range 64 - 126, and ignore identity requests with the Ai
value in the range 0 - 63; or
-
ignore the identity request message if a previous identity request message that contains an identical
Ri has been received and no response has been issued. In this case, the ASP shall not assign a
TEI value to either request.
Selection of a TEI value shall be on the basis of information stored at the ASP. This may consist of:
-
a map of the full range of automatic TEI values; or
-
an updated list of all automatic TEI values available for assignment, or a smaller subset.
The ASP, after having selected the TEI value, shall inform the network data link layer entities by means of
the MDL-ASSIGN-REQUEST primitive and transmit to its peer a message containing the following
elements:
a)
message type = identity assigned;
b)
Reference number (Ri); and
c)
the assigned TEI value in the Ai field.
If the available TEI information/resources are exhausted, a TEI check procedure should be initiated.
A user side layer management entity receiving this identity assigned message shall compare the TEI
value in the Ai field to its own TEI value(s) (if any) to see if it is already allocated if an identity request
message is outstanding. Additionally, the TEI value in the Ai field may be compared to its TEI(s) on the
receipt of all identity assigned messages.
If there is a match, the management entity shall either:
-
initiate TEI removal; or
-
initiate the TEI identity verify procedures.
If there is no match, the user side layer management entity shall:
-
compare the Ri value with any outstanding identity request message and if it matches, consider the
TEI value assigned to the user equipment, discard the value of Ri, inform the user side data link
layer entities by means of the MDL-ASSIGN-REQUEST primitive and stop timer T202;
-
compare the Ri value with any outstanding identity request message and if there is no match, do
nothing;
-
if there is no outstanding identity request message, do nothing.
When the data link layer receives the MDL-ASSIGN-REQUEST primitive from the layer management
entity, the data link layer entity shall:
-
enter the TEI-assigned state; and
Page 54
ETS 300 125: September 1991
-
proceed with data link establishment procedures if a DL-ESTABLISH-REQUEST primitive is
outstanding, or the transmission of a UI command frame if a DL-UNIT DATA-REQUEST primitive is
outstanding.
To deny an identity request message, the ASP shall transmit to its peer, a message containing the
following elements:
a)
message type = identity denied;
b)
Reference number (Ri); and
c)
the value of TEI which is denied in the Ai field (a value of 127 indicates that no TEI values are
available).
5.3.2.1
Expiry of timer T202
If the user receives either no response or an identity denied message to its identity request message, then
on expiry of timer T202, the timer shall be restarted and the identity request message shall be
retransmitted with a new value of Ri.
After N202 unsuccessful attempts to acquire a TEI value, the layer management entity shall inform the
data link layer entity using the MDL-ERROR-RESPONSE primitive. The data link layer entity receiving the
MDL-ERROR-RESPONSE primitive shall respond with the DL-RELEASE-INDICATION primitive if a
request for establishment had previously occurred, and shall discard all unserviced DL-UNIT DATA-
REQUEST primitives.
The values of T202 and N202 are specified in § 5.9.
The TEI assignment procedure is illustrated in figure 9/Q.921.
User side
ASP
UI (SAPI, TEI) [ID request, Ri, Ai]
UI (SAPI, TEI) [ID assigned, Ri, Ai]
or
UI (SAPI, TEI) [ID denied, Ri, Ai]
Start
T202
SAPI
: Service access point identifier = 63
TEI
: Group TEI = 127
ID request
: identity request
ID assigned : identity assigned
ID denied
: identity denied
Ai
: Action indicator, see table 8/Q.921
Ri
: Reference number
()
: Contents of the data link layer command address field
[]
: Contents of the data link layer command information field
Figure 9/Q.921: TEI assignment procedure
5.3.3
TEI check procedure
5.3.3.1
Use of the TEI check procedure
The TEI check procedure shall be used in the TEI audit and recovery procedures. The TEI check
procedure allows the network side layer management entity either:
Page 55
ETS 300 125: September 1991
-
to establish that a TEI value is in use; or
-
to verify multiple-TEI assignment.
The TEI check procedure for verifying multiple-TEI assignment may also optionally be invoked as a
response to an identity verify request message from the user equipment.
5.3.3.2
Operation of the TEI check procedure
The TEI check procedure is illustrated in figure 10/Q.921.
User side
ASP
UI (SAPI, TEI) [ID check request, Ai]
Ui (SAPI, TEI) [ID check response, Ri, Ai]
Start
T201
SAPI = 63, TEI = 127
NOTE:
For explanation of legends see figure 9/Q.921.
Figure 10/Q.921: TEI check procedure
The ASP shall transmit a message containing the following elements:
a)
message type = identity check request; and
b)
Ai field which contains the TEI value to be checked or the value 127 when all TEI values are to be
checked.
Timer T201 shall be started.
If any user equipment has been assigned the TEI value specified in the identity check request message, it
shall respond by transmitting a message containing the following elements:
a)
message type = identity check response;
b)
the TEI value in the Ai field; and
c)
Reference number (Ri).
NOTE:
The randomly-generated Ri is present in the identity check response to ensure that in
the case where more than one user equipment happens to commece transmission of
the identity check response at precisely the same time (i.e., the first "0" bit of the
opening flag coincides) due to different Ri values a collision at layer 1 (see ISDN user-
network interfaces: layer 1 Recommendations [I.43x series] for clarification) occurs.
The resolution of this collision results in multiple identity check responses.
When the TEI check procedure is used to verify multiple-TEI assignment:
-
if more than one identity check response is received within T201, then multiple-TEI assingment
shall be considered present; otherwise the request shall be repeated once and timer T201
restarted;
-
if more than one identity check response is received within the second T201 period, multiple-TEI
assignment shall be considered present;
Page 56
ETS 300 125: September 1991
-
if no identity check response is received after both T201 periods, the TEI value shall be assumed to
be free and available for (re)assignment;
-
if one identity check response is received in one or both T201 periods, the TEI value shall be
assumed to be in use.
When the TEI check procedure is used to test whether a TEI value is in use, it is completed upon the
receipt or the first TEI identity check response message, and the TEI value is assumed to be in use.
Otherwise:
-
if no identity check response is received within T201, the identity check request shall be repeated
once and timer T201 restarted;
-
if no identity check response is received after the second identity check request, the TEI value shall
be assumed to be free and available for re-assignment.
If the Ai value in the identity check request is equal to 127, it is preferred that the receiving user side layer
management entity respond with a single identity check response message that contains all of the TEI
values in use within that user equipment (see § 5.3.6.5). If an identity check request with Ai equal to 127 is
transmitted and an identity check response is received making use of the extension facility, each Ai
variable in the Ai field shall be processed as if received in separate identity check responses for parallel
identity check requests.
5.3.4
TEI removal procedure
When the network side layer management entity determines that the removal of a TEI value (see §
5.3.4.2) is necessary, the ASP shall transmit a message containing the following elements and issue an
MDL-REMOVE-REQUEST primitive:
a)
message type = identity remove; and
b)
TEI value which is to be removed, as indicated in the Ai field (the value 127 indicates that all user
equipments should remove their TEI values; otherwise, the specific TEI value should be removed).
The identity remove message shall be sent twice in succession, to overcome possible message loss.
When the user side layer management entity determines that the removal of a TEI value is necessary
(see § 5.3.4.2), it shall instruct the data link layer entity to enter the TEI-unassigned state, using the MDL-
REMOVE-REQUEST primitive. This action would also be taken for all TEI values when the Ai field
contains the value of 127.
Further action to be taken shall be either initiation of automatic TEI assignment for a new TEI value or
notification to the equipment user for the need for corrective action (that is, when equipment uses a non-
automatic TEI value and does not support the automatic TEI assignment procedure).
5.3.4.1
Action taken by the data link layer entity receiving the MDL-REMOVE-REQUEST
primitive
A data link layer entity receiving an MDL-REMOVE-REQUEST primitive shall:
a)
if no DL-RELEASE-REQUEST primitive is outstanding and the user equipment is not in the TEI-
assigned state, issue a DL-RELEASE-INICATION primitive; or
b)
if a DL-RELEASE-REQUEST primitive is outstanding, issue a DL-RELEASE-CONFIRM primitive.
The data link layer entity shall then enter the TEI-unassigned state after discarding the contents of both UI
and I queues.
5.3.4.2
Conditions for TEI removal
At the user equipment, automatic TEI values shall be removed, and in the case of non-automatic TEI
values, an appropriate indication shall be made to the user under the following conditions:
Page 57
ETS 300 125: September 1991
-
on request from the ASP by an identity remove message;
-
on receipt of an MPH-INFORMATION-INDICATION (disconnected) primitive;
-
on receipt of an MDL-ERROR-INDICATION primitive indicating that the data link layer entity has
assumed possible multiple-assignment of a TEI value, rather than requesting a TEI check
procedure by the transmission of an identity verify request message; or
-
optionally, on receipt of an identity assigned message containing a TEI value in the Ai field, which is
already in use within the user equipment (see § 5.3.2).
At the network side, TEI values should be removed:
-
following a TEI audit procedure showing that a TEI value is no longer in use or that multiple TEI
assignment has occurred; or
-
on receipt of an MDL-ERROR-INDICATION primitive indicating a possible multiple-TEI assignment,
which may be confirmed by the invocation of the TEI check procedures.
5.3.5
TEI identity verify procedure
5.3.5.1
General
The TEI identity verify procedure allows the user side layer management entity to have the capability to
request that the network invoke the identity check procedure for verification of multiple-TEI assignment.
The TEI identity verify procedure is optional for both the network and user equipment.
5.3.5.2
Operation of the TEI identity verify procedure
The TEI identity procedure is illustrated in figure 11/Q.921
User side
ASP
UI (SAPI, TEI) [ID verify, Ai ]
UI (SAPI, TEI) [ID check request, Ai]
UI (SAPI, TEI) [ID check response, Ri, Ai]
Start
T202
Start
T201
SAPI = 63, TEI = 127
NOTE 1:
For explanation of legends see figure 9/Q.921.
NOTE 2:
The Ai in the ID verify will be in the range 0 to 126. Ai = 127 is not allowed.
Figure 11/Q.921: TEI identity verify procedure
The user equipment shall transmit an identity verify message containing the following elements:
a)
message type = identity verify request;
b)
the TEI value to be checked in the Ai field; and
c)
the Ri field is not processed by the network and is coded 0.
Page 58
ETS 300 125: September 1991
Timer T202 is started.
The ASP, on receipt of the identity verify message shall, if implemented, invoke the TEI check procedure
as defined in § 5.3.3. This will result in the ASP sending an identity check request message to the user
equiment.
The user side layer management entity receiving any identity check message shall compare the content of
the Ai field to its TEI value requested being verified and to the value 127 (indicating that all TEI values are
to be checked). It shall stop timer T202 if there is a match. In any case, it has to respond on an identity
check message according to the TEI check procedure as defined in § 5.3.3.
5.3.5.3
Expiry of timer T202
If the user equipment receives no identity check request message with an Ai equal to its TEI or an Ai
equal to 127 before the expiry of timer T202, the user side layer management entity shall restart the timer
and the TEI identity verify message shall be retransmitted. If no identity check request message is
received from the ASP after the second TEI identity verify request message, the TEI shall be removed.
5.3.6
Formats and codes
5.3.6.1
General
All messages used for TEI management procedures are carried in the information field of UI command
frames with a SAPI value set to 63 (binary 11 1111) and TEI value set to 127 (binary 111 1111).
All messages have the structure shown in figure 12/Q.921.
8
7
6
5
4
3
2
1
Layer management entity identifier
Octet 1
Reference number
2
3
Message type
4
Action indicator
E
5
Figure 12/Q.921: Messages used for TEI management procedures
Fields that are not used in a specific message are coded all zeroes, and are not to be processed by either
side.
The coding of each field for the various messages is specified in table 8/Q.921.
E is the Action indicator field extension bit (see § 5.3.6.5).
Page 59
ETS 300 125: September 1991
Table 8/Q.921: Codes for messages concerning TEI management procedures
Message name
Layer
management
entity indentifier
Reference
number Ri
Message type
Action indicator Ai
Identity request
(user to network)
0000 1111
0 - 65535
0000 0001
Ai = 127
Any TEI value acceptable
Identity assigned
(network to user)
0000 1111
0 - 65535
0000 0010
Ai = 64 - 126
Assigned TEI value
Identity denied
0000 1111
0 - 65535
0000 0011
Ai = 64 - 126
Denied TEI value
(network to user)
Ai = 127
No TEI value available
Identity check request
0000 1111
Not used
0000 0100
Ai = 127
Check all TEI values
(network to user)
(coded 0)
Ai = 0 - 126
TEI value to be checked
Identity check response
(user to network)
0000 1111
0 - 65535
0000 0101
A = 0 - 126
TEI value in use
Identity remove
0000 1111
Not used
0000 0110
Ai = 127
Request for removal of all
TEI values
(network to user)
(coded 0)
Ai = 0 - 126
TEI value to be removed
Identity verify
(user to network)
0000 1111
Not used
(coded 0)
0000 0111
A = 0 - 126
TEI value to be checked
5.3.6.2
Layer management entity identifier
For TEI administration procedures, the layer mangement entity identifier octet is 0000 1111. Other values
are reserved for further standardisation.
5.3.6.3
Reference number (Ri)
Octets 2 and 3 contain Ri. When used, it can assume any value between 0 and 65535.
5.3.6.4
Message type
Octet 4 contains the message type. The purpose of the message type is to identify the function of the
message being sent.
5.3.6.5
Action indicator (Ai)
The Ai field is extended by reserving the first transmitted bit of the Ai field octets to indicate the final octet
of the Ai field.
Ai variables in the Ai field are coded as follows:
a)
bit 1 is the extension bit and is coded as follows:
-
0 to indicate an extension; and
-
1 to indicate the final octet;
b)
bits 2 to 8 contain the Action indicator.
The purpose of the Action indicator is to identify the concerned TEI value(s).
NOTE:
The use of the extension mechanism is confined to the identity check response when
all of the TEI values in use within a user equipment are to be reported in a single
identity check response upon receipt of an identity check request with an Ai equal to
127 (see § 5.3.3.2).
Page 60
ETS 300 125: September 1991
5.4
Automatic negotiation of data link layer parameters
This procedure is defined in Appendix IV.
5.5
Procedures for establishment and release of multiple frame operation
5.5.1
Establishment of multiple frame operation
The provision of extended multiple frame operation (modulo 128 sequencing) is recommended.
5.5.1.1
General
These procedures shall be used to establish multiple frame operation between the network and a
designated user entity.
Layer 3 will request establishment of the multiple frame operation by the use of the DL-ESTABLISH-
REQUEST primitive. Re-establishment may be initiated as a result of the data link layer procedures
defined in § 5.7. All frames other than unnumbered frame formats received during the establishment
procedures shall be ignored.
5.5.1.2
Establishment procedures
A data link layer entity shall initiate a request for the multiple frame operation to be set by transmitting the
SABME command. All existing exception conditions shall be cleared, the retransmission counter shall be
reset, and timer T200 shall then be started (timer T200 is defined in § 5.9.1) All mode setting commands
shall be transmitted with the P bit set to 1.
Layer 3 initiated establishment procedures imply the discard of all outstanding DL-DATA-REQUEST
primitives and all I frames in queue.
A data link layer entity receiving an SABME command, if it is able to enter the multiple-frame-established
state, shall:
-
respond with an UA response with the F bit set to the same binary value as the P bit in the received
SABME command;
-
set V(S), V(R) and V(A) to 0;
-
enter the multiple-frame-established state and inform layer 3 using the DL-ESTABLISH-
INDICATION primitive;
-
clear all existing exception conditions;
-
clear any existing peer receiver busy condition; and
-
start timer T203 (timer T203 is defined in § 5.9.8), if implemented.
If the data link layer entity is unable to enter the multiple-frame-established state, it shall respond to the
SABME command with a DM response with the F bit set to the same binary value as the P bit in the
received SABME command.
Upon reception of the UA response with the F bit set to 1, the originator of the SABME command shall:
-
reset timer T200;
-
start timer T203, if implemented;
-
set V(S), V(R), and V(A) to 0; and
-
enter the multiple-frame-established state and inform layer 3 using the DL-ESTABLISHE-CONFIRM
primitive.
Page 61
ETS 300 125: September 1991
Upon reception of a DM response with the F bit set to 1, the originator of the SABME command shall
indicate this to layer 3 by means of the DL-RELEASE-INDICATION primitive, and reset timer T200. It shall
then enter the TEI-assigned state. DM responses with the F bit set to 0 shall be ignored in this case.
A DL-RELEASE-REQUEST primitive received during data link layer initiated re-establishment shall be
serviced on completion of the establishment mode-setting operation.
5.5.1.3
Procedure on expiry of timer T200
If timer T200 expires before the UA or DM response with the F bit set to 1 is received, the data link layer
entity shall:
-
retransmit the SABME command as above;
-
restart timer T200; and
-
increment the retransmission counter.
After retransmission of the SABME command N200 times, the data link layer entity shall indicate this to
layer 3 and the connection management entity by means of the DL-RELEASE-INDICATION and MDL-
ERROR-INDICATION primitives, respectively, and enter the TEI-assigned state, after discarding all
outstanding DL-DATA-REQUEST primitives and all I frames in queue.
The value of N200 is defined in § 5.9.2.
5.5.2
Information transfer
Having either transmitted the UA response to a received SABME command or received the UA response
to a transmitted SABME command, I frames and supervisory frames shall be transmitted and received
according to the procedures described in § 5.6.
If an SABME command is received while in the multiple-frame-established state, the data link layer entity
shall conform to the re-establishment procedure described in § 5.7.
On receipt of a UI command, the procedures defined in § 5.2 shall be followed.
5.5.3
Termination of multiple frame operation
5.5.3.1
General
These procedures shall be used to terminate the multiple frame operation between the network and a
designated user entity.
Layer 3 will request termination of the multiple frame operation by use of the DL-RELEASE-REQUEST
primitive.
All frames other than unnumbered frames received during the release procedures shall be ignored.
All outstanding DL-DATA-REQUEST primitives and all I frames in queue shall be discarded.
In the case of persistent layer 1 deactivation the data link layer entity shall discard all I queues and deliver
to layer 3 a DL-RELEASE-CONFIRM primitive if a DL-RELEASE-REQUEST primitive is outstanding, or
otherwise a DL-RELEASE-INDICATION primitive. At the network side, the system management entity
provides that the PH-DEACTIVATE-INDICATION primitive will be issued only, if persistent deactivation
has occured. However, at the user side, the conditions to issue a PHDEACTIVATEINDICATION primitive
depend on the implementation of the physical layer.
5.5.3.2
Release procedure
A data link layer entity shall initiate a request for release of the multiple frame operation by transmitting the
Disconnect (DISC) command with the P bit set to 1. Timer T200 shall then be started and the
retransmission counter reset.
Page 62
ETS 300 125: September 1991
A data link layer entity receiving a DISC command while in the multiple-frame-established or timer
recovery state shall transmit a UA response with the F bit set to the same binary value as the P bit in the
received DISC command. A DL-RELEASE-INDICATION primitive shall be passed to layer 3, and the TEI-
assigned state shall be entered.
If the originator of the DISC command receives either:
-
a UA response with the F bit set to 1; or
-
a DM response with the F bit set to 1, indicating that the peer data link layer entity is already in the
TEI-assigned state;
it shall enter the TEI-assigned state and reset timer T200.
The data link layer entity which issued the DISC command is now in the TEI-assigned state and will notify
layer 3 by means of the DL-RELEASE-CONFIRM primitive. The conditions relating to this state are
defined in § 5.5.4.
5.5.3.3
Procedure on expiry of timer T200
If timer T200 expires before a UA or DM response with the F bit set to 1 is received, the originator of the
DISC command shall:
-
retransmit the DISC command as defined in § 5.5.3.2;
-
restart timer T200; and
-
increment the retransmission counter.
If the data link layer entity has not received the correct response as difined in § 5.5.3.2, after N200
attempts to recover, the data link layer entity shall indicate this to the connection management entity by
means or the MDL-ERROR-INDICATION primitive, enter the TEI-assigned state and notify layer 3 by
means of the DL-RELEASE-CONFIRM primitive.
5.5.4
TEI-assigned state
While in the TEI-assigned state:
-
the receipt of a DISC command shall result in the transmission of a DM response with the F bit set
to the value of the received P bit;
-
on receipt of an SABME command, the procedures defined in § 5.5.1 shall be followed;
-
on receipt of an unsolicited DM response with the F bit set to 0, the data link layer entity shall, if it is
able to, initiate the establishment procedures by the transmission of an SABME (see § 5.5.1.2).
Otherwise, the DM shall be ignored;
-
on receipt of UI commands, the procedures defined in § 5.2 shall be followed;
-
on receipt of any unsolicited UA response an MDL-ERROR-INDICATION primitive indicating a
possible multiple- assignment of a TEI value shall be issued; and
-
all other frame types shall be discarded.
5.5.5
Collision of unnumbered commands and responses
5.5.5.1
Identical transmitted and received commands
If the transmitted and received unnumbered commands (SABME or DISC) are the same, the data link
layer entities shall send the UA response at the earliest possible opportunity. The indicated state shall be
entered after receiving the UA response. The data link layer entity shall notify layer 3 by means of the
appropriate confirm primitive.
Page 63
ETS 300 125: September 1991
5.5.5.2
Different transmitted and received commands
If the transmitted and received unnumbered commands (SABME or DISC) are different, the data link layer
entities shall issue a DM response at the earliest possible opportunity. Upon receipt of a DM response
with the F bit set to 1, the data link layer shall enter the TEI-assigned state and notify layer 3 by means of
the appropriate primitive. The entity receiving the DISC command will issue a DL-RELEASE-INDICATION
primitive, while the other entity will issue a DL-RELEASE-CONFIRM primitive.
5.5.6
Unsolicited DM response and SABME or DISC command
When a DM response with the F bit set to 0 is received by a data link layer entity, a collision between a
transmitted SABME or DISC command and the unsolicited DM response may have occurred. This is
typically caused by a user equipment applying a protocol procedure according to X.25 LAPB [6] to ask for
a mode-setting command.
In order to avoid misinterpretation of the DM response received, a data link layer entity shall always send
its SABME or DISC command with the P bit set to 1.
A DM response with the F bit set to 0 colliding with an SABME or DISC command shall be ignored.
5.6
Procedures for information transfer in multiple frame operation
The procedures which apply to the transmission of I frames are defined below.
NOTE:
The term "transmission of an I frame" refers to the delivery of an I frame by the data
link layer to the physical layer.
5.6.1
Transmitting I frames
Information received by the data link layer entity from layer 3 by means of a DL-DATA-REQUEST primitive
shall be transmitted in an I frame. The control field parameters N(S) and N(R) shall be assigned the
values V(S) and V(R), respectively. V(S) shall be incremented by 1 at the end of the transmission of the I
frame.
If timer T200 is not running at the time of transmission of an I frame, it shall be started. If timer T200
expires, the procedures defined in § 5.6.7 shall be followed.
If V(S) is equal to V(A) plus k (where k is the maximum number of outstanding I frames - see § 5.9.5), the
data link layer entity shall not transmit any new I frames, but may retransmit an I frame as a result of the
error recovery procedures as described in § 5.6.4 and § 5.6.7.
When the network side or user side is in the own receiver busy condition, it may still transmit I frames,
provided that a peer receiver busy condition does not exist.
NOTE:
Any DL-DATA-REQUEST primitives received whilst in the timer recovery condition
shall be queued.
5.6.2
Receiving I frames
Independent of a timer recovery condition, when a data link layer entity is not in an own receiver busy
condition and receives a valid I frame whose N(S) is equal to the current V(R), the data link layer entity
shall:
-
pass the information field of this frame to layer 3 using the DL-DATA-INDICATION primitive;
-
increment by 1 its V(R), and act as indicated below.
5.6.2.1
P bit set to 1
If the P bit of the received I frame was set to 1, the data link layer entity shall respond to its peer in one of
the following ways:
Page 64
ETS 300 125: September 1991
-
if the data link layer entity receiving the I frame is still not in an own receiver busy condition, it shall
send an RR response with the F bit set to 1;
-
if the data link layer entity receiving the I frame enters the own receiver busy condition upon receipt
of the I frame, it shall send an RNR response with the F bit set to 1.
5.6.2.2
P bit set to 0
If the P bit of the received I frame was set to 0 and:
a)
if the data link layer entity is still not in an own receiver busy condition:
-
if no frame is available for transmission or if an I frame is available for transmission but a
peer receiver busy condition exists, the data link layer entity shall transmit an RR response
with the F bit set to 0; or
-
if an I frame is available for transmission and no peer receiver busy condition exists, the data
link layer entity shall transmit the I frame with the value of N(R) set to the current value of
V(R) as defined in §5.6.1.
b)
if, on receipt of this I frame, the data link layer entity is now in an own receiver busy condition, it
shall transmit an RNR response with the F bit set to 0.
When the data link layer entity is in an own receiver busy condition, it shall process any received I frame
according to § 5.6.6.
5.6.3
Sending and receiving acknowledgements
5.6.3.1
Sending acknowledgements
Whenever a data link layer entity transmits an I frame or a supervisory frame, N(R) shall be set equal to
V(R).
5.6.3.2
Receiving acknowledgements
On receipt of a valid I frame or supervisory frame (RR,RNR, or REJ), even in the own receiver busy, or
timer recovery conditions, the data link layer entity shall treat the N(R) contained in this frame as an
acknowledgement for all the I frames it has transmitted with an N(S) up to and including the received
N(R)-1. V(A) shall be set to N(R). The data link layer entity shall reset the timer T200 on receipt of a valid I
frame or supervisory frame with the N(R) higher than V(A) (actually acknowledging some I frames), or an
REJ frame with an N(R) equal to V(A).
NOTE 1:
If a supervisory frame with the P bit set to 1 has been transmitted and not
acknowledged, timer T200 shall not be reset.
NOTE 2:
Upon receipt of a valid I frame, timer T200 shall not be reset if the data link layer entity
is in the peer receiver busy condition.
If timer T200 has been reset by the receipt of an I, RR, or RNR frame, and if there are outstanding I
frames still unacknowledged, the data link layer entity shall restart timer T200. If timer T200 then expires,
the data link layer entity shall follow the recovery procedure as defined in § 5.6.7 with respect to the
unacknowledged I frames.
If timer T200 has been reset by the receipt of an REJ frame, the data link layer entitiy shall follow the
retransmission procedures in § 5.6.4.
5.6.4
Receiving REJ frames
On receipt of a valid REJ frame, the data link layer entity shall act as follows:
a)
if it is not in the timer recovery condition:
Page 65
ETS 300 125: September 1991
-
clear an existing peer receiver busy condition;
-
set its V(S) and its V(A) to the value of the N(R) contained in the REJ frame control field;
-
stop timer T200;
-
start timer T203, if implemented;
-
if it was an REJ command frame with the P bit set to 1, transmit an appropriate supervisory
response frame with the F bit set to 1 (see Note 2 in § 5.6.5);
-
transmit the corresponding I frame as soon as possible, as difined in § 5.6.1, taking into
account the items 1) to 3) below and the paragraph following items 1) to 3); and
-
notify a protocol violation to the connection management entity by means of the MDL-
ERROR-INDICATION primitive, if it was an REJ response frame with the F bit set to 1.
b)
if it is in the timer recovery condition and it was an REJ response frame with the F bit set to 1:
-
clear an existing peer receiver busy condition;
-
set its V(S) and its V(A) to the value N(R) contained in the REJ frame control field;
-
stop timer T200;
-
start timer T203, if implemented;
-
enter the multiple-frame-established state; and
-
transmit the corresponding I frame as soon as possible, as difined in § 5.6.1, taking into
account the items 1) to 3) below and the paragraph following items 1) to 3).
c)
if it is in the timer recovery condition and it was an REJ frame other than an REJ response frame
with the F bit set to 1:
-
clear an existing peer receiver busy condition;
-
set its V(A) to the value of the N(R) contained in the REJ frame control field; and
-
if it was an REJ command frame with the P bit set to 1, transmit an appropriate supervisory
response frame with the F bit set to 1 (see Note 2 in § 5.6.5).
Transmission of I frames shall take account of the following:
1)
if the data link layer entity is transmitting a supervisory frame when it receives the REJ frame, it
shall complete that transmission before commencing transmission of the requested I frame;
2)
if the data link layer entity is transmitting an SABME command, a DISC command, a UA response
or a DM response when it receives the REJ frame, it shall ignore the request for retransmission;
and
3)
if the data link layer entity is not transmitting a frame when the REJ is receiveed, it shall immediately
commence transmission of the requested I frame.
All outstanding unacknowledged I frames, commencing with the I frame identified in the received REJ
frame shall be transmitted. Other I frames not yet transmitted may be transmitted following the
retransmitted I frames.
5.6.5
Receiving RNR frames
After receiving a valid RNR command or response, if the data link layer entity is not engaged in a mode-
setting operation, it shall set a peer receiver busy condition and then:
Page 66
ETS 300 125: September 1991
-
if it was an RNR command with the P bit set to 1, it shall respond with an RR response with the F bit
set to 1 if the data link layer entity is not in an own receiver busy condition, and shall respond with
an RNR response with the F bit set to 1 if the data link layer entity is in an own receiver busy
condition; and
-
if it was an RNR response with the F bit set to 1, an existing timer recovery condition shall be
cleared and the N(R) contained in this RNR response shall be used to update V(S).
The data link layer entity shall take note of the peer receiver busy condition and not transmit any I frames
to the peer which has indicated the busy condition.
NOTE 1:
The N(R) in any received RR or RNR command frame (irrespective of the setting of
the P bit) will not be used to update the send state variable V(S).
The data link layer entity shall then:
-
treat the N(R) contained in the received RNR frame as an acknowledgement for all the I frames that
have been (re)transmitted with an N(S) up to and including N(R) minus 1, and set its V(A) to the
value of the N(R) contained in the RNR frame; and
-
restart timer T200 unless a supervisory response frame with the F bit set to 1 is still expected.
If timer T200 expires, the data link layer entity shall:
-
if it is not yet in a timer recovery condition, enter the timer recovery condition and reset the
retransmission count variable; or
-
if it is already in a timer recovery condition, add one to its retransmission count variable.
The data link layer entity shall then:
a)
if the value of the retransmission count variable is less than N200:
-
transmit an appropriate supervisory command (see Note 2) with a P bit set to 1;
-
restart timer T200; and
b)
if the value of the retransmission count variable is equal to N200, initiate a re-establishment
procedure as defined in § 5.7, and indicate this by means of the MDL-ERROR-INDICATION
primitive to the connection management entity.
The data link layer entity receiving the supervisory frame with the P bit set to 1 shall respond, at the
earliest opportunity, with an appropriate supervisory response frame (see Note 2) with the F bit set to 1 to
indicate whether or not its own receiver busy condition still exists.
Upon receipt or the supervisory response with the F bit set to 1, the data link layer entity shall reset timer
T200, and:
-
if the response is an RR or REJ response, the peer receiver busy condition is cleared and the data
link layer entity may transmit new I frames or retransmit I frames as defined in § 5.6.1 or § 5.6.4,
respectively; or
-
if the response is an RNR response, the data link layer entity receiving the response shall proceed
according to this § 5.6.5, first paragraph.
If a supervisory command (RR,RNR, or REJ) with the P bit set to 0 or 1, or a supervisory response frame
(RR,RNR,or REJ) with the F bit set to 0 is received during the enquiry process, the data link layer entity
shall:
-
if the supervisory frame is an RR or REJ command frame or an RR or REJ response frame with the
F bit set to 0, clear the peer receiver busy condition and if the supervisory frame received was a
command with the P bit set to 1, transmit the appropriate supervisory response frame (see Note 2)
with the F bit set to 1. However, the transmission or retransmission of I frames shall not be
Page 67
ETS 300 125: September 1991
undertaken until the appropriate supervisory response frame with the F bit set to 1 is received or
until the expiry of timer T200; or
-
if the supervisory frame is an RNR command frame or an RNR response frame with the F bit set to
0, retain the peer receiver busy condition and if the supervisory frame received was an RNR
command with the P bit set to 1, transmit the appropriate supervisory response frame (see Note 2)
with the F bit set to 1.
Upon receipt of an SABME command, the data link layer entity shall clear the peer receiver busy
condition.
NOTE 2:
If the data link layer entity is not in an own receiver busy condition and is in a reject
exception condition (that is, an N(S) sequence error has been received, and an REJ
frame has been transmitted, but the requested I frame has not been received), the
appropriate supervisory frame is the RR frame.
-
If the data link layer entity is not in an own receiver busy condition but is in an N(S)
sequence error exception condition (that is, an N(S) sequence error has been received
but an REJ frame has not been transmitted), the appropriate supervisory frame is the
REJ frame.
-
If the data link layer entity is in its own receiver busy condition, the appropriate
supervisory frame is the RNR frame.
-
Otherwise, the appropriate supervisory frame is the RR frame.
5.6.6
Data link layer own receiver busy condition
When the data link layer entity enters an own receiver busy condition, it shall transmit an RNR frame at
the earliest opportunity.
The RNR frame may be either:
-
an RNR response with the F bit set to 0; or
-
if this condition is entered on receiving a command frame with the P bit set to 1, an RNR response
with the F bit set to 1; or
-
if this condition is entered on expiry of timer T200, an RNR command with the P bit set to1.
All received I frames with the P bit set to 0 shall be discarded, after updating V(A).
All received supervisory frames with the P/F bit set to 0 shall be processed, including updating V(A).
All received I frames with the P bit set to 1 shall be discarded, after updating V(A). However, an RNR
response frame with the F bit set to 1 shall be transmitted.
All received supervisory frames with the P bit set to 1 shall be processed including updating V(A). An RNR
response with the F bit set to 1 shall be transmitted.
To indicate to the peer data link layer entity the clearance of the own receiver busy condition, the data link
layer entity shall transmit an RR frame or, if a previously detected N(S) sequence error has not yet been
reported, an REJ frame with the N(R) set to the current value of V(R).
The transmission of an SABME command or a UA response (in reply to an SABME command) also
indicates to the peer data link layer entity the clearance of the own receiver busy condition.
5.6.7
Waiting acknowledgement
The data link layer entity shall maintain an internal retransmission count variable.
If timer T200 expires, the data link layer entity shall:
Page 68
ETS 300 125: September 1991
-
if it is not yet in the timer recovery condition, enter the timer recovery condition and reset the
retransmission count variable; or
-
if it is already in the timer recovery condition, add one to its retransmission count variable.
The data link layer entity shall then:
a)
if the value of the retransmission count variable is less than N200:
-
restart timer T200; and either
-
transmit an appropriate supervisory command (see Note 2 in § 5.6.5) with the P bit set to 1;
or
-
retransmit the last transmitted I frame (V(S)-1) with the P bit set to 1; or
b)
if the value of the retransmission count variable is equal to N200, initiate a re-establishment
procedure as defined in § 5.7 and indicate this by means of the MDL-ERROR-INDICATION
primitive to the connection management entity.
The timer recovery condition is cleared when the data link layer entity receives a valid supervisory frame
response with the F bit set to 1. If the received supervisory frame N(R) is within the range from its current
V(A) to its current V(S) inclusive, it shall set its V(S) to the value of the received N(R). Timer T200 shall be
reset if the received supervisory frame response is an RR or REJ response, and then the data link layer
entity shall resume with I frame transmission or retransmission, as appropriate. Timer T200 shall be reset
and restarted if the received supervisory response is an RNR response, to proceed with the enquiry
process according to § 5.6.5.
5.7
Re-establishment of multiple frame operation
5.7.1
Criteria for re-establishment
The criteria for re-establishing the multiple frame mode of operation are defined in this section by the
following conditions:
-
the receipt, while in the multiple-frame mode of operation, of an SABME;
-
the receipt of a DL-ESTABLISH-REQUEST primitive from layer 3 (see § 5.5.1.1);
-
the occurrence of N200 retransmission failures while in the timer recovery condition (see § 5.6.7);
-
the ocurence of a frame rejection condition as identified in § 5.8.5;
-
on the receipt, while in the multiple-frame mode of operation, of an FRMR response frame (see §
5.8.6);
-
the receipt, while in the multiple-frame mode of operation, of an unsolicited DM response with the F
bit set to 0 (see § 5.8.7);
-
the receipt, while in the timer-recovery condition, of a DM response with the F bit set to 1.
5.7.2
Procedures
In all re-establishment situations, the data link layer entity shall follow the procedures defined in § 5.5.1. All
locally generated conditions for re-establishment will cause the transmission of the SABME.
In the case of data link layer and peer initiated re-establishment, the data link layer entity shall also:
-
issue an MDL-ERROR-INDICATION primitive to the connection managment entity; and
-
if V(S)>V(A) prior to re-establishment issue a DL-ESTABLISH-INDICATION primitive to layer 3, and
discard all I queues.
Page 69
ETS 300 125: September 1991
In case of layer 3 initiated re-establishment, or if a DL-ESTABLISH-REQUEST primitive occurs pending
re-establishment, the DL-ESTABLISH-CONFIRM primitive shall be used.
5.8
Exception condition reporting and recovery
Exception conditions may occur as the result of physical layer errors or data link layer procedural errors.
The error recovery procedures which are available to effect recovery following the detection of an
exception condition at the data link layer are defined in this section.
The actions to be taken by the connection mangement entity on receipt of an MDL-ERROR-INDICATION
primitive are defined in Appendix II.
5.8.1
N(S) sequence error
An N(S) sequence error exception condition occurs in the receiver when a valid frame is received which
contains an N(S) value which is not equal to the V(R) at the receiver. The information field of all I frames
whose N(S) does not equal the V(R) shall be discarded.
The receiver shall not acknowledge (nor increment its V(R)) the I frame causing the sequence error, nor
any I frames which may follow, until an I frame with the correct N(S) is received.
A data link layer entity which receives one or more I frames having sequence errors but otherwise error-
free, or subsequent supervisory frames (RR,RNR, and REJ), shall use the control field information
contained in the N(R) field and the P or F bit to perform data link control functions; for example, to receive
acknowledgement of previously transmitted I frames and to cause the data link layer entity to respond if
the P bit is set to 1. Therefore, the retransmitted I frame may contain an N(R) field value and P bit that are
updated from, and therefore different from, the ones contained in the originally transmitted I frame.
The REJ frame is used by a receiving data link layer entity to initiate an exception condition recovery
(retransmission) following the detection of an N(S) sequence error.
Only one REJ exception condition for a given direction of information transfer shall be established at a
time.
A data link layer entity receiving an REJ command or response shall initiate sequential transmission
(retransmission) of I frames starting with the I frame indicated by the N(R) contained in the REJ frame.
An REJ exception condition is cleared when the requested I frame is received or when an SABME or
DISC command is received.
An optional procedure for the retransmission of an REJ response frame is described in Appendix I.
5.8.2
N(R) sequence error
An N(R) sequence error exception condition occurs in the transmitter when a valid supervisory frame or I
frame is received which contains an invalid N(R) value.
A valid N(R) is one that is in the range V(A)≤N(R)≤V(S).
The information field contained in an I frame which is correct in sequence and format may be delivered to
layer 3 by means of the DL-DATA-INDICATION primitive.
The data link layer entity shall inform the connection management entity of this exception condition by
means of the MDL-ERROR-INDICATION primitive, and initiate re-establishment according to § 5.7.2.
5.8.3
Timer recovery condition
If a data link layer entity, due to a transmission error, does not receive a single I frame or the last I
frame(s) in a sequence of I frames, it will not detect an out-of-sequence exception condition and therefore
will not transmit an REJ frame.
Page 70
ETS 300 125: September 1991
The data link layer entity which transmitted the unacknowledged I frame(s) shall on the expiry of timer
T200, take appropriate recovery action as defined in § 5.6.7 to determine at which I frame retransmission
must begin.
5.8.4
Invalid frame condition
Any frame received which is invalid (as defined in § 2.9) shall be discarded, and no action shall be taken
as a result of that frame.
5.8.5
Frame rejection condition
A frame rejection condition results from one of the following conditions:
-
the receipt of an undefined frame (see § 3.6.1, third paragraph);
-
the receipt of a supervisory or unnumbered frame with incorrect length;
-
the receipt of an invalid N(R); or
-
the receipt of a frame with an information field which exceeds the maximum established length.
Upon occurence of a frame rejection condition whilst in the multiple frame operation, the data link layer
entity shall:
-
issue an MDL-ERROR-INDICATION primitive; and
-
initiate re-establishment (see § 5.7.2).
Upon occurence of a frame rejection condition during establishment or release from multiple frame
operation, or whilst a data link is not established, the data link layer entity shall:
-
issue an MDL-ERROR-INDICATION primitive; and
-
discard the frame.
NOTE:
For satisfactory operation it is essential that a receiver is able to discriminate between
invalid frames, as defined in § 2.9, and frames with an information field which exceeds
the maximum established length (see § 3.6.11 item d). An unbounded frame may be
assumed , and thus discarded, if two times the longest permissable frame plus two
octets are received without a flag detection.
5.8.6
Receipt of an FRMR response frame
Upon receipt of an FRMR response frame in the multiple-frame mode of operation, the data link layer
entity shall:
-
issue an MDL-ERROR-INDICATION primitive; and
-
initiate re-establishment (see § 5.7.2).
5.8.7
Unsolicited response frames
The action to be taken on the receipt of an unsolicited response frame is defined in table 9/Q.921. The
data link layer entity shall assume possible multiple-TEI assignment on the receipt of an unsolicited UA
response and shall inform layer management.
Table 9/Q.921: Actions taken on receipt of unsolicited response frames
Page 71
ETS 300 125: September 1991
Unsolicited
response
TEI-assigned
Awaiting
establishment
Awaiting
release
Multiple frame modes of
operation
frame
Timer recovery
condition
UA response
F = 1
MDL-Error
Indication
Solicited
Solicited
MDL-Error
Indication
MDL-Error
Indication
UA response
F = 0
MDL-Error
Indication
MDL-Error
Indication
MDL-Error
Indication
MDL-Error
Indication
MDL-Error
Indication
DM response
F = 1
Ignore
Solicited
Solicited
MDL-Error
Indication
Re-establish
MDL-Error
Indication
DM response
F = 0
Establish
Ignore
Ignore
Re-establish
MDL-Error
Indication
Re-establish
MDL-Error
Indication
Supervisory
response
F = 1
Ignore
Ignore
Ignore
MDL-Error
Indication
Solicited
Supervisory
response
F = 0
Ignore
Ignore
Ignore
Solicited
Solicited
5.8.8
Multiple-assignment of TEI value
A data link layer entity shall assume multiple-assignment of a TEI value and initiate recovery as specified
below by:
a)
the receipt of a UA response frame whilst in the multiple-frame-established state;
b)
the receipt of a UA response frame whilst in the timer recovery state;
c)
the receipt of a UA response frame whilst in the TEI-assigned state.
A data link layer entity, after assuming multiple-assignment of a TEI value shall inform the connection
management entity by means of the MDL-ERROR-INDICATION primitive.
5.9
List of system parameters
The system parameters listed below are associated with each individual SAP.
A method of assigning these parameters is defined in § 5.4.
The term default implies that the value defined should be used in the absence of any assignment or
negotiation of alternative values.
5.9.1
Timer T200
The default value for timer T200 at the end of which transmission of a frame may be initiated according to
the procedures described in § 5.6 shall be one second.
NOTE 1:
The proper operation of the procedure requires that timer T200 be greater than the
maximum time between transmission of command frames and the reception of their
corresponding response or acknowledgement frames.
NOTE 2:
When an implementation includes multiple terminals on the user side together with a
satellite connection in the transmission path, a value of T200 greater than 1 second
may be necessary. A value of 2.5 seconds is suggested.
5.9.2
Maximum number of retransmissions (N200)
The maximum number of retransmissions of a frame (N200) is a system parameter. The default value of
N200 shall be 3.
Page 72
ETS 300 125: September 1991
5.9.3
Maximum number of octets in an information field (N201)
The maximum number of octets in an information field (N201) is a system parameter. (See also § 2.5.).
-
For an SAP supporting signalling, the default value shall be 260 octets.
-
For SAPs supporting packet information, the default value shall be 260 octets.
5.9.4
Maximum number of transmission of the TEI identity request message (N202)
The maximum number of transmission of a TEI identity request message (when the user requests a TEI)
is a system parameter. The default value of N202 shall be 3.
5.9.5
Maximum number of outstanding I frames (k)
The maximum number (k) of sequentially numbered I frames that may be outstanding (that is,
unacknowledged) at any given time is a system parameter which shall not exceed 127, for extended
(modulo 128) operation.
-
for an SAP supporting basic access (16 kbit/sec) signalling, the default value shall be 1;
-
for an SAP supporting primary rate (64 kbit/sec) signalling, the default value shall be 7;
-
for an SAP supporting basic access (16 kbit/sec) packet information, the default value shall be 3;
-
for an SAP supporting primary rate (64 kbit/sec) packet information, the default value shall be 7.
5.9.6
Timer T201
The minimum time between retransmission of the TEI identity check messages (T201) is a system
parameter which shall be set to T200 seconds.
5.9.7
Timer T202
The minimum time between the transmission of TEI identity request messages is a system parameter
(T202) which shall be set to 2 seconds.
5.9.8
Timer T203
Timer T203 represents the maximum time allowed without frames being exchanged. The default value of
timer T203 shall be 10 seconds.
Table 10 provides an overview of these system parameters, depict their applicability to procedures, link
types and user or network side data link layer entities, and summarises the recommended default or fixed
values, respectively, to be used in European networks.
Page 73
ETS 300 125: September 1991
Table 10: System parameters
k
T200
T201
T202
T203
N200
N201
N202
Point-to-
point
data link
Signalling
(SAPI=0)
1
1 s
not
applicable
not
applicable
10 s
3
260
not
applicable
procedure
on a D-
channel at
16kbit/s
Packet
commun-
ication
(SAPI=16)
3
1 s
not
applicable
not
applicable
10 s
3
260
not
applicable
Point-to-
point
data link
Signalling
(SAPI=0)
7
1 s
not
applicable
not
applicable
10 s
3
260
not
applicable
procedure
on a D-
channel at
16kbit/s
Packet
commun-
ication
(SAPI=16)
7
1 s
not
applicable
not
applicable
10 s
3
260
not
applicable
TEI
assignment
User side
not
applicable
not
applicable
not
applicable
2 s
not
applicable
not
applicable
not
applicable
3
procedure
(SAPI=63)
ASP
not
applicable
not
applicable
1 s
not
applicable
not
applicable
not
applicable
not
applicable
not
applicable
5.10
Data link layer monitor function
5.10.1
General
The procedural elements defined in § 5 allow for the supervision of the data link layer resource. This
section describes procedures which may be used to provide this supervision function. The use of this
function is mandatory for network side data link layer entities in European networks but optional for a user
side data link layer entity.
5.10.2
Data link layer supervision in the multiple-frame-established state
The procedures specified herein propose a solution which is already identified in the HDLC classes of
procedures. The connection verification is a service provided by data link layer to layer 3. This implies that
layer 3 is informed in case of a failure only. Furthermore, the procedure may be incorporated in the
"normal" exchange of information and may become more efficient than a procedure based on the
involvement of layer 3.
The procedure is based on supervisory command frames (RR command, RNR command) and timer
T203, and operates in the multiple-frame-established state as follows.
If there are no frames being exchanged on the data link connection (neither new nor outstanding I frames,
nor supervisory frames with a P bit set to 1), there is no means to detect a faulty data link connection
condition or a user equipment having been unplugged. Timer T203 represents the maximum time allowed
without frames being exchanged.
If timer T203 expires, a supervisory command with a P bit set to 1 is transmitted. Such a procedure is
protected against transmission errors by making use of the normal timer T200 procedure including
retransmission count and N200 attempts.
5.10.3
Connection verification procedures
5.10.3.1
Start timer T203
The timer T203 is started:
-
when the multiple-frame-established state is entered; and
-
in the multiple-frame-established state whenever timer T200 is stopped (see Note in § 5.10.3.2).
Upon receiving an I or supervisory frame, timer T203 will be restarted if timer T200 is not to be started.
Page 74
ETS 300 125: September 1991
5.10.3.2
Stop Timer T203
The timer T203 is stopped:
-
when in the multiple-frame-established state, the timer T200 is started (see Note); and
-
upon leaving the multiple-frame-established state.
NOTE:
These two conditions mean that timer T203 is only started whenever timer T200 is
stopped and not restarted.
5.10.3.3
Expiry of timer T203
If timer T203 expires, the data link layer entity will act as follows (it should be noted that timer T200 is
neither running nor expired):
a)
set the retransmission count variable to 0;
b)
enter timer recovery state;
c)
transmit a supervisory command with the P bit set to 1 as follows:
-
if there is not a receiver busy condition (own receiver not busy), transmit an RR command; or
-
if there is a receiver busy condition (own receiver busy), transmit an RNR command;
d)
start timer T200; and
e)
send MDL-ERROR-INDICATION primitive to connection management after N200 retransmission.
Page 75
ETS 300 125: September 1991
Annex A
(to Recommendation Q.921) Provision of point-to-point signalling
connections
In certain applications it may be advantageous to have a single point-to-point signalling connection at layer
3; the allocation of the value 0 as a preferred TEI for that purpose is a network option. Use of the value 0
in such applications does not preclude using that value in other applications or networks.
In European networks, the TEI value 0 is reserved for NT2 in point-to-point configurations using a single
data link connection (that is, only one point-to-point data link connection is supported within each SAP), in
addition to this, the broadcast data link connection, (TEI = 127) between the NT2 and the network may be
supported within each SAP.
Page 76
ETS 300 125: September 1991
Annex B (to Recommendation Q.921) SDL for point-to-point procedures
An SDL representation of the point-to-point procedures of the data link layer
B.1
General
The purpose of this annex is to provide one example of an SDL representation of the point-to-point
procedures of the data link layer, to assist in the understanding of this Recommendation. This
representation does not describe all of the possible actions of the data link layer entity, as a non-
partitioned representation was selected in order to minimise its complexity. The SDL representation does
not therefore constrain implementations from exploiting the full scope of the procedures as presented
within the text of this Recommendation. The text description of the procedures is definitive.
The representation is a peer-to-peer model of the point-to-point procedures of the data link layer and is
applicable to the data link layer entities at both the user and network sides for all ranges of TEI values.
See figure B-1/Q.921.
Service user
(user side)
Service user
(network user side)
Management
Point-to-
point
procedures
Peer-to-peer
connection
Point-to-
point
procedures
Management
Figure B-1/Q.921: Peer-to-peer model of the point-to-point procedures
B.2
An overview of the states of the point-to-point data link layer entity
The SDL representation of the point-to-point procedures are based on an expansion of the three basic
states identified in § 3.4.2/Q.920 to the following 8 states:
State 1
TEI unassigned
State 2
Assign awaiting TEI
State 3
Establish awaiting TEI
State 4
TEI assigned
State 5
Awaiting establishment
State 6
Awaiting release
State 7
Multiple frame established
State 8
Timer recovery
An overview of the inter-relationship of these states is provided in figure B-2/Q.921. This overview is
incomplete, and serves only as an introduction to the SDL representation. All data link layer entities are
conceptually initiated in the TEI unassigned state (state 1), and will interact with the layer management in
order to request a TEI value. TEI assignment initiated by a Unit data request will cause the data link layer
entity to move to the TEI assigned state (state 4) via the assign awaiting TEI state (state 2). Initiation by an
establish request will cause a transition to the awaiting establishment state (state 5) via the establish
awaiting TEI state (state 3). Direct TEI assignment will cause an immediate transition to the TEI assigned
state (state 4). In states 4-8, Unit data requests can be directly serviced by the data link layer entity. The
Page 77
ETS 300 125: September 1991
receipt of an establish request in the TEI assigned state (state 4) will cause the initiation of the
establishment procedures and the transition to the awaiting establishment state (state 5). Completion of
the LAP establishment procedures takes the data link layer entity into the multiple frame established state
(state 7). Peer initiated establishment causes a direct transition from the TEI assigned state (state 4) to
the multiple frame established state (state 7). In the multiple frame established state (state 7),
Acknowledged data transfer requests can be serviced directly subject to the restrictions of the procedures.
Expiry of timer T200, which is used in both the flow control and data transfer aspects of the data link layer
enitity's procedures initiates the transition to the timer recovery state (state 8). Completion of the timer
recovery procedures will return the data link layer entity to the multiple frame established state (state 7). In
states 7 and 8, of the SDL representation the following conditions which are identified within the
Recommendation are observed:
a)
peer receiver busy;
b)
reject exception;
c)
own receiver busy.
In addition other conditions are used in order to avoid identification of additional states. The complete
combination of both of these categories of conditions with the 8 states of the SDL representation is the
basis for the state transition table description of the data link layer entity. A peer initiated LAP release will
take the data link layer entity directly into the TEI assigned state (state 4), whilst a release request will be
via the awaiting release state (state 6). TEI removal will cause a transition to the TEI unassigned state
(state 1).
Page 78
ETS 300 125: September 1991
1
TEI
unassigned
TEI
assignment
Unit data
Request
3
Establish
awaiting TEI
2
Assign
awaiting TEI
5
Awaiting
establishment
7
Multiple frame
established
4
TEI
assigned
6
Awaiting
release
8
Timer recovery
Establish
request
Establish
request
Establish
request
Release
request
Release
request
Peer
initiated
LAP
release
Peer
initiated
LAP
establishment
LAP
establishment
completed
Completion
of timer
recovery
T200
timer expiry
RC = N200
Any state
1
TEI
unassigned
TEI
removal
T200
timer
expiry
Peer
initiated
LAP release
TEI
assignment
Figure B-2/Q.921: An overview of the states of the point-to-point procedures
Page 79
ETS 300 125: September 1991
B.3
Cover notes
The following symbols and abbreviations are used within this description. A full description of the symbols
and their meaning and application can be found in the Series Z Recommendation (Fascicles VI.10 and
VI.11).
a)
State
b)
Signal reception
c)
Signal generation
d)
Save a signal (until completion of a transition to a new state)
e)
Process description
f)
Test
g)
Procedure call
h)
Implementation option
i)
Procedure definition
j)
\*\*\*
To mark an event or signal required as a result of the representation
approach adopted, which is local to the data link layer entity.
k)
RC
Retransmission counter
l)
(A-O)
The codes used in the MDL-ERROR-INDICATION signals are defined in
Table II-1/Q.921 in Appendix II. When multiple codes are shown, only one
applies.
Page 80
ETS 300 125: September 1991
B.4
The use of queues
To enable a satisfactory representation of the data link layer entity, conceptual queues for the UI frame
and I frame transmission have been explicitly brought out. These conceptual queues are finite but
unbounded and should in no way restrict the implementation of the point-to-point procedures. Two
additional signals have been provided in order to cause the servicing of these queues to be initiated - "UI
frame queued up" and "I frame queued up".
Page 81
ETS 300 125: September 1991
B.5
SDL representation
DL
ESTABLISH
REQUEST
1
TEI
UNASSIGNED
MDL
ASSIGN
INDICATION
3
ESTABLISH
AWAITING TEI
DL
UNIT DATA
REQUEST
MDL
ASSIGN
INDICATION
UNIT DATA
INTO
UI QUEUE
UI FRAME
QUEUED UP
2
ASSIGN
AWAITING TEI
MDL
ASSIGN
REQUEST
SAVE
TEI
4
TEI
ASSIGNED
\*\*\*
Note 3
Note 1
Note 1
Note 2
NOTE 1:
The use of these events on the network side is for further study.
NOTE 2:
This function may be implemented over a geographically distributed architecture.
This primitive may occur on initialisation for fixed TEIs at the network side, or as
appropriate in order to correctly process a frame carrying a fixed TEI.
NOTE 3:
Processing of UI frame queued up is described in figure B-9/Q.921.
Figure B-3/Q.921 (1 of 3)
Note
\*\*\*
\*\*\*
Note
2
ASSIGN
AWAITING TEI
DL
ESTABLISH
REQUEST
3
ESTABLISH
AWAITING TEI
DL
UNIT DATA
REQUEST
MDL
ASSIGN
REQUEST
MDL
ERROR
RESPONSE
PERSISTENT
DEACTI-
VATION
UI FRAME
QUEUED UP
DISCARD
UI QUEUE
DISCARD
UI QUEUE
SAVE
TEI
UNIT DATA
INTO
UI QUEUE
UI FRAME
QUEUED UP
2
ASSIGN
AWAITING TEI
4
TEI
ASSIGNED
1
TEI
UNASSIGNED
1
TEI
UNASSIGNED
NOTE:
Processing of UI frame queued up is described in figure B-9/Q.921.
Figure B-3/Q.921 (2 of 3)
Page 82
ETS 300 125: September 1991
Note
\*\*\*
\*\*\*
3
ESTABLISH
AWAITING TEI
DL
RELEASE
INDICATION
DL
RELEASE
INDICATION
DL
UNIT DATA
REQUEST
MDL
ASSIGN
REQUEST
MDL
ERROR
RESPONSE
PERSISTENT
DEACTI-
VATION
UI FRAME
QUEUED UP
DISCARD
UI QUEUE
DISCARD
UI QUEUE
SAVE
TEI
UNIT DATA
INTO
UI QUEUE
UI FRAME
QUEUED UP
3
ESTABLISH
AWAITING TEI
5
AWAITING
ESTABLISHM.
1
TEI
UNASSIGNED
1
TEI
UNASSIGNED
SET
LAYER 3
INITIATED
ESTABLISH
DATA
LINK
NOTE:
Processing of UI frame queued up is described in figure B-9/Q.921.
Figure B-3/Q.921 (3 of 3)
Page 83
ETS 300 125: September 1991
4
TEI
ASSIGNED
DL-
ESTABLISH
REQUEST
ESTABLISH
DATA
LINK
SET
LAYER 3
INITIATED
5
AWAITING
ESTABLISHM.
DL-
RELEASE
REQUEST
DL-RELEASE
CONFIRM
4
TEI
ASSIGNED
1
TEI
ASSIGNED
4
TEI
ASSIGNED
DISCARD
UI QUEUE
DISCARD
UI QUEUE
MDL-
REMOVE
REQUEST
PERSISTENT
DEACTI-
VATION
SABME
F=P
DISC
F=P
TX DM
4
TEI
ASSIGNED
ABLE TO
ESTABLISH
TX UA
TX DM
CLEAR
EXCEPTION
CONDITIONS
V(S)=0
V(A)=0
V(R)=0
DL
ESTABLISH
INDICATION
START T203
7
MULTIPLE FRAME
ESTABLISHED
4
TEI
ASSIGNED
Yes
No
Figure B-4/Q.921 (1 of 2)
Page 84
ETS 300 125: September 1991
4
TEI
ASSIGNED
UA
DM
MDL ERROR
INDICATION
(C,D)
4
TEI
ASSIGNED
F=1
4
TEI
ASSIGNED
ESTABLISH
DATA
LINK
SET
LAYER 3
INITIATED
5
AWAITING
ESTABLISHM.
ABLE TO
ESTABLISH
No
No
Yes
Yes
Figure B-4/Q.921 (2 of 2)
Note
Note
5
AWAITING
ESTABLISHM.
DL
ESTABLISH
REQUEST
DISCARD
I QUEUE
SET
LAYER 3
INITIATED
5
AWAITING
ESTABLISHM.
DL-RELEASE
REQUEST
MDL
REMOVE
REQUEST
DISCARD
I AND UI
QUEUES
DL-RELEASE
INDICATION
STOP T200
4
TEI
ASSIGNED
PERSISTENT
DEACTI-
VATION
DISCARD
I AND UI
QUEUES
DL-RELEASE
INDICATION
STOP T200
1
TEI
UNASSIGNED
SABME
F=P
TX UA
5
AWAITING
ESTABLISHM.
NOTE:
Only possible in cases of Layer 2 initiated re-establishment.
Figure B-5/Q.921 (1 of 3)
Page 85
ETS 300 125: September 1991
5
AWAITING
ESTABLISHM.
DISC
F=P
TX DM
5
AWAITING
ESTABLISHM.
UA
F=1
LAYER 3
INITIATED
DL
ESTABLISH
CONFIRM
DL
ESTABLISH
INDICATION
DISCARD
I QUEUE
V(S)=V(A)
MDL ERROR
INDICATION
(D)
5
AWAITING
ESTABLISHM.
STOP T200
START T203
V(S)=0
V(A)=0
V(R)=0
7
MULTIPLE FRAME
ESTABLISHED
Yes
No
No
No
Yes
Yes
Figure B-5/Q.921 (2 of 3)
Page 86
ETS 300 125: September 1991
\*\*\*
Note
\*\*\*
\*\*\*
5
AWAITING
ESTABLISHM.
DM
F=1
DISCARD
I QUEUE
DL-RELEASE
INDICATION
STOP T200
4
TEI
ASSIGNED
LAYER 3
INITIATED
RC=N200
5
AWAITING
ESTABLISHM.
TIMER
T200
EXPIRY
RC=RC+1
P=1
TX SABME
START T200
5
AWAITING
ESTABLISHM.
DISCARD
I QUEUE
MDL-ERROR
INDICATION
(G)
DL-RELEASE
INDICATION
4
TEI
ASSIGNED
I FRAME
QUEUED UP
5
AWAITING
ESTABLISHM.
I FRAME
QUEUED UP
5
AWAITING
ESTABLISHM.
I FRAME
QUEUED UP
PUT IN
I QUEUE
LAYER 3
INITIATED
DL-DATA
REQUEST
Yes
No
No
Yes
No
Yes
No
Yes
NOTE:
Only possible in cases of layer 2 initiated re-establishment.
Figure B-5/Q.921 (3 of 3)
6
AWAITING
RELEASE
MDL
REMOVE
REQUEST
DISCARD
UI QUEUE
DL-RELEASE
CONFIRM
STOP T200
1
TEI
UNASSIGNED
PERSISTENT
DEACTI-
VATION
DISCARD
UI QUEUE
DL-RELEASE
CONFIRM
STOP T200
4
TEI
ASSIGNED
SABME
F=P
TX DM
6
AWAITING
RELEASE
TX UA
6
AWAITING
RELEASE
F=P
DISC
UA
F=1
DL-RELEASE
CONFIRM
STOP T200
4
TEI
ASSIGNED
6
AWAITING
RELEASE
MDL-ERROR
INDICATION
(D)
Yes
No
Figure B-6/Q.921 (1 of 2)
Page 87
ETS 300 125: September 1991
6
AWAITING
RELEASE
DM
F=1
DL-RELEASE
CONFIRM
STOP T200
4
TEI
ASSIGNED
6
AWAITING
RELEASE
TIMER
T200
EXPIRY
RC=N200
RC=RC+1
P=1
TX DISC
START T200
6
AWAITING
RELEASE
DL-RELEASE
CONFIRM
4
TEI
ASSIGNED
MDL-ERROR
INDICATION
(H)
Yes
No
Yes
No
Figure B-6/Q.921 (2 of 2)
Page 88
ETS 300 125: September 1991
No
No
\*\*\*
Note
\*\*\*
\*\*\*
7
MULTIPLE FRAME
ESTABLISHED
DL
ESTABLISH
REQUEST
DISCARD
I QUEUE
ESTABLISH
DATA LINK
SET
LAYER 3
INITIATED
5
AWAITING
ESTABLISHM.
DL
RELEASE
REQUEST
DISCARD
I QUEUE
PUT IN
I QUEUE
RC=0
P=1
TX DISC
STOP T203
RESTART T200
6
AWAITING
RELEASE
DL-DATA
REQUEST
I FRAME
QUEUED UP
7
MULTIPLE FRAME
ESTABLISHED
I FRAME
QUEUED UP
PEER
RECEIVER
BUSY
V(S)=V(A)+k
GET NEXT
I QUEUE
ENTRY
P=0
TX I
COMMAND
I FRAME
QUEUED UP
V(S)=V(S)+1
CLEAR AC-
KNOWLEDGE
PENDING
T200
RUNNING
STOP T203
START T200
7
MULTIPLE FRAME
ESTABLISHED
Yes
Yes
Yes
No
NOTE:
The regeneration of this signal does not affect the sequence integrity of the I queue.
Figure B-7/Q.921 (1 of 10)
Page 89
ETS 300 125: September 1991
7
MULTIPLE FRAME
ESTABLISHED
TIMER
T200
EXPIRY
RC=0
PEER
BUSY
GET LAST
TRANSMITTED
I FRAME
V(S)=V(S)-1
P=1
TIMER
T203
EXPIRY
TRANSMIT
ENQUIRY
RC=0
8
TIMER
RECOVERY
MDL
REMOVE
REQUEST
TRANSMIT
ENQUIRY
PERSISTENT
DEACTI-
VATION
DISCARD
I AND UI
QUEUES
DL-RELEASE
INDICATION
STOP T200
STOP T203
1
TEI
UNASSIGNED
4
TEI
ASSIGNED
DISCARD
I AND UI
QUEUES
DL-RELEASE
INDICATION
STOP T200
STOP T203
TX I
COMMAND
V(S)=V(S)+1
CLEAR AC-
KNOWLEDGE
PENDING
START T200
RC=RC+1
8
TIMER
RECOVERY
Yes
No
Figure B-7/Q.921(2 of 10)
Page 90
ETS 300 125: September 1991
7
MULTIPLE FRAME
ESTABLISHED
SABME
DISC
UA
F=P
DISCARD
I QUEUE
MDL-ERROR
INDICATION
(C,D)
7
MULTIPLE FRAME
ESTABLISHED
TX UA
F=P
CLEAR
EXCEPTION
CONDITIONS
MDL-ERROR
INDICATION
(F)
TX UA
DL-RELEASE
INDICATION
STOP T200
STOP T203
V(S)=V(A)
4
TEI
ASSIGNED
DISCARD
I QUEUE
DL
ESTABLISH
INDICATION
STOP T200
START T203
V(S)=0
V(A)=0
V(R)=0
7
MULTIPLE FRAME
ESTABLISHED
No
Yes
Figure B-7/Q.921 (3 of 10)
Page 91
ETS 300 125: September 1991
Note
Note
7
MULTIPLE FRAME
ESTABLISHED
DM
F=1
MDL-ERROR
INDICATION
(E)
ESTABLISH
DATA LINK
CLEAR
LAYER 3
INITIATED
CLEAR AC-
KNOWLEDGE
PENDING
MDL-ERROR
INDICATION
(B)
7
MULTIPLE FRAME
ESTABLISHED
SET OWN
RECEIVER
BUSY
F=0
TX RNR
RESPONSE
OWN
RECEIVER
BUSY
OWN
RECEIVER
BUSY
SET OWN
RECEIVER
BUSY
CLEAR OWN
RECEIVER
BUSY
CLEAR AC-
KNOWLEDGE
PENDING
CLEAR OWN
RECEIVER
BUSY
F=0
TX RR
RESPONSE
7
MULTIPLE FRAME
ESTABLISHED
5
AWAITING
ESTABLISHM.
No
Yes
No
Yes
Yes
No
NOTE:
These signals are generated outside of this SDL representation, and may be
generated by the connection management entity.
Figure B-7/Q.921 (4 of 10)
Page 92
ETS 300 125: September 1991
6 of 10
6 of 10
1
2
7
MULTIPLE FRAME
ESTABLISHED
RR
CLEAR PEER
RECEIVER
BUSY
COMMAND
P=1
F=1
ENQUIRY
RESPONSE
MDL-ERROR
INDICATION
(A)
MDL-ERROR
INDICATION
(A)
F=1
ENQUIRY
RESPONSE
P=1
COMMAND
CLEAR PEER
RECEIVER
BUSY
REJ
Yes
Yes
No
Yes
No
No
Yes
No
No
Yes
No
Yes
Figure B-7/Q.921 (5 of 10)
Page 93
ETS 300 125: September 1991
5 of 10
5
AWAITING
ESTABLISHM.
N(R) ERROR
RECOVERY
V(A)=N(R)
STOP T200
START T203
INVOKE
RETRANS-
MISSION
5 of 10
1
7
MULTIPLE FRAME
ESTABLISHED
V(A)
≤N(R) ≤
V(S)
N(R)=V(S)
V(A)=N(R)
STOP T200
START T203
V(A)=N(R)
RESTART T200
N(R)=V(A)
V(A)
≤N(R) ≤
V(S)
7
MULTIPLE FRAME
ESTABLISHED
2
No
Yes
Yes
No
Yes
No
Yes
No
Figure B-7/Q.921 (6 of 10)
Page 94
ETS 300 125: September 1991
RNR
SET PEER
RECEIVER
BUSY
COMMAND
P=1
ENQUIRY
RESPONSE
F=1
FRMR
MDL-ERROR
INDICATION
(K)
ESTABLISH
DATA LINK
CLEAR
LAYER 3
INITIATED
5
AWAITING
ESTABLISHM.
MDL-ERROR
INDICATION
(A)
V(A)=N(R)
N(R) ERROR
RECOVERY
STOP T200
START T203
5
AWAITING
ESTABLISHM.
7
MULTIPLE FRAME
ESTABLISHED
V(A)
≤N(R) ≤
V(S)
7
MULTIPLE FRAME
ESTABLISHED
Yes
No
Yes
Yes
No
No
Yes
No
Figure B-7/Q.921 (7 of 10)
Page 95
ETS 300 125: September 1991
I
COMMAND
OWN
RECEIVER
BUSY
N(S)=V(R)
V(R)=V(R)+1
CLEAR REJECT
EXCEPTION
DL-DATA
INDICATION
DISCARD
INFORMATION
P=1
P=1
AC-
KNOWLEDGE
PENDING
SET AC-
KNOWLEDGE
PENDING
CLEAR AC-
KNOWLEDGE
PENDING
TX RR
F=P
SET
REJECT
EXCEPTION
F=P
TX REJ
CLEAR AC-
KNOWLEDGE
PENDING
CLEAR AC-
KNOWLEDGE
PENDING
TX RNR
F=1
P=1
DISCARD
INFORMATION
Note 2
Note 1
\*\*\*
9 of 10
7
MULTIPLE FRAME
ESTABLISHED
REJECT
EXCEPTION
AC-
KNOWLEDGE
PENDING
3
No
No
Yes
No
Yes
Yes
Yes
Yes
No
No
Yes
Yes
No
NOTE 1:
Processing of acknowledge pending is described on sheet 10 of this figure B-7/Q.921.
NOTE 2:
This SDL representation does not include the optional procedure in Appendix I.
Figure B-7/Q.921 (8 of 10)
Page 96
ETS 300 125: September 1991
PEER
RECEIVER
BUSY
V(A)=N(R)
N(R)=V(S)
V(A)=N(R)
STOP T200
RESTART T203
N(R)=V(A)
V(A)=N(R)
RESTART T200
7
MULTIPLE FRAME
ESTABLISHED
N(R) ERROR
RECOVERY
5
AWAITING
ESTABLISHM.
8 of 10
3
V(A)
≤N(R) ≤
V(S)
Yes
Yes
No
No
Yes
No
Yes
No
Figure B-7/Q.921 (9 of 10)
7
MULTIPLE FRAME
ESTABLISHED
AC-
KNOWLEDGE
PENDING
CLEAR AC-
KNOWLEDGE
PENDING
F=0
TX RR
7
MULTIPLE FRAME
ESTABLISHED
\*\*\*
ACKNOWL-
EDGE
PENDING
Yes
No
Figure B-7/Q.921 (10 of 10)
Page 97
ETS 300 125: September 1991
8
TIMER
RECOVERY
DL-ESTABLISH
REQUEST
DISCARD
I QUEUE
ESTABLISH
DATA LINK
SET
LAYER 3
INITIATED
5
AWAITING
ESTABLISHM.
DISCARD
I QUEUE
PUT IN
I QUEUE
DL-DATA
REQUEST
RC=0
P=1
TX DISC
RESTART
T200
6
AWAITING
RELEASE
3
TIMER
RECOVERY
\*\*\*
\*\*\*
DL
RELEASE
REQUEST
I FRAME
QUEUED UP
I FRAME
QUEUED UP
Figure B-8/Q.921 (1 of 9)
Page 98
ETS 300 125: September 1991
8
TIMER
RECOVERY
TIMER T200
EXPIRY
RC=N200
V(S)=V(A)
PEER
BUSY
GET LAST
TRANSMITTED
I FRAME
V(S)=V(S)-1
P=1
TX I
COMMAND
V(S)=V(S)+1
CLEAR AC-
KNOWLEDGE
PENDING
START T200
RC=RC+1
8
TIMER
RECOVERY
TRANSMIT
ENQUIRY
MDL-ERROR
INDICATION
(I)
ESTABLISH
DATA LINK
CLEAR
LAYER 3
INITIATED
5
AWAITING
ESTABLISHM.
DL-RELEASE
INDICATION
STOP T200
1
TEI
UNASSIGNED
DISCARD
I AND UI
QUEUES
MDL
REMOVE
REQUEST
DL-RELEASE
INDICATION
STOP T200
4
TEI
ASSIGNED
DISCARD
I AND UI
QUEUES
PERSISTENT
DEACTI-
VATION
No
No
No
Yes
Yes
Yes
Figure B-8/Q.921 (2 of 9)
Page 99
ETS 300 125: September 1991
8
TIMER
RECOVERY
SABME
DISC
UA
MDL-ERROR
INDICATION
(C, D)
8
TIMER
RECOVERY
DISCARD
I QUEUE
F=P
TX UA
DL-RELEASE
INDICATION
STOP T200
4
TEI
ASSIGNED
F=P
TX UA
CLEAR
EXCEPTION
CONDITIONS
MDL-ERROR
INDICATION
(F)
V(S)=V(A)
DISCARD
I QUEUE
DL-ESTABLISH
INDICATION
STOP T200
START T203
V(S)=0
V(A)=0
V(R)=0
7
MULTIPLE FRAME
ESTABLISHED
Yes
No
Figure B-8/Q.921 (3 of 9)
Page 100
ETS 300 125: September 1991
8
TIMER
RECOVERY
DM
F=1
OWN
RECEIVER
BUSY
OWN
RECEIVER
BUSY
MDL-ERROR
INDICATION
(E)
MDL-ERROR
INDICATION
(B)
SET OWN
RECEIVER
BUSY
CLEAR OWN
RECEIVER
BUSY
F=0
F=0
TX RNR
RESPONSE
TX RR
RESPONSE
CLEAR AC-
KNOWLEDGE
PENDING
CLEAR AC-
KNOWLEDGE
PENDING
8
TIMER
RECOVERY
ESTABLISH
DATA LINK
CLEAR
LAYER 3
INITIATED
5
AWAITING
ESTABLISHM.
Note
Note
SET OWN
RECEIVER
BUSY
CLEAR OWN
RECEIVER
BUSY
No
No
Yes
Yes
No
Yes
NOTE:
These signals are generated outside of this SDL representation, and may be
generated by the connection management entity.
Figure B-8/Q.921 (4 of 9)
Page 101
ETS 300 125: September 1991
8
TIMER
RECOVERY
RR
REJ
CLEAR PEER
RECEIVER
BUSY
COMMAND
P=1
F=1
V(A)
≤N(R)≤
V(S)
ENQUIRY
RESPONSE
V(A)
≤N(R)≤
V(S)
V(A)=N(R)
8
TIMER
RECOVERY
N(R)
ERROR
RECOVERY
5
AWAITING
ESTABLISHM.
V(A)=N(R)
STOP T200
START T203
INVOKE
RETRANS-
MISSION
7
MULTIPLE FRAME
ESTABLISHED
Yes
Yes
No
Yes
No
No
Yes
Yes
No
No
Figure B-8/Q.921 (5 of 9)
Page 102
ETS 300 125: September 1991
8
TIMER
RECOVERY
RNR
5
AWAITING
ESTABLISHM.
SET PEER
RECEIVER
BUSY
COMMAND
P=1
F=1
V(A)
≤N(R)≤
V(S)
ENQUIRY
RESPONSE
V(A)
≤N(R)≤
V(S)
V(A)=N(R)
8
TIMER
RECOVERY
N(R)
ERROR
RECOVERY
5
AWAITING
ESTABLISHM.
V(A)=N(R)
RESTART T200
INVOKE
RETRANS-
MISSION
7
MULTIPLE FRAME
ESTABLISHED
CLEAR
LAYER 3
INITIATED
ESTABLISH
DATA LINK
MDL ERROR
INDICATION
(K)
FRMR
Yes
Yes
No
Yes
No
No
Yes
Yes
No
No
Figure B-8/Q.921 (6 of 9)
Page 103
ETS 300 125: September 1991
8 of 9
Note 1
NOTE 2
\*\*\*
8
TIMER
RECOVERY
I
COMMAND
OWN
RECEIVER
BUSY
N(S)=V(R)
V(R)=V(R)+1
CLEAR REJECT
EXCEPTION
DISCARD
INFORMATION
REJECT
EXCEPTION
DL-DATA
INDICATION
P=1
P=1
AC-
KNOWLEDGE
PENDING
AC-
KNOWLEDGE
PENDING
SET AC-
KNOWLEDGE
PENDING
F=P
TX RR
CLEAR AC-
KNOWLEDGE
PENDING
CLEAR AC-
KNOWLEDGE
PENDING
TX REJ
F=P
SET
REJECT
EXCEPTION
DISCARD
INFORMATION
P=1
CLEAR AC-
KNOWLEDGE
PENDING
TX RNR
F=1
4
No
Yes
No
Yes
Yes
No
No
No
Yes
Yes
Yes
Yes
No
No
NOTE 1:
Processing of acknowledge pending is described on sheet 9 of this figure B-/Q.921.
NOTE 2:
This SDL representation does not include the optional procedure in Appendix I.
Figure B-8/Q.921 (7 of 9)
Page 104
ETS 300 125: September 1991
7 of 9
4
V(A)
≤N(R)≤
V(S)
V(A)=N(R)
8
TIMER
RECOVERY
5
AWAITING
ESTABLISHM.
N(R) ERROR
RECOVERY
Yes
No
Figure B-8/Q.921 (8 of 9)
\*\*\*
8
TIMER
RECOVERY
ACKNOW-
LEDGE
PENDING
AC-
KNOWLEDGE
PENDING
CLEAR AC-
KNOWLEDGE
PENDING
8
TIMER
RECOVERY
F=0
TX RR
8
TIMER
RECOVERY
Yes
No
Figure B-8/Q.921 (9 of 9)
Page 105
ETS 300 125: September 1991
\*\*\*
\*\*\*
RELEVANT
STATES
(NOTE 1)
DL
UNIT DATA
REQUEST
PLACE IN
UI QUEUE
UI FRAME
QUEUED UP
NOTE 2
TX UI
COMMAND
NOTE 2
P=0
REMOVE UI
FRAME FROM
QUEUE
UI FRAME
QUEUED UP
UI
COMMAND
DL
UNIT DATA
INDICATION
NOTE 2
NOTE 1:
The relevant states are as follows:
4 EI-assigned;
5 Awaiting-establishment;
6 Awaiting-release;
7 Multiple-frame-established;
8 Timer-recovery.
NOTE 2:
The data link layer returns to the state it was in prior to the events shown.
Figure B-9/Q.921 (1 of 5)
Page 106
ETS 300 125: September 1991
RELEVANT
STATES
(NOTE)
CONTROL
FIELD
ERROR (W)
INFO NOT
PERMITTED
(X)
INCORRECT
LENGTH
(X)
I FRAME
TOO LONG
(Y)
MDL-ERROR
INDICATION
(L, M, N, O)
ESTABLISH
DATA LINK
CLEAR
LAYER 3
INITIATED
5
AWAITING
ESTABLISHM.
NOTE:
The relevant states are as follows:
7 Multiple-frame-established;
8 Timer-recovery.
Figure B-9/Q.921 (2 of 5)
RELEVANT
STATES
(NOTE 1)
CONTROL
FIELD
ERROR (W)
INFO NOT
PERMITTED
(X)
INCORRECT
LENGTH
(X)
I FRAME
TOO LONG
(Y)
MDL-ERROR
INDICATION
(L, M, N, O)
NOTE 2
NOTE 1:
The relevant states are as follows:
4 TEI-assigned;
5 Awaiting-establishment;
6 Awaiting-release.
NOTE 2:
The data link layer returns to the state it was in prior to the events shown.
Figure B-9/Q.921 (3 of 5)
Page 107
ETS 300 125: September 1991
N(R)
ERROR
RECOVERY
ESTABLISH
DATA T
LINK
CLEAR
EXCEPTION
CONDITIONS
TRANSMIT
ENQUIRY
MDL-ERROR
INDICATION
(J)
CLEAR
EXCEPTION
CONDITIONS
CLEAR PEER
RECEIVER
BUSY
P=1
O W N
RECEIVER
BUSY
CLEAR
REJECT
EXCEPTION
RC=0
P=1
ESTABLISH
DATA T LINK
CLEAR
LAYER 3
INITIATED
TX SABME
CLEAR OWN
RECEIVER
BUSY
TX RR
COMMAND
TX RNR
COMMAND
RESTART T200
STOP T203
CLEAR AC-
KNOWLEDGE
PENDING
CLEAR AC-
KNOWLEDGE
PENDING
START T200
No
Yes
Figure B-9/Q.921 (4 of 5)
Page 108
ETS 300 125: September 1991
Note
\*\*\*
ENQUIRY
RESPONSE
F=1
OWN
RECEIVER
BUSY
TX RR
RESPONSE
CLEAR AC-
KNOWLEDGE
PENDING
TX RNR
RESPONSE
INVOKE
RETRANS-
MISSION
V(S)=N(R)
V(S)=V(S)-1
I FRAME
QUEUED UP
BACK TRACK
ALONG
I QUEUE
No
Yes
No
Yes
NOTE:
The generation of the correct number of signals in order to cause the required
retransmission of I frames does not alter their sequence integrity.
Figure B-9/Q.921 (5 of 5)
Page 109
ETS 300 125: September 1991
Annex C
(to Recommendation Q.921) An SDL representation of the broadcast
procedures of the data link layer
\*\*\*
\*\*\*
BROADCAST
INFORMATION
TRANSFER
DL-/MDL-
UNIT DATA
REQUEST
PLACE IN
UI QUEUE
REMOVE
UI FRAME
FROM QUEUE
UI FRAME
QUEUED
UP
UI
COMMAND
PERSISTENT
DE-
ACTIVATION
DISCARD
UI QUEUE
DL-/MDL-
UNIT DATA
INDICATION
P=0
UI FRAME
QUEUED
UP
BROADCAST
INFORMATION
TRANSFER
TX UI
COMMAND
Figure C-1/Q.921
Page 110
ETS 300 125: September 1991
Annex D
(to Recommendation Q.921) State transition table of the point-to-
point procedures of the data link layer
D.1
State transition table
The state transition table presented in Tables D-1.1/Q.921 to D-3.10/Q.921 is based on the eight basic
states (see § B.2) recognised in the SDL representation and the related transmitter and receiver
conditions.
The state transition table relinquishes to any partitioning of the procedures. It is conceptual and does not
prevent a designer from partitioning in his implementation. Moreover, all the processes related to primitive
procedures, the management of queues and the exchange of information between adjacent layers are
conceptual, not visible from outside of the system and would not impose any constraints on the
implementation.
The eight basic states apply to both the transmitter and the receiver within one data link layer entity.
However, some of the conditions are confined to the transmitter (e.g. "peer receiver busy"), whilst some
are confined to the receiver (e.g. "REJ recovery"). This implies, if the concept of non-partitioning is
adopted, that each transmitter condition has to be combined with each receiver condition resulting in
composite states. This state transition table comprises 24 composite states representing the 8 basic
states and the related combinations of transmitter and receiver conditions.
Events are defined as follows:
a)
primitives;
b)
repertoire of frames to be received:
-
unnumbered frames (SABME, DISC, UA, DM, UI, FRMR);
-
supervisory frames (RR, REJ, RNR);
-
information frame (I);
c)
internal events (Servicing of queues, expiry of timers, receiver busy condition).
The actions to be taken when an event occurs whilst in a specific state comprise:
i)
transition to another state;
ii)
peer-to-peer frame to be transmitted;
iii)
primitives to be issued;
iv)
timer actions;
v)
retry counters;
vi)
state variables;
vii)
P/F bit setting;
viii)
discarding contents of queues.
Page 111
ETS 300 125: September 1991
D.2
Key to the state transition table
D.2.1
Definition of a cell of the state transition table
State
Event
Actions
X
X defines the transition to the next state
X empty indicates "remain in the same state"
D.2.2
Key to the contents of a cell
I
Impossible by the definition of the data link layer service;
/
Impossible by the definition of the peer-to-peer data link procedures;
-
No action, no state change;
V(S)=V(A)=N(R)
Collective term for the two actions V(S)=N(R) and V(A)=N(R);
Timer T200
Start timer T200 if not already running;
TX ACK
The acknowledgement of the received I frame may be conveyed by an I frame
associated with the information flow in the opposite direction or a supervisory
response frame, as appropriate;
"DISCARD"
Indicates the discarding of the information contained in the information field of
the I frame
(A - O)
The codes used in MDL-ERROR-INDICATION signals are defined in table II-
1/Q.921 in Appendix II. When multiple codes are shown, only one applies.
The action
A
indicates
A
A
A
A
NOTE:
In general, this state transition table does not prevent an implementation from using
N(R) to acknowledge more than one I frame.
Page 112
ETS 300 125: September 1991
BASIC STATE
TEI
UNASSIGNED
ASSIGN
AWAITING TEI
ESTABLISH
AWAITING TEI
TEI
ASSIGNED
AWAITING
ESTABLISHMENT
AWAITING
RELEASE
TRANSMITTER CONDITION
Establish
Re-establish
Pending release
RECEIVER CONDITION
STATE NUMBER
1
2
3
4
5.0
5.1
5.2
6
DL-ESTABLISH-REQUEST
MDL-ASS-IND
3
3
I
RC=0
TX SABME P = 1
START T200
5.0
I
DISC. I QUEUE
5.0
I
I
DL-RELEASE-REQUEST
I
I
I
DL-REL-CONF
I
5.2
I
I
DL-DATA-REQUEST
I
I
I
I
I
DATA INTO
I QUEUE
I
I
I FRAME IN QUEUE
V(S) < V(A) + k
I
I
I
I
I
LEAVE I FRAME
IN QUEUE
I
I FRAME IN QUEUE
V(S) = V(A) + k
I
I
I
I
I
I
DL-UNIT DATA-REQUEST
MDL-ASS-IND
UNIT DATA
INTO UI QUEUE
2
UNIT DATA
INTO UI QUEUE
UI FRAME IN QUEUE
I
LEAVE UI FRAME IN
QUEUE
TX UI P = 0
MDL-ASSIGN-REQUEST
STORE TEI
VALUE
4
STORE TEI VALUE
RC=0
TX SABME P=1
START T200
5.0
I
I
I
I
I
MDL-REMOVE-REQUEST
I
I
I
DISC. UI QUEUE
1
DL-REL-IND
DISC.UI QUEUE
STOP T200
1
DL-REL-IND
DISC. I AND UI
QUEUES
STOP T200
1
DL-REL-CONF
DISC. I AND UI
QUEUES
STOP T200
1
DL-REL-CONF
DISC. UI QUEUE
STOP T200
1
MDL-ERROR-RESPONSE
I
DISC. UI QUEUE
1
DL-REL-IND
DISC. UI QUEUE
1
I
I
I
I
I
PERSISTANT DEACTIVATION
-
DISC. UI QUEUE
1
DL-REL-IND
DISC. UI QUEUE
1
DISC. UI QUEUE
DL-REL-IND
DISC. UI QUEUE
STOP T200
4
DL-REL-IND
DISC. I AND UI
QUEUES
STOP T200
4
DL-REL-CONF
DISC. I AND UI
QUEUES
STOP T200
4
DL-REL-CONF
DISC. UI QUEUE
STOP T200
4
TABLE D-1.1/Q.921 STATE TRANSITION TABLE: Receiving primitive
Note
The transmitter condition "pending release" may
occur only in cases of layer 2 initiaied re-
establishment
Page 113
ETS 300 125: September 1991
BASIC STATE
TEI
UNASSIGNED
ASSIGN
AWAITING TEI
ESTABLISH
AWAITING TEI
TEI
ASSIGNED
AWAITING ESTABLISHMENT
AWAITING
RELEASE
TRANSMITTER CONDITION
Establish
Re-establish
Pending release
RECEIVER CONDITION
STATE NUMBER
1
2
3
4
5.0
5.1
5.2
6
SABME P=1
ABLE TO ENTER STATE 7.0
/
/
/
DL-EST-IND
V(S,R,A)=0
TX UA F=1
START T203
7.0
TX UA F=1
TX DM F=1
SABME P=1
UNABLE TO ENTER STATE 7.0
/
/
/
TX DM F=1
/
/
/
/
SABME P=0
ABLE TO ENTER STATE 7.0
/
/
/
DL-EST-IND
V(S,R,A)=0
TX UA F=0
START T203
7.0
TX UA F=0
TX DM F=0
SABME P=0
UNABLE TO ENTER STATE 7.0
/
/
/
TX DM F=0
/
/
/
/
DISC P=1
/
/
/
TX DM F=1
TX UA F=1
DISC P=0
/
/
/
TX DM F=0
TX UA F=0
UA F=1
V(S) = V(A)
/
/
/
MDL-ERR -IND(C)
V(S,R,A)
DL-EST-CONF
STOP T200
START T203
7.0
V(S,R,A)
STOP T200
START T203
7.0
DISC. I QUEUE
RC=0
TX DISC P=1
RESTART T200
6
DL-REF-CONF
STOP T200
4
UA F=1
V(S) ≠ V(A)
/
/
/
DISC. I QUEUE
V(S,R,A)=0
DL-EST-IND
STOP T200
START T203
7.0
UA F=0
/
/
/
MDL-ERR-IND(D)
DM F=1
/
/
/
-
DL-REL-IND
STOP T200
4
DL-REL-IND
DISC. I QUEUE
STOP T200
4
DL-REL-CONF
DISC. I QUEUE
STOP T200
4
DL-REF-CONF
STOP T200
4
DM F=0
ABLE TO ENTER STATE 7.0
/
/
/
RC=0
TX SABME P=1
START T200
5.0
-
-
-
-
DM F=0
UNABLE TO ENTER STATE 7.0
/
/
/
-
/
/
/
/
UI command
/
/
/
DL-UNIT DATA-
IND
TABLE D-1.2/Q921 STATE TRANSITION TABLE: Receiving unnumbered frame with correct format
Page 114
ETS 300 125: September 1991
BASIC STATE
TEI
UNASSIGNED
ASSIGN
AWAITING TEI
ESTABLISH
AWAITING TEI
TEI
ASSIGNED
AWAITING
ESTABLISHMENT
AWAITING
RELEASE
TRANSMITTER CONDITION
Establish
Re-establish
Pending release
RECEIVER CONDITION
STATE NUMBER
1
2
3
4
5.0
5.1
5.2
6
FRMR response
rejecting SABME
/
/
/
/
-
-
-
-
FRMR response
rejecting DISC
/
/
/
/
/
/
/
/
FRMR response
rejecting UA
/
/
/
-
-
-
-
-
FRMR response
rejecting DM
/
/
/
-
-
-
-
-
FRMR response
rejecting I command
/
/
/
/
-
-
-
-
FRMR response
rejecting S frame
/
/
/
/
-
-
-
-
FRMR response
rejecting FRMR
/
/
/
/
/
/
/
/
TABLE D-1.3/Q.921 STATE TRANSITION TABLE: Receiving FRMR unnumbered frame with correct format
BASIC STATE
TEI
UNASSIGNED
ASSIGN
AWAITING TEI
ESTABLISH
AWAITING TEI
TEI
ASSIGNED
AWAITING
ESTABLISHMENT
AWAITING
RELEASE
TRANSMITTER CONDITION
Establish
Re-establish
Pending release
RECEIVER CONDITION
STATE NUMBER
1
2
3
4
5.0
5.1
5.2
6
RR command P=1
/
/
/
-
-
-
-
-
RR command P=0
/
/
/
-
-
-
-
-
RR comand F=0
/
/
/
-
-
-
-
-
RR command F=1
/
/
/
-
-
-
-
-
TABLE D-1.4/ Q.921 STATE TRANSITION TABLE: Receiving RR supervisory frame with correct format
Page 115
ETS 300 125: September 1991
BASIC STATE
TEI
UNASSIGNED
ASSIGN
AWAITING TEI
ESTABLISH
AWAITING TEI
TEI
ASSIGNED
AWAITING
ESTABLISHMENT
AWAITING
RELEASE
TRANSMITTER CONDITION
Establish
Re-establish
Pending release
RECEIVER CONDITION
STATE NUMBER
1
2
3
4
5.0
5.1
5.2
6
REJ command P=1
/
/
/
-
-
-
-
-
REJ command P=0
/
/
/
-
-
-
-
-
REJ response F=1
/
/
/
-
-
-
-
-
REJ response F=0
/
/
/
-
-
-
-
-
TABLE D-1.5/Q.921 STATE TRANSITION TABLE: Receiving REJ supervisory frame with correct format
BASIC STATE
TEI
UNASSIGNED
ASSIGN
AWAITING TEI
ESTABLISH
AWAITING TEI
TEI
ASSIGNED
AWAITING
ESTABLISHMENT
AWAITING
RELEASE
TRANSMITTER CONDITION
Establish
Re-establish
Pending release
RECEIVER CONDITION
STATE NUMBER
1
2
3
4
5.0
5.1
5.2
6
RNR command P=1
/
/
/
-
-
-
-
-
RNR command P=0
/
/
/
-
-
-
-
-
RNR response F=1
/
/
/
-
-
-
-
-
RNR response F=0
/
/
/
-
-
-
-
-
TABLE D-1.6/Q.921 STATE TRANSITION TABLE: Receiving RNR supervisory frame with correct format
Page 116
ETS 300 125: September 1991
BASIC STATE
TEI
UNASSIGNED
ASSIGN
AWAITING TEI
ESTABLISH
AWAITING TEI
TEI
ASSIGNED
AWAITING
ESTABLISHMENT
AWAITING
RELEASE
TRANSMITTER CONDITION
Establish
Re-establish
Pending release
RECEIVER CONDITION
STATE NUMBER
1
2
3
4
5.0
5.1
5.2
6
I command P=1
N(S) = V(R)
N(R) = V(S)
/
/
/
-
-
-
-
-
I command P=0
N(S) = V(R)
N(R) = V(S)
/
/
/
-
-
-
-
-
I command P=1
N(S) ≠ V(R)
N(R) = v(S)
/
/
/
-
-
-
-
-
I command P=0
N(S) ≠ V(R)
N(R) = v(S)
/
/
/
-
-
-
-
-
I command P=1
N(S) = V(R)
V(A) < N(R) <V(S)
/
/
/
-
-
-
-
-
I command P=1
N(S) = V(R)
V(A) < N(R) <V(S)
/
/
/
-
-
-
-
-
I command P=1
N(S) ≠ V(R)
V(A) < N(R) <V(S)
/
/
/
-
-
-
-
-
I command P=0
N(S) ≠ V(R)
V(A) < N(R) <V(S)
/
/
/
-
-
-
-
-
TABLE D-1.7/Q.921 STATE TRANSITION TABLE: Receiving I command frame with correct format acknowledging all outstanding I frames or containing an
N(R) which is V(A) < N(R) < V(S)
Page 117
ETS 300 125: September 1991
BASIC STATE
TEI
ASSIGNED
ASSIGN
AWAITING TEI
ESTABLISH
AWAITING TEI
TEI
ASSIGNED
AWAITING
ESTABLISHMENT
AWAITING
RELEASE
TRANSMITTER CONDITION
Establish
Re-establish
Pending release
RECEIVER CONDITION
STATE NUMBER
1
2
3
4
5.0
5.1
5.2
6
I command P=1
N(S) = V(R)
V(A) = N(R) < V(S)
/
/
/
-
-
-
-
-
I command P=0
N(S) = V(R)
V(A) = N(R) < V(S)
/
/
/
-
-
-
-
-
I command P=1
N(S) ≠ V(R)
V(A) = N(R) < V(S)
/
/
/
-
-
-
-
-
I command P=0
N(S) ≠ V(R)
V(A) = N(R) < V(S)
/
/
/
-
-
-
-
-
I command P=1
N(S) = V(R)
N(R) error
/
/
/
-
-
-
-
-
I command P=0
N(S) = V(R)
N(R) error
/
/
/
-
-
-
-
-
I command P=1
N(S) ≠ V(R)
N(R) error
/
/
/
-
-
-
-
-
I command P=0
N(S) ≠ V(R)
N(R) error
/
/
/
-
-
-
-
-
TABLE D-1.8/Q.921 STATE TRANSITION TABLE: Receiving I command frame with correct format an N(R) which is V(A)=N(R)<V(S) or an N(R) error
Page 118
ETS 300 125: September 1991
BASIC STATE
TEI
UNASSIGNED
ASSIGN
AWAITING TEI
ESTABLISH
AWAITING TEI
TEI
ASSIGNED
AWAITING
ESTABLISHMENT
AWAITING
RELEASE
TRANSMITTER CONDITION
Establish
Re-establish
Pending release
RECEIVER CONDITION
STATE NUMBER
1
2
3
4
5.0
5.1
5.2
6
T200 TIME-OUT
RC<N200
/
/
/
/
RC=RC+1
TX SABME P=1
START T200
RC=RC+1
TX DISC P=1
START T200
T200 TIME-OUT
RC=N200
/
/
/
/
DL-REL-IND
MDL-ERR-IND(G)
4
DISC.I QUEUE
DL-REL-IND
MDL-ERR-IND(G)
4
DISC. I QUEUE
DL-REL-CONF
MDL-ERR-IND(G)
4
DL-REL-CONF
MDL-ERR-IND(H)
4
T203 TIME-OUT
/
/
/
/
/
/
/
/
SET
OWN RECEIVER BUSY (Note)
/
/
/
/
/
/
/
/
CLEAR
OWN RECEIVER BUSY (Note)
/
/
/
/
/
/
/
/
TABLE D-1.9/Q.921 STATE TRANSITION TABLE: Internal events (Expiry of timers, receiver busy condition)
Note
These signals are generated outside the procedures specified in this state transition table, and may be generated by the connection management entity.
BASIC STATE
TEI
UNASSIGNED
ASSIGN
AWAITING TEI
ESTABLISH
AWAITING TEI
TEI
ASSIGNED
AWAITING
ESTABLISHMENT
AWAITING
RELEASE
TRANSMITTER CONDITION
Establish
Re-establish
Pending release
RECEIVER CONDITION
STATE NUMBER
1
2
3
4
5.0
5.1
5.2
6
SABME incorrect length
/
/
/
MDL-ERR-IND(N)
DISC incorrect length
/
/
/
UA incorrect length
/
/
/
DM incorrect length
/
/
/
FRMR incorrect length
/
/
/
Supervisory frame RR, REJ,
RNR incorrect length
/
/
/
N201 error
/
/
/
MDL-ERR-IND(O)
Undefined command and
response control field
/
/
/
MDL-ERR-IND(L)
I field not permitted
/
/
/
MDL-ERR-IND(M)
TABLE D-1.10/Q.921 STATE TRANSITION TABLE: Receiving frame with incorrect format or frame with undefined control field
Page 119
ETS 300 125: September 1991
BASIC STATE
MULTIPLE FRAME ESTABLISHED
TRANSMITTER CONDITION
NORMAL
NORMAL
NORMAL
NORMAL
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
RECEIVER CONDITION
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
STATE NUMBER
7.0
7.1
7.2
7.3
7.4
7.5
7.6
7.7
DL-ESTABLISH-REQUEST
DISC. I QUEUE
RC=0
TX SABME P=1
STOP T203
RESTART T200
5.0
DL-RELEASE-REQUEST
DISC.I QUEUE
RC=0
TX DISC P=1
STOP T203
RESTART T200
6
DL-DATA-REQUEST
DATA INTO I
QUEUE
I FRAME IN QUEUE
V(S) < V(A) + k
TX I P=0
V(S)=V(S)+1
STOP T203
TIMER T200
LEAVE I FRAME
IN QUEUE
I FRAME IN QUEUE
V(S) = V(A) + k
LEAVE I FRAME
IN QUEUE
DL-UNIT DATA-REQUEST
UNIT DATA INTO
UI QUEUE
UI FRAME IN QUEUE
TX UI P=0
MDL-ASSIGN-REQUEST
I
MDL-REMOVE-REQUEST
DL-REL-IND
DISC. I and UI
QUEUES
STOP T200
STOP T203
1
MDL-ERROR-RESPONSE
I
PERSISTENT DEACTIVATION
DL-REL-IND
DISC. I and UI
QUEUES
STOP T200
STOP T203
4
TABLE D-2.1/Q.921 STATE TRANSITION TABLE: Receiving primitive
Page 120
ETS 300 125: September 1991
BASIC STATE
MULTIPLE FRAME ESTABLISHED
TRANSMITTER CONDITION
NORMAL
NORMAL
NORMAL
NORMAL
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
RECEIVER CONDITION
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
STATE NUMBER
7.0
7.1
7.2
7.3
7.4
7.5
7.6
7.7
SABME P=1
V(S) = V(A)
MDL-ERR-IND(F)
V(S,R,A)=0
TX UA F=1
STOP T200
START T203
MDL-ERR-IND(F)
V(S,R,A)=0
TX UA F=1
STOP T200
START T203
7.0
SABME P=1
V(S) ≠ V(A)
DL-EST-IND
MDL-ERR-IND(F)
DISC. I QUEUE
V(S,R,A)=0
TX UA F=1
STOP T200
START T203
DL-EST-IND
MDL-ERR-IND(F)
DISC. I QUEUE
V(S,R,A)=0
TX UA F=1
STOP T200
START T203
7.0
SABME P=0
V(S) = V(A)
MDL-ERR-IND(F)
V(S,R,A)=0
TX UA F=0
STOP T200
START T203
MDL-ERR-IND(F)
V(S,R,A)=0
TX UA F=0
STOP T200
START T203
7.0
SABME P=0
V(S) ≠ V(A)
DL-EST-IND
MDL-ERR-IND(F)
DISC. I QUEUE
V(S,R,A)=0
TX UA F=0
STOP T200
START T203
DL-EST-IND
MDL-ERR-IND(F)
DISC. I QUEUE
V(S,R,A)=0
TX UA F=0
STOP T200
START T203
7.0
DISC P=1
DL-REL-IND
DISC. I QUEUE
TX UA F=1
STOP T200, T203
4
DISC P=0
DL-REL-IND
DISC. I QUEUE
TX UA F=0
STOP T200, T203
4
TABLE D-2.2a/Q.921 STATE TRANSITION TABLE: Receiving unnumbered frame with correct format
Page 121
ETS 300 125: September 1991
BASIC STATE
MULTIPLE FRAME ESTABLISHED
TRANSMITTER CONDITION
NORMAL
NORMAL
NORMAL
NORMAL
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
RECEIVER CONDITION
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
STATE NUMBER
7.0
7.1
7.2
7.3
7.4
7.5
7.6
7.7
UA F=1
MDL-ERR-IND(C)
UA F=0
MDL-ERR-IND(D)
DM F=1
MDL-ERR-IND(B)
DM F=0
MDL-ERR-IND(E)
RC=0
TX SABME P=1
STOP T203
RESTART T200
5.1
MDL-ERR-IND(E)
RC=0
TX SABME P=1
RESTART T200
5.1
UI command
DL-UNIT DATA-
IND
TABLE D-2.2b/Q.921 STATE TRANSITION TABLE: Receiving unnumbered frame with correct format
Page 122
ETS 300 125: September 1991
BASIC STATE
MULTIPLE FRAME ESTABLISHED
TRANSMITTER CONDITION
NORMAL
NORMAL
NORMAL
NORMAL
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
RECEIVER CONDITION
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
STATE NUMBER
7.0
7.1
7.2
7.3
7.4
7.5
7.6
7.7
FRMR response
rejecting SABME
/
/
/
/
/
/
/
/
FRMR response
rejecting DISC
/
/
/
/
/
/
/
/
FRMR response
rejecting UA
MDL-ERR-IND(K)
RC=0
TX SABME P=1
STOP T203
RESTART T200
5.1
MDL-ERR-IND(K)
RC=0
TX SABME P=1
RESTART T200
5.1
FRMR response
rejecting DM
/
/
/
/
/
/
/
/
FRMR response
rejecting I command
MDL-ERR-IND(K)
RC=0
TX SABME P=1
STOP T203
RESTART T200
5.1
MDL-ERR-IND(K)
RC=0
TX SABME P=1
RESTART T200
5.1
FRMR response
rejecting S frame
FRMR response
rejecting FRMR
/
/
/
/
/
/
/
/
TABLE D-2.3/Q.921 STATE TRANSITION TABLE: Receiving FRMR unnumbered frame with correct format
Page 123
ETS 300 125: September 1991
BASIC STATE
MULTIPLE FRAME ESTABLISHED
TRANSMITTER CONDITION
NORMAL
NORMAL
NORMAL
NORMAL
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
RECEIVER CONDITION
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
STATE NUMBER
7.0
7.1
7.2
7.3
7.4
7.5
7.6
7.7
RR command P=1
N(R) = V(S)
TX RR F=1
STOP T200
RESTART T203
V(A) =N(R)
TX RNR F=1
STOP T200
RESTART T203
V(A) = N(R)
TX RR F=1
STOP T200
START T203
V(A) = N(R)
7.0
TX RR F=1
STOP T200
START T203
V(A) = N(R)
7.1
TX RNR F=1
STOP T200
START T203
V(A) = N(R)
7.2
TX RNR F=1
STOP T200
START T203
V(A) = N(R)
7.3
RR command P=0
N(R) = V(S)
STOP T200
RESTART T203
V(A) = N(R)
STOP T200
START T203
V(A) = N(R)
7.0
STOP T200
START T203
V(A) = N(R)
7.1
STOP T200
START T203
V(A) = N(R)
7.2
STOP T200
START T203
V(A) = N(R)
7.3
RR response F=0
N(R) = V(S)
RR response F=1
N(R) = V(S)
MDL-ERR-IND(A)
STOP T200
RESTART T203
V(A) = N(R)
MDL-ERR-IND(A)
STOP T200
START T203
V(A) = N(R)
7.0
MDL-ERR-IND(A)
STOP T200
START T203
V(A) = N(R)
7.1
MDL-ERR-IND(A)
STOP T200
START T203
V(A) = N(R)
7.2
MDL-ERR-IND(A)
STOP T200
START T203
V(A) = N(R)
7.3
RR command P=1
V(A) < N(R) < V(S)
TX RR F=1
RESTART T200
V(A) = N(R)
TX RNR F=1
RESTART T200
V(A) = N(R)
TX RR F=1
RESTART T200
V(A) = N(R)
7.0
TX RR F=1
RESTART T200
V(A) = N(R)
7.1
TX RNR F=1
RESTART T200
V(A) = N(R)
7.2
TX RNR F=1
RESTART T200
V(A) = N(R)
7.3
RR command P=0
V(A) < N(R) < V(S)
RESTART T200
V(A) = N(R)
RESTART T200
V(A) = N(R)
7.0
RESTART T200
V(A) = N(R)
7.1
RESTART T200
V(A) = N(R)
7.2
RESTART T200
V(A) = N(R)
7.3
RR response F=0
V(A) < N(R) < V(S)
RR response F=1
V(A) < N(R) < V(S)
MDL-ERR-IND(A)
RESTART T200
V(A) = N(R)
MDL-ERR-IND(A)
RESTART T200
V(A) = N(R)
7.0
MDL-ERR-IND(A)
RESTART T200
V(A) = N(R)
7.1
MDL-ERR-IND(A)
RESTART T200
V(A) = N(R)
7.2
MDL-ERR-IND(A)
RESTART T200
V(A) = N(R)
7.3
TABLE D-2.4a/Q.921 STATE TRANSITION TABLE: Receiving RR supervisory frame with correct format
Page 124
ETS 300 125: September 1991
BASIC STATE
MULTIPLE FRAME ESTABLISHED
TRANSMITTER CONDITION
NORMAL
NORMAL
NORMAL
NORMAL
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
RECEIVER CONDITION
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
STATE NUMBER
7.0
7.1
7.2
7.3
7.4
7.5
7.6
7.7
RR command P=1
V(A) = N(R) < V(S)
TX RR F=1
TX RNR F=1
TX RR F=1
7.0
TX RR F=1
7.1
TX RNR F=1
7.2
TX RNR F=1
7.3
RR command P=0
V(A) = N(R) < V(S)
-
-
-
-
7.0
7.1
7.2
7.3
RR response F=0
V(A) = N(R) < V(S)
-
-
-
-
RR response F=1
V(A) = N(R) < V(S)
MDL-ERR-IND(A)
MDL-ERR-IND(A)
7.0
MDL-ERR-IND(A)
7.1
MDL-ERR-IND(A)
7.2
MDL-ERR-IND(A)
7.3
RR command P=1
N(R) error
TX RR F=1
MDL-ERR-IND(J)
RC=0
TX SABME P=1
STOP T203
RESTART T200
5.1
TX RNR F=1
MDL-ERR-IND(J)
RC=0
TX SABME P=1
STOP T203
RESTART T200
5.1
TX RR F=1
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
TX RNR F=1
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
RR command P=0
N(R) error
MDL-ERR-IND(J)
RC=0
TX SABME P=1
STOP T203
RESTART T200
5.1
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
RR response F=0
N(R) error
RR response F=1
N(R) error
MDL-ERR-IND(A)
MDL-ERR-IND(J)
RC=0
TX SABME P=1
STOP T203
RESTART T200
5.1
MDL-ERR-IND(A)
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
TABLE D-2.4b/Q.921 STATE TRANSITION TABLE: Receiving RR supervisory frame with correct format
Page 125
ETS 300 125: September 1991
BASIC STATE
MULTIPLE FRAME ESTABLISHED
TRANSMITTER CONDITION
NORMAL
NORMAL
NORMAL
NORMAL
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
RECEIVER CONDITION
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
STATE NUMBER
7.0
7.1
7.2
7.3
7.4
7.5
7.6
7.7
REJ command P=1
N(R) =V(S)
(Note)
TX RR F=1
V(A)=N(R)
STOP T200
RESTART T203
TX RNR F=1
V(A)=N(R)
STOP T200
RESTART T203
TX RR F=1
V(A)=N(R)
STOP T200
START T203
7.0
TX RR F=1
V(A)=N(R)
STOP T200
START T203
7.1
TX RNR F=1
V(A)=N(R)
STOP T200
START T203
7.2
TX RNR F=1
V(A)=N(R)
STOP T200
START T203
7.3
REJ command P=0
N(R) =V(S)
(Note)
V(A)=N(R)
STOP T200
RESTART T203
V(A)=N(R)
STOP T200
START T203
7.0
V(A)=N(R)
STOP T200
START T203
7.1
V(A)=N(R)
STOP T200
START T203
7.2
V(A)=N(R)
STOP T200
START T203
7.3
REJ response F=0
N(R) =V(S) (Note)
REJ response F=1
N(R) =V(S)
(Note)
MDL-ERR-IND(A)
V(A)=N(R)
STOP T200
RESTART T203
MDL-ERR-IND(A)
V(A)=N(R)
STOP T200
START T203
7.0
MDL-ERR-IND(A)
V(A)=N(R)
STOP T200
START T203
7.1
MDL-ERR-IND(A)
V(A)=N(R)
STOP T200
START T203
7.2
MDL-ERR-IND(A)
V(A)=N(R)
STOP T200
START T203
7.3
REJ command P=1
V(A) ≤ N(R) < V(S)
TX RR F=1
V(S)=V(A)=N(R)
STOP T200
START T203
TX RNR F=1
V(S)=V(A)=N(R)
STOP T200
START T203
TX RR F=1
V(S)=V(A)=N(R)
STOP T200
START T203
7.0
TX RR F=1
V(S)=V(A)=N(R)
STOP T200
START T203
7.1
TX RNR F=1
V(S)=V(A)=N(R)
STOP T200
START T203
7.2
TX RNR F=1
V(S)=V(A)=N(R)
STOP T200
START T203
7.3
REJ command P=0
V(A) ≤ N(R) < V(S)
V(S)=V(A)=N(R)
STOP T200
START T203
V(S)=V(A)=N(R)
STOP T200
START T203
7.0
V(S)=V(A)=N(R)
STOP T200
START T203
7.1
V(S)=V(A)=N(R)
STOP T200
START T203
7.2
V(S)=V(A)=N(R)
STOP T200
START T203
7.3
REJ response F=0
V(A) ≤ N(R) < V(S)
REJ response P=1
V(A) ≤ N(R) < V(S)
MDL-ERR-IND(A)
V(S)=V(A)=N(R)
STOP T200
START T203
MDL-ERR-IND(A)
V(S)=V(A)=N(R)
STOP T200
START T203
7.0
MDL-ERR-IND(A)
V(S)=V(A)=N(R)
STOP T200
START T203
7.1
MDL-ERR-IND(A)
V(S)=V(A)=N(R)
STOP T200
START T203
7.2
MDL-ERR-IND(A)
V(S)=V(A)=N(R)
STOP T200
START T203
7.3
TABLE D-2.5a/Q.921 STATE TRANSITION TABLE: Receiving REJ supervisory frame with correct format
Note -
This event is impossibe by the definition of the peer-to-peer data link procedures. However, it would not harm the information transfer, if the actions
according to this table are taken.
Page 126
ETS 300 125: September 1991
BASIC STATE
MULTIPLE FRAME ESTABLISHED
TRANSMITTER CONDITION
NORMAL
NORMAL
NORMAL
NORMAL
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
RECEIVER CONDITION
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
STATE NUMBER
7.0
7.1
7.2
7.3
7.4
7.5
7.6
7.7
REJ command P=1
N(R) error
TX RR F=1
MDL-ERR-IND(J)
RC = 0
TX SABME P=1
STOP T203
RESTART T200
5.1
TX RNR F=1
MDL-ERR-IND(J)
TX SABME P=1
STOP T203
RESTART T200
5.1
TX RR F=1
MDL-ERR-IND(J)
RC = 0
TX SABME P=1
RESTART T200
5.1
TX RNR F=1
MDL-ERR-IND(J)
TX SABME P=1
RESTART T200
5.1
REJ command P=0
N(R) error
MDL-ERR-IND(J)
RC=0
TX SABME P=1
STOP T203
RESTART T200
5.1
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
REJ response F=0
N(R) error
REJ response F=1
N(R) error
MDL-ERR-IND(A)
MDL-ERR-IND(J)
RC=0
TX SABME P=1
STOP T203
RESTART T200
5.1
MDL-ERR-IND(A)
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
TABLE D-2.5b/Q.921 STATE TRANSITION TABLE: Receiving REJ supervisory frame with correct format
Page 127
ETS 300 125: September 1991
BASIC STATE
MULTIPLE FRAME ESTABLISHED
TRANSMITTER CONDITION
NORMAL
NORMAL
NORMAL
NORMAL
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
RECEIVER CONDITION
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
STATE NUMBER
7.0
7.1
7.2
7.3
7.4
7.5
7.6
7.7
RNR command P=1
N(R) = V(S)
TX RR F=1
STOP T203
RESTART T200
V(A) = N(R)
7.4
TX RR F=1
STOP T203
RESTART T200
V(A) = N(R)
7.5
TX RNR F=1
STOP T203
RESTART T200
V(A) = N(R)
7.6
TX RNR F=1
STOP T203
RESTART T200
V(A) = N(R)
7.7
TX RR F=1
RESTART T200
V(A) = N(R)
TX RNR F=1
RESTART T200
V(A) = N(R)
RNR command P=0
N(R) = V(S)
STOP T203
RESTART T200
V(A) = N(R)
7.4
STOP T203
RESTART T200
V(A) = N(R)
7.5
STOP T203
RESTART T200
V(A) = N(R)
7.6
STOP T203
RESTART T200
V(A) = N(R)
7.7
RESTART T200
V(A) = N(R)
RNR response F=0
N(R) = V(S)
RNR response F=1
N(R) = V(S)
MDL-ERR-IND(A)
STOP T203
RESTART T200
V(A) = N(R)
7.4
MDL-ERR-IND(A)
STOP T200
RESTART T200
V(A) = N(R)
7.5
MDL-ERR-IND(A)
STOP T203
RESTART T200
V(A) = N(R)
7.6
MDL-ERR-IND(A)
STOP T203
RESTART T200
V(A) = N(R)
7.7
MDL-ERR-IND(A)
RESTART T200
V(A) = N(R)
RNR command P=1
V(A) ≤ N(R) < V(S)
TX RR F=1
RESTART T200
V(A) = N(R)
7.4
TX RR F=1
RESTART T200
V(A) = N(R)
7.5
TX RNR F=1
RESTART T200
V(A) = N(R)
7.6
TX RNR F=1
RESTART T200
V(A) = N(R)
7.7
TX RR F=1
RESTART T200
V(A) = N(R)
TX RNR F=1
RESTART T200
V(A) = N(R)
RNR command P=0
V(A) ≤ N(R) < V(S)
RESTART T200
V(A) = N(R)
7.4
RESTART T200
V(A) = N(R)
7.5
RESTART T200
V(A) = N(R)
7.6
RESTART T200
V(A) = N(R)
7.7
RESTART T200
V(A) = N(R)
RNR response F=0
V(A) ≤ N(R) < V(S)
RNR response F=1
V(A) ≤ N(R) < V(S)
MDL-ERR-IND(A)
RESTART T200
V(A) = N(R)
7.4
MDL-ERR-IND(A)
RESTART T200
V(A) = N(R)
7.5
MDL-ERR-IND(A)
RESTART T200
V(A) = N(R)
7.6
MDL-ERR-IND(A)
RESTART T200
V(A) = N(R)
7.7
MDL-ERR-IND(A)
RESTART T200
V(A) = N(R)
TABLE D-2.6a/Q.921 STATE TRANSITION TABLE: Receiving RNR supervisory frame with correct format
Page 128
ETS 300 125: September 1991
BASIC STATE
MULTIPLE FRAME ESTABLISHED
TRANSMITTER CONDITION
NORMAL
NORMAL
NORMAL
NORMAL
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
RECEIVER CONDITION
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
STATE NUMBER
7.0
7.1
7.2
7.3
7.4
7.5
7.6
7.7
RNR command P=1
N(R) error
TX RR F=1
MDL-ERR-IND(J)
RC=0
TX SABME P=1
STOP T203
RESTART T200
5.1
TX RNR F=1
MDL-ERR-IND(J)
RC=0
TX SABME P=1
STOP T203
RESTART T200
5.1
TX RR F=1
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
TX RNR F=1
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
RNR command P=0
N(R) error
MDL-ERR-IND(J)
RC=0
TX SABME P=1
STOP T203
RESTART T200
5.1
MDL-ERR-IND(J)
RC=0
TX SABME P=1
STOP T203
RESTART T200
5.1
RNR response F=0
N(R) error
RNR response F=1
N(R) error
MDL-ERR-IND(A)
MDL-ERR-IND(J)
RC=0
TX SABME P=1
STOP T203
RESTART T200
5.1
MDL-ERR-IND(A)
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
TABLE D-2.6b/Q.921 STATE TRANSITION TABLE: Receiving RNR supervisory frame with correct format
Page 129
ETS 300 125: September 1991
BASIC STATE
MULTIPLE FRAME ESTABLISHED
TRANSMITTER CONDITION
NORMAL
NORMAL
NORMAL
NORMAL
PEER REC. BUSY
PEER REC. BUSY
PEER REC. BUSY
PEER REC. BUSY
RECEIVER CONDITION
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN REC.
BUSY
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN REC.
BUSY
STATE NUMBER
7.0
7.1
7.2
7.3
7.4
7.5
7.6
7.7
I command P=1
N(S) = V(R)
N(R) = V(S)
V(R)=V(R)+1
DL-DATA-IND
TX RR F=1
STOP T200
RESTART T203
V(A) = N(R)
V(R)=V(R)+1
DL-DATA-IND
TX RR F=1
STOP T200
RESTART T203
V(A) = N(R)
7.0
"DISCARD"
TX RNR F=1
STOP T200
RESTART T203
V(A) = N(R)
V(R)=V(R)+1
DL-DATA-IND
TX RR F=1
V(A) = N(R)
V(R)=V(R)+1
DL-DATA-IND
TX RR F=1
V(A) = N(R)
7.4
"DISCARD"
TX RNR F=1
V(A) = N(R)
I command P=0
N(S) = V(R)
N(R) = V(S)
V(R)=V(R)+1
DL-DATA-IND
TX ACK
STOP T200
RESTART T203
V(A) = N(R)
V(R)=V(R)+1
DL-DATA-IND
TX ACK
STOP T200
RESTART T203
V(A) = N(R)
7.0
"DISCARD"
STOP T200
RESTART T203
V(A) = N(R)
V(R)=V(R)+1
DL-DATA-IND
TX RR F=0
V(A) = N(R)
V(R)=V(R)+1
DL-DATA-IND
TX RR F=0
V(A) = N(R)
7.4
"DISCARD"
V(A) = N(R)
I command P=1
N(S) ≠ V(R)
N(R) = V(S)
"DISCARD"
TX REJ F=1
STOP T200
RESTART T203
V(A) = N(R)
7.1
"DISCARD"
TX RR F=1
STOP T200
RESTART T203
V(A) = N(R)
"DISCARD"
TX RNR F=1
STOP T200
RESTART T203
V(A) = N(R)
"DISCARD"
TX REJ F=1
V(A) = N(R)
7.5
"DISCARD"
TX RR F=1
V(A) = N(R)
"DISCARD"
TX RNR F=1
V(A) = N(R)
I command P=0
N(S) ≠ V(R)
N(R) = V(S)
"DISCARD"
TX REJ F=0
STOP T200
RESTART T203
V(A) = N(R)
7.1
"DISCARD"
STOP T200
RESTART T203
V(A) = N(R)
"DISCARD"
TX REJ F=0
V(A) = N(R)
7.5
"DISCARD"
V(A) = N(R)
I command P=1
N(S) = V(R)
V(A) < N(R) < V(S)
V(R)=V(R)+1
DL-DATA-IND
TX RR F=1
RESTART T200
V(A) = N(R)
V(R)=V(R)+1
DL-DATA-IND
TX RR F=1
RESTART T200
V(A) = N(R)
7.0
"DISCARD"
TX RNR F=1
RESTART T200
V(A) = N(R)
V(R)=V(R)+1
DL-DATA-IND
TX RR F=1
V(A) = N(R)
V(R)=V(R)+1
DL-DATA-IND
TX RR F=1
V(A) = N(R)
7.4
"DISCARD"
TX RNR F=1
V(A) = N(R)
I command P=0
N(S) = V(R)
V(A) < N(R) < V(S)
V(R)=V(R)+1
DL-DATA-IND
TX ACK
RESTART T200
V(A) = N(R)
V(R)=V(R)+1
DL-DATA-IND
TX ACK
RESTART T200
V(A) = N(R)
7.0
"DISCARD"
RESTART T200
V(A) = N(R)
V(R)=V(R)+1
DL-DATA-IND
TX RR F=0
V(A) = N(R)
V(R)=V(R)+1
DL-DATA-IND
TX RR F=0
V(A) = N(R)
7.4
"DISCARD"
V(A) = N(R)
I command P=1
N(S) ≠ V(R)
V(A) < N(R) < V(S)
"DISCARD"
TX REJ F=1
RESTART T200
V(A) = N(R)
7.1
"DISCARD"
TX RR F=1
RESTART T200
V(A) = N(R)
"DISCARD"
TX RNR F=1
RESTART T200
V(A) = N(R)
"DISCARD"
TX REJ F=1
V(A) = N(R)
7.5
"DISCARD"
TX RR F=1
V(A) = N(R)
"DISCARD"
TX RNR F=1
V(A) = N(R)
I command P=0
N(S) ≠ V(R)
V(A) < N(R) < V(S)
"DISCARD"
TX REJ F=0
RESTART T200
V(A) = N(R)
7.1
"DISCARD"
RESTART T200
V(A) = N(R)
"DISCARD"
TX REJ F=0
V(A) = N(R)
7.5
"DISCARD"
V(A) = N(R)
TABLE D-2.7/Q.921 STATE TRANSITION TABLE: Receiving I command frame with correct format acknowledging all outstanding I frames or containing an
N(R) which is V(A) < N(R) < V(S)
Page 130
ETS 300 125: September 1991
BASIC STATE
MULTIPLE FRAME ESTABLISHED
TRANSMITTER CONDITION
NORMAL
NORMAL
NORMAL
NORMAL
PEER REC. BUSY
PEER REC. BUSY
PEER REC. BUSY
PEER REC. BUSY
RECEIVER CONDITION
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN REC.
BUSY
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN REC.
BUSY
STATE NUMBER
7.0
7.1
7.2
7.3
7.4
7.5
7.6
7.7
I command P=1
N(S) = V(R)
V(A) = N(R) < V(S)
V(R)=V(R)+1
DL-DATA-IND
TX RR F=1
V(R)=V(R)+1
DL-DATA-IND
TX RR F=1
7.0
"DISCARD"
TX RNR F=1
V(R)=V(R)+1
DL-DATA-IND
TX RR F=1
V(R)=V(R)+1
DL-DATA-IND
TX RR F=1
7.4
"DISCARD"
TX RNR F=1
I command P=0
N(S) = V(R)
V(A) = N(R) < V(S)
V(R)=V(R)+1
DL-DATA-IND
TX ACK
V(R)=V(R)+1
DL-DATA-IND
TX ACK
7.0
"DISCARD"
V(R)=V(R)+1
DL-DATA-IND
TX RR F=0
V(R)=V(R)+1
DL-DATA-IND
TX RR F=0
"DISCARD"
I command P=1
N(S) ≠ V(R)
V(A) = N(R) < V(S)
"DISCARD"
TX REJ F=1
7.1
"DISCARD"
TX RR F=1
"DISCARD"
TX RNR F=1
"DISCARD"
TX REJ F=1
7.5
"DISCARD"
TX RR F=1
"DISCARD"
TX RNR F=1
I command P=0
N(S) ≠ V(R)
V(A) = N(R) < V(S)
"DISCARD"
TX REJ F=0
7.1
"DISCARD"
"DISCARD"
TX REJ F=0
7.5
"DISCARD"
I command P=1
N(S) = V(R)
N(R) error
V(R)=V(R)+1
DL-DATA-IND
TX RR F=1
MDL-ERR-IND(J)
RC=0
TX SABME P=1
STOP T203
RESTART T200
5.1
"DISCARD"
TX RNR F=1
MDL-ERR-IND(J)
RC=0
TX SABME P=1
STOP T203
RESTART T200
5.1
V(R)=V(R)+1
DL-DATA-IND
TX RR F=1
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
"DISCARD"
TX RNR F=1
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
I command P=0
N(S) = V(R)
N(R) error
V(R)=V(R)+1
DL-DATA-IND
MDL-ERR-IND(J)
RC=0
TX SABME P=1
STOP T203
RESTART T200
5.1
"DISCARD"
MDL-ERR-IND(J)
RC=0
TX SABME P=1
STOP T203
RESTART T200
5.1
V(R)=V(R)+1
DL-DATA-IND
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
"DISCARD"
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
I command P=1
N(S) ≠ V(R)
N(R) error
"DISCARD"
TX REJ F=1
MDL-ERR-IND(J)
RC=0
TX SABME P=1
STOP T203
RESTART T200
5.1
"DISCARD"
TX RR F=1
MDL-ERR-IND(J)
RC=0
TX SABME P=1
STOP T203
RESTART T200
5.1
"DISCARD"
TX RNR F=1
MDL-ERR-IND(J)
RC=0
TX SABME P=1
STOP T203
RESTART T200
5.1
"DISCARD"
TX REJ F=1
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
"DISCARD"
TX RR F=1
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
"DISCARD"
TX RNR F=1
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
I command P=0
N(S) ≠ V(R)
N(R) error
"DISCARD"
TX REJ F=0
MDL-ERR-IND(J)
RC=0
TX SABME P=1
STOP T203
RESTART T200
5.1
"DISCARD"
MDL-ERR-IND(J)
RC=0
TX SABME P=1
STOP T203
RESTART T200
5.1
"DISCARD"
TX REJ F=0
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
"DISCARD"
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
TABLE D-2.8/Q.921 STATE TRANSITION TABLE: Receiving I command frame with correct format containing an N(R) which is V(A) = N(R) < V(S) or an N(R)
error
Page 131
ETS 300 125: September 1991
BASIC STATE
MULTIPLE FRAME ESTABLISHED
TRANSMITTER CONDITION
NORMAL
NORMAL
NORMAL
NORMAL
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
RECEIVER CONDITION
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
STATE NUMBER
7.0
7.1
7.2
7.3
7.4
7.5
7.6
7.7
T200 TIME-OUT
RC =0
either
V(S)=V(S)-1
TX I P=1
V(S)=V(S)+1
or
TX RR P=1
THEN
RC=RC+1
START T200
8.0
RC =0
either
V(S)=V(S)-1
TX I P=1
V(S)=V(S)+1
or
TX RR P=1
THEN
RC=RC+1
START T200
8.1
RC =0
either
V(S)=V(S)-1
TX I P=1
V(S)=V(S)+1
or
TX RNR P=1
THEN
RC=RC+1
START T200
8.2
RC =0
either
V(S)=V(S)-1
TX I P=1
V(S)=V(S)+1
or
TX RNR P=1
THEN
RC=RC+1
START T200
8.3
RC=0
TX RR P=1
RC=RC+1
START T200
8.4
RC=0
TX RR P=1
RC=RC+1
START T200
8.5
RC=0
TX RNR P=1
RC=RC+1
START T200
8.6
RC=0
TX RNR P=1
RC=RC+1
START T200
8.7
T203 TIME-OUT
RC=0
TX RR P=1
START T200
8.0
RC=0
TX RR P=1
START T200
8.1
RC=0
TX RNR P=1
START T200
8.2
RC=0
TX RNR P=1
START T200
8.3
/
/
/
/
SET OWN
RECEIVER BUSY (Note)
TX RNR F=0
7.2
TX RNR F=0
7.3
-
-
TX RNR F=0
7.6
TX RNR F=0
7.7
-
-
CLEAR OWN
RECEIVER BUSY (Note)
-
-
TX RR F=0
7.0
TX RR F=0
7.1
-
-
TX RR F=0
7.4
TX RR F=0
7.5
TABLE D-2.9/Q.921 STATE TRANSITION TABLE: Internal events (Expiry of timers, receiver busy condition)
Note -
These signals are generated outside the procedures specified in this state transition table, and may be generated by the connection management
entity.
Page 132
ETS 300 125: September 1991
BASIC STATE
MULTIPLE FRAME ESTABLISHED
TRANSMITTER CONDITION
NORMAL
NORMAL
NORMAL
NORMAL
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
RECEIVER CONDITION
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
STATE NUMBER
7.0
7.1
7.2
7.3
7.4
7.5
7.6
7.7
SABME incorrect length
MDL-ERR-IND(N)
RC=0
TX SABME P=1
STOP T203
RESTART T200
5.1
DISC incorrect length
UA incorrect length
DM incorrect length
FRMR incorrect length
Supervisory frame RR, REJ,
RNR incorrect length
N201 error
MDL-ERR-IND(O)
RC=0
TX SABME P=1
STOP T203
RESTART T200
5.1
Undefined command and
response control field
MDL-ERR-IND(L)
RC=0
TX SABME P=1
STOP T203
RESTART T200
5.1
I field not permitted
MDL-ERR-IND(M)
RC=0
TX SABME P=1
STOP T203
RESTART T200
5.1
TABLE D-2.10/Q.921 STATE TRANSITION TABLE: Receiving frame with incorrect format or frame with undefined control field
Page 133
ETS 300 125: September 1991
BASIC STATE
TIMER RECOVERY
TRANSMITTER CONDITION
NORMAL
NORMAL
NORMAL
NORMAL
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
RECEIVER CONDITION
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
STATE NUMBER
8.0
8.1
8.2
8.3
8.4
8.5
8.6
8.7
DL-ESTABLISH -REQUEST
DISC. I QUEUE
RC=0
TX SABME P=1
RESTART T200
5.0
DL-RELEASE -REQUEST
DISC. I QUEUE
RC=0
TX DISC P=1
RESTART T200
6
DL-DATA-REQUEST
DATA INTO I
QUEUE
I FRAME IN QUEUE
V(S) < V(A) +k
LEAVE I FRAME
IN QUEUE
I FRAME IN QUEUE
V(S) = V(A) +k
DL-UNIT DATA -REQUEST
UNIT DATA INTO
I QUEUE
UI FRAME IN QUEUE
TX UI P=0
MDL-ASSIGN-REQUEST
I
MDL-REMOVE-REQUEST
DL-REL-IND
DISC. I and UI
QUEUES
STOP T200
1
MDL-ERROR-RESPONSE
I
PERSISTENT DEACTIVATION
DL-REL-IND
DISC. I and UI
QUEUES
STOP T200
4
TABLE D-3.1/Q.921 STATE TRANSITION TABLE: Receiving primitive
Page 134
ETS 300 125: September 1991
BASIC STATE
TIMER RECOVERY
TRANSMITTER CONDITION
NORMAL
NORMAL
NORMAL
NORMAL
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
RECEIVER CONDITION
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
STATE NUMBER
8.0
8.1
8.2
8.3
8.4
8.5
8.6
8.7
SABME P=1
V(S) = V(A)
MDL-ERR-IND(F)
V(S,R,A)=0
TX UA F=1
STOP T200
START T203
7.0
SABME P=1
V(S) ≠ V(A)
DL-EST-IND
MDL-ERR-IND(F)
DISC. I QUEUE
V(S,R,A)=0
TX UA F=1
STOP T200
START T203
7.0
SABME P=0
V(S) = V(A)
MDL-ERR-IND(F)
V(S,R,A)=0
TX UA F=0
STOP T200
START T203
7.0
SABME P=0
V(S) ≠ V(A)
DL-EST-IND
MDL-ERR-IND(F)
DISC. I QUEUE
V(S,R,A)=0
TX UA F=0
STOP T200
START T203
7.0
DISC P=1
DL-REL-IND
DISC. I QUEUE
TX UA F=1
STOP T200
4
DISC P=0
DL-REL-IND
DISC. I QUEUE
TX UA F=0
STOP T200
4
TABLE D-3.2a/Q.921 STATE TRANSITION TABLE: Receiving unnumbered frame with correct format
Page 135
ETS 300 125: September 1991
BASIC STATE
TIMER RECOVERY
TRANSMITTER CONDITION
NORMAL
NORMAL
NORMAL
NORMAL
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
RECEIVER CONDITION
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
STATE NUMBER
8.0
8.1
8.2
8.3
8.4
8.5
8.6
8.7
UA F=1
MDL-ERR-IND(C)
UA F=0
MDL-ERR-IND (D)
DM F=1
MDL-ERR-IND(B)
RC=0
TX SABME P=1
RESTART T200
5.1
DM F=0
MDL-ERR-IND(E)
RC=0
TX SABME P=1
RESTART T200
5.1
UI command
DL-UNIT
DATA -IND
TABLE D-3.2b/Q.921 STATE TRANSITION TABLE: Receiving unnumbered frame with correct format
BASIC STATE
TIMER RECOVERY
TRANSMITTER CONDITION
NORMAL
NORMAL
NORMAL
NORMAL
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
RECEIVER CONDITION
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
STATE NUMBER
8.0
8.1
8.2
8.3
8.4
8.5
8.6
8.7
FRMR response rejecting
SABME
/
/
/
/
/
/
/
/
FRMR response rejecting DISC
/
/
/
/
/
/
/
/
FRMR response rejecting UA
/
/
/
/
/
/
/
/
FRMR response rejecting DM
/
/
/
/
/
/
/
/
FRMR response rejecting I
command
MDL-ERR-IND(K)
RC=0
TX SABME P=1
RESTART T200
5.1
FRMR response rejecting S
frame
FRMR response rejecting
FRMR
/
/
/
/
/
/
/
/
TABLE D-3.3/Q.921 STATE TRANSITION TABLE: Receiving FRMR unnumbered frame with correct format
Page 136
ETS 300 125: September 1991
BASIC STATE
TIMER RECOVERY
TRANSMITTER CONDITION
NORMAL
NORMAL
NORMAL
NORMAL
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
RECEIVER CONDITION
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
STATE NUMBER
8.0
8.1
8.2
8.3
8.4
8.5
8.6
8.7
RR command P=1
V(A) ≤ N(R) ≤ V(S)
TX RR F=1
V(A) = N(R)
TX RNR F=1
V(A) = N(R)
TX RR F=1
V(A) = N(R)
8.0
TX RR F=1
V(A) = N(R)
8.1
TX RNR F=1
V(A) = N(R)
8.2
TX RNR F=1
V(A) = N(R)
8.3
RR command P=0
V(A) ≤ N(R) ≤ V(S)
V(A) = N(R)
V(A) = N(R)
8.0
V(A) = N(R)
8.1
V(A) = N(R)
8.2
V(A) = N(R)
8.3
RR response F=0
V(A) ≤ N(R) ≤ V(S)
RR response F=1
V(A) ≤ N(R) ≤ V(S)
V(S) = N(R)
STOP T200
START T203
V(A) = N(R)
7.0
V(S) = N(R)
STOP T200
START T203
V(A) = N(R)
7.1
V(S) = N(R)
STOP T200
START T203
V(A) = N(R)
7.2
V(S) = N(R)
STOP T200
START T203
V(A) = N(R)
7.3
V(S) = N(R)
STOP T200
START T203
V(A) = N(R)
7.0
V(S) = N(R)
STOP T200
START T203
V(A) = N(R)
7.1
V(S) = N(R)
STOP T200
START T203
V(A) = N(R)
7.2
V(S) = N(R)
STOP T200
START T203
V(A) = N(R)
7.3
RR command P=1
N(R) error
TX RR F=1
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
TX RNR F=1
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
TX RR F=1
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
TX RNR F=1
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
RR command P=0
N(R) error
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
RR response F=0
N(R) error
RR response F=1
N(R) error
TABLE D-3.4/Q.921 STATE TRANSITION TABLE: Receiving RR supervisory frame with correct format; clearance of timer recovery if there is F=1 only
Page 137
ETS 300 125: September 1991
BASIC STATE
TIMER RECOVERY
TRANSMITTER CONDITION
NORMAL
NORMAL
NORMAL
NORMAL
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
RECEIVER CONDITION
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
STATE NUMBER
8.0
8.1
8.2
8.3
8.4
8.5
8.6
8.7
REJ command P=1
V(A) ≤ N(R) ≤ V(S)
TX RR F=1
V(A) = N(R)
TX RNR F=1
V(A) = N(R)
TX RR F=1
V(A) = N(R)
8.0
TX RR F=1
V(A) = N(R)
8.1
TX RNR F=1
V(A) = N(R)
8.2
TX RNR F=1
V(A) = N(R)
8.3
REJ command P=0
V(A) ≤ N(R) ≤ V(S)
V(A) = N(R)
V(A) = N(R)
8.0
V(A) = N(R)
8.1
V(A) = N(R)
8.2
V(A) = N(R)
8.3
REJ response F=0
V(A) ≤ N(R) ≤ V(S)
REJ response F=1
V(A) ≤ N(R) ≤ V(S)
V(S) = V(R) =
N(R)
STOP T200
START T203
7.0
V(S) = V(R) =
N(R)
STOP T200
START T203
7.1
V(S) = V(R) =
N(R)
STOP T200
START T203
7.2
V(S) = V(R) =
N(R)
STOP T200
START T203
7.3
V(S) = V(R) =
N(R)
STOP T200
START T203
7.0
V(S) = V(R) =
N(R)
STOP T200
START T203
7.1
V(S) = V(R) =
N(R)
STOP T200
START T203
7.2
V(S) = V(R) =
N(R)
STOP T200
START T203
7.3
REJ command P=1
N(R) error
TX RR F=1
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
TX RNR F=1
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
TX RR F=1
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
TX RNR F=1
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
REJ command P=0
N(R) error
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
REJ response F=0
N(R) error
REJ response F=1
N(R) error
TABLE D-3.5/Q.921 STATE TRANSITION TABLE: Receiving REJ supervisory frame with correct format; clearance of timer recovery if there is F=1 only
Page 138
ETS 300 125: September 1991
BASIC STATE
TIMER RECOVERY
TRANSMITTER CONDITION
NORMAL
NORMAL
NORMAL
NORMAL
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
RECEIVER CONDITION
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
STATE NUMBER
8.0
8.1
8.2
8.3
8.4
8.5
8.6
8.7
RNR command P=1
V(A) ≤ N(R) ≤ V(S)
TX RR F=1
V(A) = N(R)
8.4
TX RR F=1
V(A) = N(R)
8.5
TX RNR F=1
V(A) = N(R)
8.6
TX RNR F=1
V(A) = N(R)
8.7
TX RR F=1
V(A) = N(R)
TX RNR F=1
V(A) = N(R)
RNR command P=0
V(A) ≤ N(R) ≤ V(S)
V(A) = N(R)
8.4
V(A) = N(R)
8.5
V(A) = N(R)
8.6
V(A) = N(R)
8.7
V(A) = N(R)
RNR response F=0
V(A) ≤ N(R) ≤ V(S)
RNR response F=1
V(A) ≤ N(R) ≤ V(S)
V(S) = N(R)
RESTART T200
V(A) = N(R)
7.4
V(S) = N(R)
RESTART T200
V(A) = N(R)
7.5
V(S) = N(R)
RESTART T200
V(A) = N(R)
7.6
V(S) = N(R)
RESTART T200
V(A) = N(R)
7.7
V(S) = N(R)
RESTART T200
V(A) = N(R)
7.4
V(S) = N(R)
RESTART T200
V(A) = N(R)
7.5
V(S) = N(R)
RESTART T200
V(A) = N(R)
7.6
V(S) = N(R)
RESTART T200
V(A) = N(R)
7.7
RNR command P=1
N(R) error
TX RR F=1
MDL-ERR-IND (J)
RC=0
TX SABME P=1
RESTART T200
5.1
TX RNR F=1
MDL-ERR-IND (J)
RC=0
TX SABME P=1
RESTART T200
5.1
TX RR F=1
MDL-ERR-IND (J)
RC=0
TX SABME P=1
RESTART T200
5.1
TX RNR F=1
MDL-ERR-IND (J)
RC=0
TX SABME P=1
RESTART T200
5.1
RNR command P=0
N(R) error
MDL-ERR-IND (J)
RC=0
TX SABME P=1
RESTART T200
5.1
RNR response F=0
N(R) error
RNR response F=1
N(R) error
TABLE D-3.6/Q.921 STATE TRANSITION TABLE: Receiving RNR supervisory frame with correct format; clearance of timer recovery if there is F=1 only
Page 139
ETS 300 125: September 1991
BASIC STATE
TIMER RECOVERY
TRANSMITTER CONDITION
NORMAL
NORMAL
NORMAL
NORMAL
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
RECEIVER CONDITION
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
STATE NUMBER
8.0
8.1
8.2
8.3
8.4
8.5
8.6
8.7
I command P=1
N(S) = V(R)
N(R) = V(S)
V(R)=V(R)+1
DL-DATA-IND
TX RR F=1
V(A) = N(R)
V(R)=V(R)+1
DL-DATA-IND
TX RR F=1
V(A) = N(R)
8.0
"DISCARD"
TX RNR F=1
V(A) = N(R)
V(R)=V(R)+1
DL-DATA-IND
TX RR F=1
V(A) = N(R)
V(R)=V(R)+1
DL-DATA-IND
TX RR F=1
V(A) = N(R)
8.4
"DISCARD"
TX RNR F=1
V(A) = N(R)
I command P=0
N(S) = V(R)
N(R) = V(S)
V(R)=V(R)+1
DL-DATA-IND
TX ACK
V(A) = N(R)
V(R)=V(R)+1
DL-DATA-IND
TX ACK
V(A) = N(R)
8.0
"DISCARD"
V(A) = N(R)
V(R)=V(R)+1
DL-DATA-IND
TX RR F=0
V(A) = N(R)
V(R)=V(R)+1
DL-DATA-IND
TX RR F=0
V(A) = N(R)
8.4
"DISCARD"
V(A) = N(R)
I command P=1
N(S) ≠ V(R)
N(R) = V(S)
"DISCARD"
TX REJ F=1
V(A) = N(R)
8.1
"DISCARD"
TX RR F=1
V(A) = N(R)
"DISCARD"
TX RNR F=1
V(A) = N(R)
"DISCARD"
TX REJ F=1
V(A) = N(R)
8.5
"DISCARD"
TX RR F=1
V(A) = N(R)
"DISCARD"
TX RNR F=1
V(A) = N(R)
I command P=0
N(S) ≠ V(R)
N(R) = V(S)
"DISCARD"
TX REJ F=0
V(A) = N(R)
8.1
"DISCARD"
V(A) = N(R)
"DISCARD"
TX REJ F=0
V(A) = N(R)
8.5
"DISCARD"
V(A) = N(R)
I command P=1
N(S) = V(R)
V(A) < N(R) < V(S)
V(R)=V(R)+1
DL-DATA-IND
TX RR F=1
V(A) = N(R)
V(R)=V(R)+1
DL-DATA-IND
TX RR F=1
V(A) = N(R)
8.0
"DISCARD"
TX RNR F=1
V(A) = N(R)
V(R)=V(R)+1
DL-DATA-IND
TX RR F=1
V(A) = N(R)
V(R)=V(R)+1
DL-DATA-IND
TX RR F=1
V(A) = N(R)
8.4
"DISCARD"
TX RNR F=1
V(A) = N(R)
I command P=0
N(S) = V(R)
V(A) < N(R) < V(S)
V(R)=V(R)+1
DL-DATA-IND
TX ACK
V(A) = N(R)
V(R)=V(R)+1
DL-DATA-IND
TX ACK
V(A) = N(R)
8.0
"DISCARD"
V(A) = N(R)
V(R)=V(R)+1
DL-DATA-IND
TX RR F=0
V(A) = N(R)
V(R)=V(R)+1
DL-DATA-IND
TX RR F=0
V(A) = N(R)
8.4
"DISCARD"
V(A) = N(R)
I command P=1
N(S) ≠ V(R)
V(A) < N(R) < V(S)
"DISCARD"
TX REJ F=1
V(A) = N(R)
8.1
"DISCARD"
TX RR F=1
V(A) = N(R)
"DISCARD"
TX RNR F=1
V(A) = N(R)
"DISCARD"
TX REJ F=1
V(A) = N(R)
8.5
"DISCARD"
TX RR F=1
V(A) = N(R)
"DISCARD"
TX RNR F=1
V(A) = N(R)
I command P=0
N(S) ≠ V(R)
V(A) < N(R) < V(S)
"DISCARD"
TX REJ F=0
V(A) = N(R)
8.1
"DISCARD"
V(A) = N(R)
"DISCARD"
TX REJ F=0
V(A) = N(R)
8.5
"DISCARD"
V(A) = N(R)
TABLE D-3.7/Q.921 STATE TRANSITION TABLE: Receiving I command frame with correct format acknowledging all outstanding frames or containing an
N(R) which is V(A) < N(R) < V(S); no clearance of timer recovery
Page 140
ETS 300 125: September 1991
BASIC STATE
TIMER RECOVERY
TRANSMITTER CONDITION
NORMAL
NORMAL
NORMAL
NORMAL
PEER REC. BUSY
PEER REC. BUSY
PEER REC. BUSY
PEER REC. BUSY
RECEIVER CONDITION
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN REC.
BUSY
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN REC.
BUSY
STATE NUMBER
8.0
8.1
8.2
8.3
8.4
8.5
8.6
8.7
I command P=1
N(S) = V(R)
V(A) = N(R) < V(S)
V(R)=V(R)+1
DL-DATA-IND
TX RR F=1
V(R)=V(R)+1
DL-DATA-IND
TX RR F=1
8.0
"DISCARD"
TX RNR F=1
V(R)=V(R)+1
DL-DATA-IND
TX RR F=1
V(R)=V(R)+1
DL-DATA-IND
TX RR F=1
8.4
"DISCARD"
TX RNR F=1
I command P=0
N(S) = V(R)
V(A) = N(R) < V(S)
V(R)=V(R)+1
DL-DATA-IND
TX ACK
V(R)=V(R)+1
DL-DATA-IND
TX ACK
8.0
"DISCARD"
V(R)=V(R)+1
DL-DATA-IND
TX RR F=0
V(R)=V(R)+1
DL-DATA-IND
TX RR F=0
8.4
"DISCARD"
I command P=1
N(S) ≠ V(R)
V(A) = N(R) < V(S)
"DISCARD"
TX REJ F=1
8.1
"DISCARD"
TX RR F=1
"DISCARD"
TX RNR F=1
"DISCARD"
TX REJ F=1
8.5
"DISCARD"
TX RR F=1
"DISCARD"
TX RNR F=1
I command P=0
N(S) ≠ V(R)
V(A) = N(R) < V(S)
"DISCARD"
TX REJ F=0
8.1
"DISCARD"
"DISCARD"
TX REJ F=0
8.5
"DISCARD"
I command P=1
N(S) = V(R)
N(R) error
V(R)=V(R)+1
DL-DATA-IND
TX RR F=1
MDL-ERR-IND(J)
TX SABME P=1
RC=0
RESTART T200
5.1
"DISCARD"
TX RNR F=1
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
V(R)=V(R)+1
DL-DATA-IND
MDL-ERR-IND(J)
TX RR F=1
RC=0
TX SABME P=1
RESTART T200
5.1
"DISCARD"
TX RNR F=1
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
I command P=0
N(S) = V(R)
N(R) error
V(R)=V(R)+1
DL-DATA-IND
RC=0
MDL-ERR-IND(J)
TX SABME P=1
RESTART T200
5.1
"DISCARD"
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
V(R)=V(R)+1
DL-DATA-IND
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
"DISCARD"
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
I command P=1
N(S) ≠ V(R)
N(R) error
"DISCARD"
TX REJ F=1
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
"DISCARD"
TX RR F=1
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
"DISCARD"
TX RNR F=1
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
"DISCARD"
TX REJ F=1
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
"DISCARD"
TX RR F=1
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
"DISCARD"
TX RNR F=1
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
I command P=0
N(S) ≠ V(R)
N(R) error
"DISCARD"
TX REJ F=0
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
"DISCARD"
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
"DISCARD"
TX REJ F=0
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
"DISCARD"
MDL-ERR-IND(J)
RC=0
TX SABME P=1
RESTART T200
5.1
TABLE D-3.8/Q.921 STATE TRANSITION TABLE: Receiving I command frame with correct format containing an N(R) which is V(A) = N(R) < V(S) or an N(R)
error
Page 141
ETS 300 125: September 1991
BASIC STATE
TIMER RECOVERY
TRANSMITTER CONDITION
NORMAL
NORMAL
NORMAL
NORMAL
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
RECEIVER CONDITION
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
STATE NUMBER
8.0
8.1
8.2
8.3
8.4
8.5
8.6
8.7
T200 TIME-OUT
RC < N200
V(A) < V(S)
either
V(S)=V(S) -1
TX I P=1
V(S)=V(S) +1
or
TX RR P=1
then
RC=RC+1
START T200
either
V(S)=V(S) -1
TX I P=1
V(S)=V(S) +1
or
TX RR P=1
then
RC=RC+1
START T200
TX RR P=1
RC=RC+1
START T200
TX RNR P=1
RC=RC+1
START T200
T200 TIME-OUT
RC < N200
V(A) = V(S)
TX RR P=1
RC=RC+1
START T200
TX RNR P=1
RC=RC+1
START T200
T200 TIME-OUT
RC = N200
MDL-ERR-IND(I)
RC=0
TX SABME P=1
START T200
5.1
T203 TIME-OUT
/
/
/
/
/
/
/
/
SET OWN
RECEIVER BUSY (Note)
TX RNR F=0
8.2
TX RNR F=0
8.3
-
-
TX RNR F=0
8.6
TX RNR F=0
8.7
-
-
CLEAR OWN
RECEIVER BUSY (Note)
-
-
TX RR F=0
8.0
TX RR F=0
8.1
-
-
TX RR F=0
8.4
TX RR F=0
8.5
TABLE D-3.9/Q.921 STATE TRANSITION TABLE: Internal events (expiry of timers, receiver busy condition); Initiation of a re-establishment procedure if
the value of the retransmission count variable is equal to N200
Note -
These signals are generated outside the procedures specified in the state transition table, and may be generated by the connection management entity
Page 142
ETS 300 125: September 1991
BASIC STATE
TIMER RECOVERY
TRANSMITTER CONDITION
NORMAL
NORMAL
NORMAL
NORMAL
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
PEER REC.
BUSY
RECEIVER CONDITION
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
NORMAL
REJ RECOVERY
OWN REC. BUSY
REJ and OWN
REC. BUSY
STATE NUMBER
8.0
8.1
8.2
8.3
8.4
8.5
8.6
8.7
SABME incorrect length
MDL-ERR-IND(N)
RC=0
TX SABME P=1
RESTART T200
5.1
DISC incorrect length
UA incorrect length
DM incorrect length
FRMR incorrect length
Supervisory frame RR, REJ,
RNR incorrect length
N201 error
MDL-ERR-IND(O)
RC=0
TX SABME P=1
RESTART T200
5.1
Undefined command and
response control field
MDL-ERR-IND(L)
RC=0
TX SABME P=1
RESTART T200
5.1
I field not permitted
MDL-ERR-IND(M)
RC=0
TX SABME P=1
RESTART T200
5.1
TABLE D-3.10/Q.921 STATE TRANSITION TABLE: Receiving frame with incorrect format or frame with undefined control field
Page 143
ETS 300 125: September 1991
Appendix I
(to Recommendation Q.921) Retransmission of REJ response frames
I.1
Introduction
This appendix describes an optional procedure which may be used to provide a reject retransmission
procedure.
I.2
Procedure
This optional reject retransmission procedure can supplement the Q.921 LAPD protocol by defining a new
variable for multiple frame operation (Subclause 3.5.2), and by modifying the N(S) sequence error
exception condition reporting and recovery (Subclause 5.8.1).
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
\* NOT FOR APPLICATION IN EUROPEAN NETWORKS \*
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
Page 144
ETS 300 125: September 1991
Appendix II (to Recommendation Q.921) Occurence of MDL-ERROR-INDICATION
within the basic states and actions to be taken by the management
entity
II.1
Introduction
Table II-1/Q.921 gives the error situations in which the MDL-ERROR-INDICATION primitive will be
generated. This primitive notifies the data link layer's connection management entity of the occurred error
situation. The associated error parameter contains the error code that describes the unique error
conditions. Table II-1/Q.921 also identifies the associated connection management actions to be taken
from the network and the user side, based on the types of error conditions reported.
This appendix does not incorporate the retransmission of REJ response frames described in Appendix I.
II.2
Layout of table II-1/Q.921
The "error code" column gives the identification value of each error situation to be included as a
parameter with the MDL-ERROR-INDICATION primitive.
The column entitled "error condition" together with the "Affected states" describes unique protocol error
events and the basic state of the data link layer entity at the point that the MDL-ERROR-INDICATION
primitive is generated.
For a given error condition, the column entitled "Network management action" describes the preferred
action to be taken by the network management entity.
The column entitled "User management action" describes the preferred action to be taken by the user side
management entity on a given error condition.
II.3
Preferred management actions
The various preferred layer management actions on an error situation may be described as one of the
following:
a)
Error log:
This suggests that the network side connection management entity has the preferred action of
logging the event into an error counter. The length and the operation of the counter mechanisms for
the error situations is implementation dependent.
b)
TEI check:
This means that the network side layer management entity invokes the TEI check procedure.
c)
TEI verify:
This means that the user side layer management entity may optionally invoke a TEI verify request
procedure that asks the network side layer management entity to issue a TEI check procedure.
d)
TEI remove:
This means that the user side layer management entity may directly remove its TEI value from
service.
In most of the described error situations, there is either no action to be taken by the user side layer
management or the action to be taken is implementation dependent, as table II-1/Q.921 shows.
"Implementation dependent" means that it is optional whether the user side layer management has
incorporated any form of error counter to log (store) the reported event. If action is taken, the layer
management has to take into account that the data link layer will have initiated a recovery procedure.
Page 145
ETS 300 125: September 1991
Table II-1/Q.921: Management entity actions for MDL error indications
Error type
Error
code
Error
condition
Affecte
d states
(Note 1)
Network management
action
User management
action
A
Supervisory
(F=1)
7
Error log
Implementation
dependent
B
DM (F=1)
7, 8
Error log
Implementation
dependent
Receipt of
unsolicited
response
C
UA (F=1)
4, 7, 8
TEI removal procedure
or
TEI check procedure;
then if TEI:
- free
Remove TEI
D
UA (F=0)
4, 5, 6,
7, 8
remove TEI
-single
no action
- multiple
TEI removal procedure
or
TEI identify verify
procedure
E
DM (F=0)
7, 8
Error log
Implementation
dependant
Peer initiated
re-establ.
F
SABME
7, 8
Error log
Implementation
dependant
G
SABME
5
TEI check procedure;
then if TEI:
- free
remove TEI
Remove TEI
Unsuccessful
retransmission
(N200 times)
H
DISC
6
-single
no action
- multiple
TEI removal procedure
or
TEI identify verify
procedure
I
Status enquiry
7
Error log
Implementation
dependant
J
N(R) error
7, 8
Error log
Implementation
dependant
K
Receipt of
FRMR
response
7, 8
Error log
Implementation
dependant
L
Receipt of
frame with
undefined
control field
4, 5, 6,
7, 8
Error log
Implementation
dependant
Other
M
Note 2
Receipt of I
field not
permitted
4, 5, 6,
7, 8
Error log
Implementation
dependant
N
Receipt of
frame with
wrong size
4, 5, 6,
7, 8
Error log
Implementation
dependant
O
N201 error
4, 5, 6,
7, 8
Error log
Implementation
dependant
NOTE 1:
For the description of the affected states, see Annex B.
NOTE 2:
According to Q.921 § 5.8.5, this error code will never be generated.
Page 146
ETS 300 125: September 1991
Appendix III (to Recommendation Q.921) Optional basic access deactivation
procedures
III.1
Introduction
This appendix provides an example of a deactivation procedure which can be used by the network side
system management to control deactivation of the user-network interface at reference point S or T. Figure
III-1/Q.921 provides a conceptual model of the interactions which are required for this deactivation
procedure.
STATUS (ENABLE/DISABLE)
INFORMATION
(FREE/IN USE/UNIT DATA)
MPH-DEACTIVATE-REQ
MPH-DEACTIVATE-IND
MPH-ACTIVATE-IND
Higher Layers
Monitor
Layer 2
Layer 3
System m anagem ent
Deactivation
procedure
Figure III-1/Q.921: Conceptual model of the interactions for an example of a deactivation
procedure
III.2
Description of the conceptual model
The monitor function uses layer 2 activity as the basis for establishing whether deactivation of the access
can take place. The signal INFORMATION is used to report the layer 2 activity in the following manner:
-
INFORMATION (FREE) indicates that there is no data link connection in the multiple-frame mode of
operation;
-
INFORMATION (IN USE) indicates that there is at least one data link connection in the mode-
setting or multiple-frame mode of operation; and
-
INFORMATION (UNIT DATA) indicates that a UI frame is about to be transmitted, or has just been
received.
Within the data link layer entity the DL-ESTABLISH-REQUEST/INDICATION primitive and DL-RELEASE-
INDICATION/CONFIRM primitives mark the duration of the multiple-frame mode of operation, and the
MDL/DL-UNIT DATA-REQUEST/INDICATION primitives mark the transmission and reception of UI
frames.
A signal STATUS is used to represent the ability of higher layers to enable or disable the deactivation
procedures:
-
STATUS (ENABLE) deactivation procedure enabled; and
-
STATUS (DISABLE) deactivation procedures disabled.
Page 147
ETS 300 125: September 1991
The
MPH-DEACTIVATE-REQUEST,
MPH-DEACTIVATE-INDICATION
and
MPH-ACTIVATE-
INDICATION primitives are used as described in § 4. The definition and usage of these primitives are also
described in Recommendation I.430 [4] and prETS 300 012 [7] which specify layer 1.
Since in the Recommendation I.430 the usage of MPH-DEACTIVATE-INDICATION primitive is an
implementation option, two cases of deactivation procedures are described below.
Section III.3 provides a description of the deactivation procedure when MPH-DEACTIVATE-INDICATION
primitive is delivered to the system management entity.
Section III.4 provides a description of the deactivation procedure when MPH-DEACTIVATE-INDICATION
primitive is not delivered to the system management entity.
NOTE:
These procedures require that all layer 3 entities making use of the acknowledged
information transfer service must release the data link connection at an approporiate
point after the completion of the information transfer.
III.3
Deactivation procedure with MPH-DEACTIVATE-INDICATION
This deactivation procedure makes use of the MPH-DEACTIVATE-INDICATION primitive to provide an
option of layer 1 implementation.
Figure III-2/Q.921 provides a state transition diagram of the deactivation procedure with MPH-
DEACTIVATE-INDICATION primitive.
This deactivation procedure can be represented by six states:
State 1
Information transfer not available and free: (no info xfer and free)
State 2
Information transfer available and free: (info xfer and free )
State 3
Information transfer available and in use: (info xfer and in use)
State 4
Information transfer not available and in use: (no info xfer and in use )
State 5
Information transfer interrupted and free: (info interrupted and free)
State 6
Information transfer interrupted and in use: ( info interrupted and in use)
These six states are described as follows:
-
state 1 represents the state where the access is assumed to be deactivated and no data link
connections are in a mode setting or multiple frame mode of operation;
-
state 2 represents the state where the access is activated and no data link connection is in a mode-
setting or multiple-frame mode of operation. Timer TM01 is running and upon its expiry, if
deactivation is enabled, then an MPH-DEACTIVATE-REQUEST primitive will be issued to layer 1.
The access is then assumed to be deactivated;
-
state 3 represents the state where the access is activatied and at least one data link connection is
in a mode-setting or multiple-frame mode of operation;
-
state 4 represents the state where the access is regarded to be in a transient state (neither
deactivated nor activated) and at least one data link connection is in a mode-setting or multiple-
frame mode of operation. (This state can be entered, for example, due to the arrival of an
INFORMATION (IN USE) signal before an MPH-ACTIVATE-INDICATION primitive;
-
state 5 represents the state where the access is regarded to be in a transient state (neither
deactivated nor activated) and no data link connection is in a mode-setting or multiple-frame mode
of operation. Timer TM01 is running and upon its expiry, if deactivation is enabled, then an MPH-
DEACTIVATE-REQUEST primitive will be issued to layer 1. The access is then assumed to be
dactivated;
Page 148
ETS 300 125: September 1991
-
state 6 represents the state where the access is regarded to be in a transient state (neither
activated nor deactivated) and at least one data link connection is in a mode-setting or multiple-
frame mode of operation;
Timer TM01 is started whenever state 2 is entered:
-
on receipt of an MPH-ACTIVATE-INDICATION primitive in state 1; and
-
on receipt of an INFORMATION (FREE) signal in state 3.
Timer TM01 is started when state 5 is entered:
-
on receipt of an INFORMATION (FREE) signal in state 6.
Timer TM01 is restarted in states 2 and 5 when:
-
TM01 expires while deactivation is disabled by the receipt of a STATUS (DISABLE) SIGNAL; and
-
an INFORMATION (UNIT DATA) signal is received in order to allow sufficient time for current and
further unacknowledged information transfer.
Timer TM01 has a value of ten seconds at the network side.
INFO INTERRUPTED
AND FREE
5
INFO XFER
AND FREE
5
STATES
1 - 6
INFO INTERRUPTED
AND IN USE
5
INFO XFER
AND IN USE
5
NO INFO XFER
AND IN USE
5
NO INFO XFER
AND FREE
5
M PH-ACTIVATE-IND
M PH-DEACTIVATE-IND
STATUS (DISABLE)
[SET DEACT DISABLED]
STATUS (ENABLE)
[SET DEACT ENABLED]
TM 01 EXP DEACT DISABLED
[START TM 01]
INFORM ATIO N (FREE)
[START TM 01]
INFO RM ATION (IN USE)
[STO P TM 01]
M PH-ACTIVATE-IND
INFORM ATIO N (FREE)
INFO RM ATIO N (IN USE)
M PH-ACTIVATE-IND
M PH-DEACTIVATE-IND
TM 01 EXP DEACT ENABLED
[M PH-DEACTIVATE-REQ]
TM 01 EXP DEACT DISABLED
[START TM 01]
INFO RM ATION (UNIT DATA)
[RESTART TM 01]
M PH-ACTIVATE-IND
[START TM 01]
TM 01 EXP DEACT ENABLED
[M PH-DEACTIVATE-REQ ]
INFORM ATIO N (FREE)
[START TM 01]
INFORM ATIO N (IN USE)
[STO P TM 01]
INFO RM ATIO N (UNIT DATA)
[RESTART TM 01]
FIGURE II-2/Q.921
State transition diagram of a deactivation procedure with MPH-DEACTIVATE-INDICATION
Page 149
ETS 300 125: September 1991
III.4
Deactivation procedure without MPH-DEACTIVATE-INDICATION
This deactivation procedure does not make use of the MPH-DEACTIVATE-INDICATION primitive to
provide an option of layer 1 implementation so that this procedure can be represented by only four states,
i.e. state 1, state 2, state 3 and state 4. States 5 and 6 have disappeared.
Figure III-3/Q.921 provides a state transition diagram of the deactivation procedure without MPH-
DEACTIVATE-INDICATION primitive.
STATES
1 - 4
INFO XFER
AND IN USE
3
INFO XFER
AND FREE
2
NO INFO XFER
AND IN USE
4
NO INFO XFER
AND FREE
1
MPH-ACTIVATE-IND
INFORMATIO N (UNIT DATA)
[RESTART TMO1]
TMO1 EXP DEACT DISABLED
[START TMO1]
MPH-ACTIVATE-IND
STATUS (ENABLE)
[SET DEACT ENABLED]
STATUS (DISABLE)
[SET DEACT DISABLED]
MPH-ACTIVATE-IND
[START TMO1]
TMO 1 EXP DEAC T ENABLED
[MPH-DEACTIVATE-REQ]
INFOR MATIO N (FREE)
INFO RMATION (IN USE)
INFO RMATION (FREE)
[START TMO1]
INFORMATIO N (IN USE)
[STOP TMO1]
MPH-ACTIVATE-IN D
Figure III-3/Q.921: State transition diagram of a deactivation procedure without MPH-DEACTIVATE-
INDICATION
Page 150
ETS 300 125: September 1991
Appendix IV (to Recommendation Q.921) Automatic negotiation of data link layer
parameters
IV.1
General
Each data link layer entity has an associated data link connection management entity. The data link
connection management entity has the responsability for initialising the link parameters necessary for
correct peer-to-peer information transport.
The method of initialisation of the parameters follows one of the two methods below:
-
initialisation to the default values as specified in Section 5.9; or
-
initialisation based on the values supplied by its peer entity.
The latter method utilises the parameter negotiation procedure described in this Appendix. Typically, after
the assignment of a TEI value to the management entity, the data link connection management entity is
notified by its layer management entity that parameter initialisation is required.
The data link connection management entity will invoke the peer to peer notification procedure. After
parameter initialisation, the data link connection management entity will notify the layer management entity
that parameter initialisation has occurred, and the layer management entity will issue the MDL-ASSIGN-
REQUEST.
IV.2
Parameter initialisation
The parameter initialisation procedure may invoke either the internal initialisation procedure or the
automatic notification of data link parameter procedure.
IV.3
Internal parameter initialisation
When the layer management entity notifies the connection management entity of TEI assignment, the
connection management entity shall initialise the link parameters to the default values and notify the layer
management of task completion.
IV.4
Automatic notification of data link layer parameter values
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
\* THIS PROCEDURE IS NOT SUPPORTED \*
\* BY EUROPEAN NETWORKS \*
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
Page 151
ETS 300 125: September 1991
Abbreviations and acronyms used in Recommendation Q.921 (I.441)
Abbreviation
Meaning
of acronym
Ai
Action indicator
ASP
Assignment Source Point
C/R
Command/Response field bit
CEI
Connection Endpoint Identifier
CES
Connection Endpoint Suffix
DISC
DISConnect
DL-
Communication between Layer 3 and Data Link Layer
DLCI
Data Link Connection Identifier
DM
Disconnected Mode
EA
Extended Address field bit
ET
Exchange Termination
FCS
Frame Check Sequence
FRMR
FRaMe Reject
I
Information
ID
IDentity
ISDN
Integral Services Digital Network
L3
Layer 3
L2
Layer 2
L1
Layer 1
LAPB
Link Access Procedure - Balanced
LAPD
Link Access Procedure on the D-channel
M
Modifier function bit
MDL-
Communication between layer Management and Data Link layer
MPH-
Communication between Management and PHysical layer
NT2
Network Termination 2
OSI
Open System Interconnection
P/F
Poll/Final bit
PH-
Communication between data link layer and PHysical layer
RC
Retransmission Counter
REC
RECeiver
REJ
REJect
Ri
Reference number
RNR
Receive Not Ready
RR
Receive Ready
S
Supervisory
S1)
Supervisory function bit
SABME
Set Asynchronous Balanced Mode Extended
SAP
Service Access Point
SAPI
Service Access Point Identifier
TE
Terminal Equipment
TEI
Terminal Endpoint Identifier
TX
Transmit
U
Unnumbered
UA
Unnumbered Acknowledgement
UI
Unnumbered Information
XID
EXchange IDentification
V(S)
Send state variable
V(A)
Acknowledge state variable
V(R)
Receive state variable
N(S)
Send sequence variable
N(R)
Receive sequence variable
1)A different acronym has to be found for Supervisory function bit.
Page 152
ETS 300 125: September 1991
References (used in Q.921)
[1]
CCITT Recommendation Q.920 (I.440): "ISDN user-network interface data link
layer - General aspects" [Blue Book, Vol. VI, Fascicle VI.9].
[2]
CCITT Recommendation Q.930 (I.450): "ISDN user-network interface layer 3 -
General aspects" [Blue Book, Vol. VI, Fascicle VI.11].
[3]
CCITT Recommendation Q.931 (I.451): "ISDN user-network interface layer 3
specification for basic call control" [Blue Book, Vol. VI, Fascicle VI.11].
[4]
CCITT Recommendation I.430: "Basic user-network interface - Layer 1
specification" [Blue Book, Vol. III, Fascicle III.8].
[5]
CCITT Recommendation I.431: "Primary rate user-network interface - Layer 1
specification" [Blue Book, Vol. III, Fascicle III.8].
[6]
CCITT Recommendation X.25: "Interface between data terminal equipment
(DTE) and data circuit-terminating equipment (DCE) for terminals operating in
the packet mode and connected to public data networks by dedicated circuit"
[Blue Book, Vol. VIII, Fascicle VIII.2].
[7]
prETS 300 012 (T/L 03-07), March 1990: "Integrated Services Digital network
(ISDN); Basic user-network interface layer 1 specification and test principles".
[8]
prETS 300 011 (T/L 03-14), March 1990: "Integrated Services Digital network
(ISDN); Primary rate user-network interface layer 1 specification and test
principles".
[9]
ETS 300 102-1 (1990): "Integrated Services Digital Network (ISDN); User-
network interface layer 3; Specifications for basic call control - Application of
CCITT Recommendations Q.930/I.450 and Q.931/I.451".
[10]
ETS 300 102-2 (1990): "Integrated Services Digital Network (ISDN); User-
network interface layer 3; Specification for basic call control; Specification
Description Language (SDL) diagrams - Application of CCITT Recommendation
Q.931/I.451 Annex A".
Page 153
ETS 300 125: September 1991
History
Document history
September 1991
First Edition
March 1997
Converted into Adobe Acrobat Portable Document Format (PDF)